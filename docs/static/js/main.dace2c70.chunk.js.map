{"version":3,"sources":["store/user/actionTypes.ts","store/global/actionTypes.ts","store/room/actionTypes.ts","store/user/reducer.ts","store/global/reducer.ts","store/room/reducer.ts","store/reducers.ts","util/helper.ts","util/constants.ts","store/index.ts","store/user/actions.ts","store/global/actions.ts","store/room/actions.ts","../shared/models/RequestMessage.ts","config.ts","WebsocketClient/wsClient.ts","WebsocketClient/index.ts","API/user.ts","API/index.ts","store/user/effects.ts","store/global/effects.ts","../shared/constants/room.ts","model/Notification.ts","store/room/effects.ts","ui/FullScreenLoading.tsx","view/GameLobby/components/RoomList/index.tsx","view/GameLobby/components/AccountCard/index.tsx","view/GameLobby/components/GameLobbyHeader.tsx","hooks/index.ts","view/GameLobby/index.tsx","component/NotificationPanel/index.tsx","view/room/CreateRoom/index.tsx","../shared/constants/index.ts","view/room/PlayingRoom/components/RoomChatting/index.tsx","view/room/PlayingRoom/components/RoomHeader.tsx","view/room/PlayingRoom/components/UserList/index.tsx","view/room/PlayingRoom/index.tsx","layout/AuthLayout.tsx","ui/UserAvatar/index.tsx","view/game/Game/components/AnswerInputBox/index.tsx","model/DrawAction.ts","controller/CanvasController.ts","view/game/Game/components/CanvasContainer/SetPenColorButton.tsx","ui/PlainLine.tsx","view/game/Game/components/CanvasContainer/SetPenSizeButton.tsx","view/game/Game/components/CanvasContainer/index.tsx","view/game/Game/components/GameHeader.tsx","view/game/Game/index.tsx","layout/CustomThemeLayout.tsx","route/routes.ts","layout/BasicLayout/index.tsx","route/index.tsx","App.tsx","index.ts"],"names":["SET_USERNAME","SET_USER","SET_USER_CURRENT_ROOM_ID","SET_IS_READY","SET_IS_GAMING","SET_NUMBER_OF_ONLINE_PLAYER","ADD_NOTIFICATION","SHIFT_NOTIFICATION","SET_ROOM_LIST","SET_CURRENT_ROOM_USERS","SET_CURRENT_ROOM_STATUS","SET_CURRENT_GAME","SET_ROOM","defaultState","isLogining","user","isRegistering","numberOfOnlinePlayer","notifications","roomList","currentRoom","currentGame","reducers","state","action","produce","draft","type","payload","userActionTypes","username","isGaming","isReady","currentRoomId","global","globalActionTypes","push","shift","room","roomActionTypes","users","status","createRootReducer","history","combineReducers","router","connectRouter","getToken","token","localStorage","getItem","setToken","setItem","createHandleOnKeyEnterUp","cb","evt","keyCode","IS_DEV_CLIENT","some","p","window","location","origin","includes","createHashHistory","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","createSetUsername","createSetUser","createSetIsGaming","createSetUserCurrentRoomId","rid","createSetIsReady","createSetNumberOfOnlinePlayer","num","createAddNotification","n","createShiftNotification","createSetRoomList","createSetCurrentRoomUsers","createSetRoom","r","createSetCurrentGame","g","createSetCurrentRoomStatus","s","RequestMessage","data","handler","desc","id","createAt","Date","now","this","getConfig","wsClient","options","isConnected","ws","messageCache","eventMap","Map","WebSocket","addr","init","onopen","sendMessageFromCache","onclose","console","log","onerror","onmessage","rawMessage","msg","JSON","parse","emit","requestId","trigger","forEach","sendMessage","reqMsg","send","stringify","Promise","resolve","reject","on","callback","_","respMsg","error","off","err","eventName","cbsArray","get","undefined","set","filter","c","cbs","login","a","request","changeUsername","changed","dispatch","API","userActions","usrName","getNumberOfOnlinePlayer","result","globalActions","RoomStatus","RoomType","Notification","title","detail","uuidv4","getRoomList","roomActions","isEnteringRoom","enterRoom","roomId","batchDispatch","leaveRoom","getState","createRoom","name","sendChatMessage","content","makeGameIsReady","ready","requestType","getGame","game","GAMING","replace","FullScreenLoading","className","style","display","justifyContent","alignItems","CircularProgress","statusText","WAITING","RoomListItem","useDispatch","String","padStart","Button","onClick","boxShadow","fullWidth","variant","color","length","maxPlayerNumber","selectorRoomList","RoomList","useSelector","shallowEqual","freshRoomList","useCallback","roomEffects","useEffect","refreshRoomListOff","respData","List","subheader","ListSubheader","IconButton","map","key","selectorAccountCard","AccountCard","useState","changedUsername","setChangedUsername","updateUsername","target","value","trim","isShowChangeNameDialog","setIsShowChangeNameDialog","openChangeNameModal","closeChangeName","confirmChangeUsername","isEmptyName","userEffects","Dialog","open","onClose","DialogTitle","DialogContent","TextField","placeholder","onChange","DialogActions","disabled","Card","CardHeader","toLocaleTimeString","avatar","Avatar","GameLobbyHeader","React","memo","isShowFindRoom","setIsShowFindRoom","closeFindRoom","setRoomId","jumoToFindRoom","onKeyUp","AppBar","position","Toolbar","Typography","flex","textAlign","useDocumentTitle","prevTitleRef","useRef","current","document","indexSelector","selectorNotificationPanel","NotificationPanel","shiftNotification","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","aria-label","Close","message","ReservedEventName","selectorRoomMessage","userId","RoomChatting","chatMsgList","setChatMsgList","ROOM_CHATTING","chatMsg","prev","concat","msgContent","setMsgContent","isValidatedContentt","cm","ListItem","speaker","timestamp","selectorPlayingRoom","roomName","roomType","PUBLIC","roomTypeTextMapping","PRIVATE","RoomHeader","arrOfEight","Array","fill","selectorUserList","UserList","index","selectorAuthLoyout","pathname","AvatarStatus","text","UserAvatar","children","height","width","backgroundColor","createElement","AnswerInputBox","DrawActionType","answer","setAnswer","sendGuessAnswer","CanvasController","canvasEl","ctx","getContext","penColor","setPenColor","penSize","setPenSize","strokeStyle","fillStyle","lineWidth","size","image","img","Image","onload","clearCanvas","drawImage","src","to","beginPath","arc","x","y","Math","PI","closePath","toDataURL","startPoint","sp","moveTo","lineTo","stroke","elementSelector","el","querySelector","Error","append","clientHeight","clientWidth","prevFillStyle","clearRect","fillRect","op","DrawAction","colors","SetPenColorButton","anchorEl","isShowSetPenColor","setIsShowSetPenColor","updatePenColor","fontSize","Popover","transformOrigin","border","PlainLine","props","SetPenSizeButton","updatePenSize","isShowSetPenSize","setIsShowSetPenSize","Slider","valueLabelDisplay","step","marks","min","max","sendDrawActionToServer","extral","drawAction","getPointFromEvent","touches","t","clientX","clientY","offsetLeft","offsetTop","isSelfPlaying","initialDrawing","draw","futureDrawings","setFutureDrawings","pastDrawings","setPastDrawings","isMountedRef","useLayoutEffect","mount","changePlayingUserOff","CHANGE_DRAWER","drawActionOff","DRAW_ACTION","respMsgData","START_DRAW_LINE","point","setting","prevSetting","getSetting","drawPoint","startDrawLine","DRAW_LINE_TO","drawLineTo","CLEAR_CANVAS","DRAW_IMAGE","imgData","snapshotCurrentDrawing","curDrawing","getSnapshot","newestDrawing","undoDrawing","pastDrawing","pop","redoDrawing","futureDrawing","handleTouchStart","handleTouchMove","handleTouchEnd","END_DRAW_LINE","posDivEl","setPosDivEl","onTouchStart","onTouchMove","onTouchEnd","ref","Undo","Redo","playInfo","time","gameTimeSoFar","setGameTimeSoFar","timeoutOff","TIMEOUT","msgData","keyword","raw","hint","selectorGame","theme","createMuiTheme","palette","primary","main","routes","path","component","targetPath","ThemeProvider","defaultRoomName","setRoomName","setRoomType","globalEffects","isUsingDefaultRoomName","setIsUsingDefaultRoomName","updateRoomName","goBack","FormControl","label","RadioGroup","button","FormControlLabel","control","Radio","labelPlacement","chattingList","setChattingList","isShowPlayOverPanel","setIsShowPlayOverPanel","chattingMessageOff","GAME_CHATTING","prevList","playOverOff","PLAY_OVER","gameOverOff","GAME_OVER","refreshGameOff","REFRESH_GAME","changeDrawerOff","useMemo","currentPlayer","CanvasContainer","gameUser","userScores","isOnline","rawRoomId","useParams","parseInt","toggleGameReady","refreshRoomInfoOff","REFRESH_ROOM","startGameOff","START_GAME","Number","isNaN","AppRoute","generateRoutes","route","Layout","layout","Component","render","store","createStore","applyMiddleware","routerMiddleware","ReduxThunk","App","refreshPlayerInfoOff","AppWrapper","ReactDOM","getElementById","addEventListener","preventDefault","passive"],"mappings":"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","file":"static/js/main.dace2c70.chunk.js","sourcesContent":["export const SET_USERNAME = 'SET_USERNAME';\n\nexport const SET_USER = 'SET_USER';\n\nexport const SET_USER_CURRENT_ROOM_ID =  'SET_USER_CURRENT_ROOM_ID';\n\nexport const SET_IS_READY = 'SET_IS_READY';\n\nexport const SET_IS_GAMING = 'SET_IS_GAMING';\n\n// export const LOGOUT = 'LOGOUT';\n","export const SET_NUMBER_OF_ONLINE_PLAYER = 'SET_NUMBER_OF_ONLINE_PLAYER';\n\nexport const ADD_NOTIFICATION = 'ADD_NOTIFICATION';\n\nexport const SHIFT_NOTIFICATION = 'REMOVE_NOTIFICATION';\n","export const SET_ROOM_LIST = 'SET_ROOM_LIST';\n\nexport const SET_CURRENT_ROOM_USERS = 'SET_CURRENT_ROOM_USERS';\n\nexport const SET_CURRENT_ROOM_STATUS = 'SET_CURRENT_ROOM_STATUS';\n\nexport const SET_CURRENT_GAME = 'SET_CURRENT_GAME';\n\nexport const SET_ROOM = 'SET_ROOM';\n","import { IUser } from '../../../shared/types';\r\nimport { produce } from 'immer';\r\n\r\nimport { IAction } from '../actions';\r\nimport { userActionTypes } from '../actionTypes';\r\n\r\nexport interface IReduxUserState {\r\n  isLogining: boolean;\r\n  user: null | IUser;\r\n  isRegistering: boolean;\r\n}\r\n\r\nconst defaultState: IReduxUserState = {\r\n  isLogining: false,\r\n  user: null,\r\n  isRegistering: false,\r\n};\r\n\r\nexport default function userReducer(state = defaultState, action: IAction) {\r\n  return produce(state, draft => {\r\n    const { type, payload } = action;\r\n    switch (type) {\r\n      case userActionTypes.SET_USERNAME:\r\n        if (draft.user != null) {\r\n          draft.user.username = payload as string;\r\n        }\r\n        break;\r\n      case userActionTypes.SET_USER:\r\n        draft.user = payload as IUser;\r\n        break;\r\n      case userActionTypes.SET_IS_GAMING:\r\n        if (draft.user != null) {\r\n          draft.user.isGaming = payload as boolean;\r\n        }\r\n        break;\r\n      case userActionTypes.SET_IS_READY:\r\n        if (draft.user != null) {\r\n          draft.user.isReady = payload as boolean;\r\n        }\r\n        break;\r\n\r\n      case userActionTypes.SET_USER_CURRENT_ROOM_ID:\r\n        if (draft.user != null) {\r\n          draft.user.currentRoomId = payload as number | undefined;\r\n        }\r\n        break;\r\n    }\r\n  });\r\n}\r\n","import { produce } from 'immer';\r\n\r\nimport { IAction } from '../actions';\r\nimport { globalActionTypes } from '../actionTypes';\r\nimport Notification from '@client/model/Notification';\r\n\r\nexport interface IReduxGlobalState {\r\n  numberOfOnlinePlayer: number;\r\n  notifications: Notification[];\r\n}\r\n\r\nconst defaultState: IReduxGlobalState = {\r\n  numberOfOnlinePlayer: 1,\r\n  notifications: [],\r\n};\r\n\r\nexport default function globalReducer(state = defaultState, action: IAction) {\r\n  return produce(state, draft => {\r\n    const { type, payload } = action;\r\n    switch (type) {\r\n      case globalActionTypes.SET_NUMBER_OF_ONLINE_PLAYER:\r\n        draft.numberOfOnlinePlayer = payload as number;\r\n        break;\r\n      case globalActionTypes.ADD_NOTIFICATION:\r\n        draft.notifications.push(payload as Notification);\r\n        break;\r\n      case globalActionTypes.SHIFT_NOTIFICATION:\r\n        draft.notifications.shift();\r\n        break;\r\n    }\r\n  });\r\n}\r\n","import { produce } from 'immer';\r\n\r\nimport { RoomStatus } from '../../../shared/constants';\r\nimport { IGame, IRoom, IUser } from '../../../shared/types';\r\nimport { IAction } from '../actions';\r\nimport { roomActionTypes } from '../actionTypes';\r\n\r\n\r\nexport interface IReduxRoomState {\r\n  roomList: IRoom[];\r\n  currentRoom: null | IRoom;\r\n  currentGame: null | IGame;\r\n}\r\n\r\nconst defaultState: IReduxRoomState = {\r\n  roomList: [],\r\n  currentRoom: null,\r\n  currentGame: null,\r\n};\r\n\r\nexport default function roomReducer(state = defaultState, action: IAction) {\r\n  return produce(state, draft => {\r\n    const { type, payload } = action;\r\n    switch (type) {\r\n      case roomActionTypes.SET_ROOM_LIST:\r\n        draft.roomList = payload as IRoom[];\r\n        break;\r\n      case roomActionTypes.SET_CURRENT_ROOM_USERS:\r\n        if (draft.currentRoom != null) {\r\n          draft.currentRoom.users = payload as IUser[];\r\n        }\r\n        break;\r\n      case roomActionTypes.SET_ROOM:\r\n        draft.currentRoom = payload as IRoom | null;\r\n        break;\r\n      case roomActionTypes.SET_CURRENT_GAME:\r\n        draft.currentGame = payload as IGame | null;\r\n        break;\r\n      case roomActionTypes.SET_CURRENT_ROOM_STATUS:\r\n        if (draft.currentRoom != null) {\r\n          draft.currentRoom.status = payload as RoomStatus;\r\n        }\r\n        break;\r\n    }\r\n  });\r\n}\r\n","import { combineReducers } from 'redux';\r\nimport { connectRouter } from 'connected-react-router'\r\nimport { Location } from 'history';\r\n\r\nimport userReducer, { IReduxUserState } from \"./user/reducer\";\r\nimport globalReducer, { IReduxGlobalState } from \"./global/reducer\";\r\nimport roomReducer, { IReduxRoomState } from \"./room/reducer\";\r\n\r\nconst reducers = {\r\n  user: userReducer,\r\n  global: globalReducer,\r\n  room: roomReducer,\r\n}\r\n\r\nconst createRootReducer = (history: any) => combineReducers({\r\n  router: connectRouter(history),\r\n  ...reducers,\r\n});\r\n\r\nexport default createRootReducer;\r\n\r\nexport interface IReduxState {\r\n    user: IReduxUserState,\r\n    global: IReduxGlobalState,\r\n    room: IReduxRoomState,\r\n    router: {\r\n      location: Location,\r\n    }\r\n}\r\n","import { KeyboardEvent } from 'react';\r\n\r\nexport function getIsDevelopment() {\r\n  const devlopmentPaths = ['localhost', '127.0.0.1', '192.168'];\r\n  return devlopmentPaths.some(p => window.location.origin.includes(p));\r\n}\r\n\r\nexport function getToken() {\r\n  const token = localStorage.getItem('__token');;\r\n  if (token == null) return undefined;\r\n  return token;\r\n}\r\n\r\nexport function setToken(token: string) {\r\n  localStorage.setItem('__token', token);\r\n}\r\n\r\nexport function createHandleOnKeyEnterUp(cb: () => void) {\r\n  return function handleOnKeyEnterUp(evt: KeyboardEvent) {\r\n    const KEY_ENTER_CODE = 13;\r\n    if (evt.keyCode === KEY_ENTER_CODE) {\r\n      cb();\r\n    }\r\n  }\r\n}\r\n\r\n","import { getIsDevelopment } from \"./helper\";\r\n\r\nexport const IS_DEV_CLIENT = getIsDevelopment();\r\n\r\n// export enum MessageType { // 注意这里的字面量很重要的，后端根据这个判断调用哪一个service\r\n//     LOGIN = 'login',\r\n//     ROOM_LIST = 'roomList',\r\n// }\r\n","import { createStore, applyMiddleware, compose } from 'redux';\r\nimport { createHashHistory } from 'history';\r\nimport { routerMiddleware } from 'connected-react-router';\r\nimport ReduxThunk from 'redux-thunk';\r\n\r\nimport createRootReducer from './reducers';\r\nimport { IS_DEV_CLIENT } from '../util/constants';\r\n\r\nexport const history = createHashHistory();\r\n\r\nconst composeEnhancers =\r\n  (window as any).__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\r\n\r\nexport default function configureStore() {\r\n  if (IS_DEV_CLIENT) {\r\n    const store = createStore(\r\n      createRootReducer(history), // root reducer with router state\r\n      composeEnhancers(\r\n        applyMiddleware(\r\n          routerMiddleware(history), // for dispatching history actions\r\n          ReduxThunk,\r\n        ),\r\n      ),\r\n    );\r\n\r\n    return store;\r\n  } else {\r\n    const store = createStore(\r\n      createRootReducer(history), // root reducer with router state\r\n      compose(\r\n        applyMiddleware(\r\n          routerMiddleware(history), // for dispatching history actions\r\n          ReduxThunk,\r\n        ),\r\n      ),\r\n    );\r\n\r\n    return store;\r\n  }\r\n}\r\n","import { IAction } from '../actions';\nimport { userActionTypes } from '../actionTypes';\nimport { IUser } from '../../../shared/types';\n\nexport function createSetUsername(username: string): IAction {\n  return {\n    type: userActionTypes.SET_USERNAME,\n    payload: username,\n  };\n}\n\nexport function createSetUser(user: IUser): IAction {\n  return {\n    type: userActionTypes.SET_USER,\n    payload: user,\n  };\n}\n\nexport function createSetIsGaming(status: boolean): IAction {\n  return {\n    type: userActionTypes.SET_IS_GAMING,\n    payload: status,\n  }\n}\n\nexport function createSetUserCurrentRoomId(rid: number | undefined): IAction {\n  return {\n    type: userActionTypes.SET_USER_CURRENT_ROOM_ID,\n    payload: rid,\n  }\n}\n\nexport function createSetIsReady(status: boolean): IAction {\n  return {\n    type: userActionTypes.SET_IS_READY,\n    payload: status,\n  }\n}\n","import { IAction } from '../actions';\nimport { globalActionTypes } from '../actionTypes';\nimport Notification from '@client/model/Notification';\n\nexport function createSetNumberOfOnlinePlayer(num: number): IAction {\n  return {\n    type: globalActionTypes.SET_NUMBER_OF_ONLINE_PLAYER,\n    payload: num,\n  };\n}\n\nexport const createAddNotification = (n: Notification) => ({\n  type: globalActionTypes.ADD_NOTIFICATION,\n  payload: n,\n});\n\nexport const createShiftNotification = () => ({\n  type: globalActionTypes.SHIFT_NOTIFICATION,\n});\n","import { IAction } from '../actions';\nimport { roomActionTypes } from '../actionTypes';\nimport { IRoom, IUser, IGame } from '../../../shared/types';\nimport { RoomStatus } from '../../../shared/constants/room';\n\nexport function createSetRoomList(roomList: any[]): IAction {\n  return {\n    type: roomActionTypes.SET_ROOM_LIST,\n    payload: roomList,\n  };\n}\n\nexport function createSetCurrentRoomUsers(users: IUser[]): IAction {\n  return {\n    type: roomActionTypes.SET_CURRENT_ROOM_USERS,\n    payload: users,\n  };\n}\n\nexport function createSetRoom(r: IRoom | null): IAction {\n  return {\n    type: roomActionTypes.SET_ROOM,\n    payload: r,\n  };\n}\n\nexport function createSetCurrentGame(g: IGame | null): IAction {\n  return {\n    type: roomActionTypes.SET_CURRENT_GAME,\n    payload: g,\n  };\n}\n\nexport function createSetCurrentRoomStatus(s: RoomStatus): IAction {\n  return {\n    type: roomActionTypes.SET_CURRENT_ROOM_STATUS,\n    payload: s,\n  }\n}\n","\r\nexport default class RequestMessage {\r\n  id: string;\r\n  createAt = Date.now();\r\n  constructor(public data: unknown, public handler?: string, public desc?: string) {\r\n    this.id = `${this.handler}-${Date.now()}`;\r\n  }\r\n\r\n  toJSON() {\r\n    const { ...publics } = this;\r\n    return publics;\r\n  }\r\n}\r\n\r\nexport function isRequestMessage(target: any): target is RequestMessage {\r\n  if (target == null) return false;\r\n  if (\r\n    typeof target === 'object' &&\r\n    typeof target.id === 'string' &&\r\n    typeof target.createAt === 'number'\r\n  ) return true;\r\n  return false;\r\n}\r\n","import { IS_DEV_CLIENT } from \"./util/constants\";\r\n\r\nfunction getConfig() {\r\n    if (IS_DEV_CLIENT) {\r\n        return {\r\n            // addr: 'ws://127.0.0.1:9421',\r\n            addr: 'ws://192.168.137.1:9421',\r\n        }\r\n    }\r\n    return {\r\n        addr: 'ws://101.37.174.138:9421',\r\n    };\r\n}\r\n\r\nexport default getConfig();\r\n\r\n","import WebsocketClient from \".\";\r\nimport config from \"@client/config\";\r\n\r\nconst wsClient = new WebsocketClient({\r\n  addr: config.addr,\r\n});\r\n\r\nexport default wsClient;\r\n","import { IS_DEV_CLIENT } from '../util/constants';\r\nimport ResponseMessage from '../../shared/models/ResponseMessage';\r\nimport RequestMessage from '../../shared/models/RequestMessage';\r\n// import RequestMessage from './models/RequestMessage';\r\n\r\nexport default class WebsocketClient {\r\n  isConnected = false;\r\n  ws: WebSocket;\r\n  messageCache: RequestMessage[] = [];\r\n  eventMap = new Map<\r\n    string,\r\n    ((messageData: unknown, message: RequestMessage) => void)[]\r\n  >();\r\n  constructor(\r\n    public options: {\r\n      addr: string;\r\n      onopen?: (evt: Event) => void;\r\n      onclose?: (evt: Event) => void;\r\n      onerror?: (evt: Event) => void;\r\n    },\r\n  ) {\r\n    this.ws = new window.WebSocket(this.options.addr);\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    // 注册事件\r\n    this.ws.onopen = evt => {\r\n      this.isConnected = true;\r\n      if (typeof this.options.onopen === 'function') {\r\n        this.options.onopen(evt);\r\n      }\r\n      this.sendMessageFromCache();\r\n    };\r\n    this.ws.onclose = evt => {\r\n      this.isConnected = false;\r\n      if (typeof this.options.onclose === 'function') {\r\n        this.options.onclose(evt);\r\n        if (IS_DEV_CLIENT) {\r\n          console.log('连接断开');\r\n        }\r\n      }\r\n    };\r\n    this.ws.onerror = evt => {\r\n      if (typeof this.options.onerror === 'function') {\r\n        this.options.onerror(evt);\r\n      }\r\n    };\r\n    this.ws.onmessage = ({ data: rawMessage }) => {\r\n      const msg: ResponseMessage = JSON.parse(rawMessage);\r\n      console.log('recive', msg);\r\n      this.emit('message', msg);\r\n      if (msg.requestId != null) {\r\n        this.emit(msg.requestId, msg);\r\n      }\r\n      if (msg.trigger != null) {\r\n        this.emit(msg.trigger, msg);\r\n      }\r\n    };\r\n    // end 注册事件\r\n  }\r\n\r\n  sendMessageFromCache() {\r\n    // 主要是为了处理应用已经加载完成，但是还没建立连接的情况，相当于人为加了一个缓冲层，只要没有connected，这些msg就不会发送\r\n    this.messageCache.forEach(msg => {\r\n      this.sendMessage(msg);\r\n    });\r\n    this.messageCache = [];\r\n  }\r\n\r\n  sendMessage(reqMsg: RequestMessage) {\r\n    if (this.isConnected) {\r\n      console.log(`sendMessage`, reqMsg);\r\n      this.ws.send(JSON.stringify(reqMsg));\r\n    } else {\r\n      this.messageCache.push(reqMsg);\r\n    }\r\n  }\r\n\r\n  // requestSync(type: string, data?: any) {\r\n  //   const messageId = type + '_' + new Date().getTime(); // 这是为了防止收到过时的信息\r\n  //   const msg: RequestMessage = { data, type, id: messageId };\r\n  //   this.sendMessage(msg);\r\n  // }\r\n\r\n  // 不需要等待回复的请求不要用这个方法，会导致内存泄漏，因为无法触发对应reqesut Id的回调函数\r\n  request(handler: string, data?: any) {\r\n    return new Promise<ResponseMessage>((resolve, reject) => {\r\n      try {\r\n        // const messageId = type + '_' + new Date().getTime() // 这是为了防止收到过时的信息\r\n        // const msg: RequestMessage = {data, type, id: messageId}\r\n        const reqMsg = new RequestMessage(data, handler);\r\n        const callback = (_: unknown, respMsg: ResponseMessage) => {\r\n          if (respMsg == null) {\r\n            console.error(`${reqMsg.handler}-${reqMsg.id} 返回来空的message`);\r\n          }\r\n\r\n          // 注意，如果针对本次请求，如果服务器端没有回复响应，则永远不会调用和删除回调\r\n          if (respMsg.error != null) {\r\n            this.emit('error', respMsg);\r\n            reject(respMsg.error);\r\n          }\r\n\r\n          resolve(respMsg);\r\n\r\n          if (respMsg.requestId != null) {\r\n            this.off(respMsg.requestId, callback);\r\n          }\r\n          if (IS_DEV_CLIENT) {\r\n            if (respMsg.requestId != null && respMsg.requestId !== reqMsg.id) {\r\n              console.error(\r\n                `reqMsg.id: ${reqMsg.id} !== respMsg.requestId： ${respMsg.requestId}`,\r\n              );\r\n            }\r\n          }\r\n        };\r\n        this.on(reqMsg.id, callback);\r\n        this.sendMessage(reqMsg);\r\n      } catch (err) {\r\n        console.error(`request时发生错误 ${err}`);\r\n      }\r\n    });\r\n  }\r\n\r\n  on(\r\n    eventName: string,\r\n    callback: (messageData: unknown, message: ResponseMessage) => void,\r\n  ) {\r\n    let cbsArray = this.eventMap.get(eventName);\r\n    if (cbsArray === undefined) {\r\n      cbsArray = [];\r\n      this.eventMap.set(eventName, cbsArray);\r\n    }\r\n    cbsArray.push(callback);\r\n    return () => {\r\n      this.off(eventName, callback);\r\n    };\r\n  }\r\n  off(\r\n    eventName: string,\r\n    cb: (messageData: unknown, message: RequestMessage) => void,\r\n  ) {\r\n    let cbsArray = this.eventMap.get(eventName);\r\n    if (cbsArray !== undefined) {\r\n      cbsArray = cbsArray.filter(c => c !== cb);\r\n      this.eventMap.set(eventName, cbsArray);\r\n    }\r\n  }\r\n  emit(eventName: string, msg: RequestMessage) {\r\n    const cbs = this.eventMap.get(eventName);\r\n    if (cbs !== undefined) {\r\n      cbs.forEach(c => c(msg.data, msg));\r\n    }\r\n  }\r\n}\r\n","import wsClient from \"@client/WebsocketClient/wsClient\";\r\nimport { IUser } from \"../../shared/types\";\r\n\r\nexport async function login(token?: string) {\r\n  const user = (await wsClient.request('login', token)).data as IUser;\r\n  return user;\r\n}\r\n\r\nexport async function changeUsername(username: string) {\r\n  const changed = (await wsClient.request(\r\n    'changeUsername',\r\n    username,\r\n  )).data as string;\r\n  return changed;\r\n}\r\n","\r\nimport * as user from './user';\r\n\r\nexport default {\r\n  user,\r\n}\r\n","import { TReduxThunk } from '../effects';\nimport { userActions } from '../actions';\nimport { getToken, setToken } from '../../util/helper';\nimport API from '@client/API';\n\nexport function login(): TReduxThunk {\n  return async dispatch => {\n    const token = getToken();\n    const user = await API.user.login(token);\n    setToken(user.token);\n    dispatch(userActions.createSetUser(user));\n  };\n}\n\nexport function changeUsername(usrName: string): TReduxThunk {\n  return async dispatch => {\n    const changed = await API.user.changeUsername(usrName);\n    dispatch(userActions.createSetUsername(changed));\n  };\n}\n","import { TReduxThunk } from '../effects';\nimport { globalActions } from '../actions';\nimport wsClient from '@client/WebsocketClient/wsClient';\n\n\nexport function getNumberOfOnlinePlayer(): TReduxThunk {\n  return async dispatch => {\n    try {\n      const result = (await wsClient.request('numberOfOnlineUser')).data as number;\n      dispatch(globalActions.createSetNumberOfOnlinePlayer(result));\n    } catch (err) {\n      console.error(err);\n    }\n  };\n}\n","export enum RoomStatus {\r\n  WAITING = 'waiting',\r\n  GAMING = 'gaming',\r\n};\r\n\r\nexport enum RoomType {\r\n  PUBLIC = 'public',\r\n  PRIVATE = 'private',\r\n}\r\n","import uuidv4 from 'uuid/v4';\r\n\r\n\r\nexport default class Notification {\r\n  public id = uuidv4();\r\n  public createAt = Date.now();\r\n  constructor(\r\n    public title: string,\r\n    public type: 'error' | 'warn' | 'success' | 'none' = 'none',\r\n    public detail?: string,\r\n  ) {}\r\n}\r\n","import Notification  from '@client/model/Notification';\nimport wsClient from '@client/WebsocketClient/wsClient';\nimport { push, replace } from 'connected-react-router';\nimport { batch as batchDispatch } from 'react-redux';\n\nimport { RoomStatus, RoomType } from '../../../shared/constants/room';\nimport { IGame, IRoom, IUser } from '../../../shared/types';\nimport { globalActions, roomActions, userActions } from '../actions';\nimport { TReduxThunk } from '../effects';\n\nexport function getRoomList(): TReduxThunk {\n  return async dispatch => {\n    try {\n      const respMsg = await wsClient.request('roomList');\n      const result = respMsg.data as any[];\n      dispatch(roomActions.createSetRoomList(result));\n    } catch (err) {\n      console.error(err);\n    }\n  };\n}\n\nlet isEnteringRoom = false;\nexport function enterRoom(roomId: number): TReduxThunk {\n  return async dispatch => {\n    if (isEnteringRoom) return;\n    isEnteringRoom = true;\n\n    try {\n      const respMsg = await wsClient.request('userEnter', {\n        roomId,\n      });\n\n      const { room, user } = respMsg.data as {\n        room: IRoom;\n        user: IUser;\n      };\n      batchDispatch(() => {\n        dispatch(roomActions.createSetRoom(room));\n        dispatch(userActions.createSetUserCurrentRoomId(user.currentRoomId));\n        dispatch(push(`/room/${room.id}`));\n      });\n    } catch (err) {\n      batchDispatch(() => {\n        dispatch(push('/'));\n        dispatch(globalActions.createAddNotification(new Notification(err.title, 'error')))\n      });\n\n    } finally {\n      isEnteringRoom = false;\n    }\n  };\n}\n\nexport function leaveRoom(): TReduxThunk {\n  return async (dispatch, getState) => {\n    const {\n      user: { user },\n    } = getState();\n    if (user == null || user.currentRoomId == null) return;\n    try {\n      wsClient.request('userLeave');\n      dispatch(userActions.createSetUserCurrentRoomId(undefined));\n      dispatch(roomActions.createSetRoom(null));\n      dispatch(push('/'));\n    } catch (err) {\n      console.error(err);\n    }\n  };\n}\n\nexport function createRoom(name: string, type: RoomType): TReduxThunk {\n  return async dispatch => {\n    try {\n      const respMsg = await wsClient.request('createRoom', {\n        name,\n        type,\n      });\n      const room = respMsg.data as IRoom;\n      dispatch(enterRoom(room.id));\n      // dispatch(getRoomList());\n    } catch (err) {\n      console.error(err);\n    }\n  };\n}\n\nexport function sendChatMessage(content: string): TReduxThunk {\n  return async dispatch => {\n    try {\n      wsClient.request('sendChatMessage', { content });\n    } catch (err) {\n      console.error(err);\n    }\n  };\n}\n\nexport function makeGameIsReady(ready: boolean): TReduxThunk {\n  const requestType = ready ? 'makeGameReady' : 'cancelGameReady';\n  return async dispatch => {\n    try {\n      const respMsg = await wsClient.request(requestType);\n      const { user, room } = respMsg.data as {\n        user: IUser;\n        room: IRoom;\n      };\n      dispatch(roomActions.createSetCurrentRoomUsers(room.users));\n      dispatch(userActions.createSetIsReady(user.isReady));\n    } catch (err) {\n      console.error(err);\n    }\n  };\n}\n\nexport function getGame(): TReduxThunk {\n  return async (dispatch, getState) => {\n    const {\n      user: { user },\n    } = getState();\n    try {\n      const respMsg = await wsClient.request('getGame');\n      const { game } = respMsg.data as {\n        user: IUser;\n        game: IGame;\n      };\n      dispatch(roomActions.createSetCurrentGame(game));\n      dispatch(roomActions.createSetCurrentRoomStatus(RoomStatus.GAMING));\n    } catch (err) {\n      dispatch(\n        globalActions.createAddNotification(\n          new Notification(err.title, 'error'),\n        ),\n      );\n      if (user != null && user.currentRoomId != null) {\n        dispatch(replace(`/room/${user.currentRoomId}`));\n      } else {\n        dispatch(replace('/'));\n      }\n    }\n  };\n}\n","import React from 'react';\r\n\r\nimport { CircularProgress } from '@material-ui/core';\r\n\r\nexport default function FullScreenLoading() {\r\n\r\n  return (\r\n    <div className=\"full-screen-loading\" style={{\r\n      display: 'flex',\r\n      justifyContent: 'center',\r\n      alignItems: 'center',\r\n    }}>\r\n      <CircularProgress />\r\n    </div>\r\n  );\r\n}\r\n","import './index.scss';\r\n\r\nimport { roomActions } from '@client/store/actions';\r\nimport { roomEffects } from '@client/store/effects';\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport { IS_DEV_CLIENT } from '@client/util/constants';\r\nimport wsClient from '@client/WebsocketClient/wsClient';\r\nimport { Button, IconButton, List, ListSubheader } from '@material-ui/core';\r\nimport { LoopOutlined as FreshIcon } from '@material-ui/icons';\r\nimport { push } from 'connected-react-router';\r\nimport React, { useCallback, useEffect } from 'react';\r\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\r\n\r\nimport { RoomStatus } from '../../../../../shared/constants/room';\r\nimport { IRoom } from '../../../../../shared/types';\r\n\r\nconst statusText = {\r\n  [RoomStatus.GAMING]: '游戏中',\r\n  [RoomStatus.WAITING]: '等待中...',\r\n};\r\n\r\nfunction RoomListItem({ room }: { room: IRoom }) {\r\n  const dispatch = useDispatch();\r\n  return (\r\n    <div className=\"room-list-room\">\r\n      <div className=\"room-info\">\r\n        <div className=\"room-name\">{room.name}</div>\r\n        <div className=\"room-number\">No.{String(room.id).padStart(5, '0')}</div>\r\n      </div>\r\n      <div className=\"room-actions\">\r\n        <div className=\"room-status\">{statusText[room.status]}</div>\r\n        <Button\r\n          onClick={() => dispatch(push(`/room/${room.id}`))}\r\n          style={{ boxShadow: 'none' }}\r\n          fullWidth\r\n          variant=\"contained\"\r\n          color=\"primary\"\r\n        >\r\n          加入{`(${room.users.length}/${room.maxPlayerNumber})`}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst selectorRoomList = ({\r\n  room: { roomList },\r\n}: IReduxState) => ({\r\n  roomList,\r\n});\r\n\r\nexport default function RoomList() {\r\n  if (IS_DEV_CLIENT) {\r\n    console.log('render RoomList');\r\n  }\r\n\r\n  const { roomList } = useSelector(selectorRoomList, shallowEqual);\r\n\r\n  const dispatch = useDispatch();\r\n  const freshRoomList = useCallback(() => {\r\n    dispatch(roomEffects.getRoomList());\r\n  }, [dispatch]);\r\n\r\n  useEffect(() => {\r\n    freshRoomList();\r\n\r\n    const refreshRoomListOff = wsClient.on('refreshRoomList', respData => {\r\n      const roomList = respData as IRoom[];\r\n      dispatch(roomActions.createSetRoomList(roomList));\r\n    });\r\n\r\n    return () => {\r\n      refreshRoomListOff();\r\n    };\r\n  }, [dispatch, freshRoomList]);\r\n\r\n  return (\r\n    <div className=\"room-list\">\r\n      <List\r\n        subheader={\r\n          <ListSubheader>\r\n            房间列表\r\n            <IconButton onClick={freshRoomList}>\r\n              <FreshIcon />\r\n            </IconButton>\r\n          </ListSubheader>\r\n        }\r\n        className=\"room-list\"\r\n      >\r\n        {roomList.length === 0 ? (\r\n          <div className=\"no-room-text\">暂无公开房间</div>\r\n        ) : (\r\n          <div className=\"room-list-content\">\r\n            {roomList.map(room => (\r\n              <RoomListItem key={room.id} room={room} />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </List>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useCallback, ChangeEvent } from 'react';\r\nimport {\r\n  Card,\r\n  CardHeader,\r\n  IconButton,\r\n  Avatar,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n  TextField,\r\n  Button,\r\n} from '@material-ui/core';\r\nimport { MoreVert as MoreIcon } from '@material-ui/icons';\r\nimport { useSelector, shallowEqual, useDispatch } from 'react-redux';\r\n\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport FullScreenLoading from '@client/ui/FullScreenLoading';\r\nimport { userEffects } from '@client/store/effects';\r\nimport { IS_DEV_CLIENT } from '@client/util/constants';\r\n\r\nimport './index.scss';\r\n\r\nconst selectorAccountCard = ({ user: { user } }: IReduxState) => ({ user });\r\n\r\nexport default function AccountCard() {\r\n  if (IS_DEV_CLIENT) {\r\n    console.log('render AccountCard');\r\n  }\r\n  const { user } = useSelector(selectorAccountCard, shallowEqual);\r\n  const [changedUsername, setChangedUsername] = useState(\r\n    user != null ? user.username : '',\r\n  );\r\n  const updateUsername = useCallback(\r\n    (evt: ChangeEvent<HTMLInputElement>) =>\r\n      setChangedUsername(evt.target.value.trim()),\r\n    [setChangedUsername],\r\n  );\r\n\r\n  // -- 更改用户名相关逻辑\r\n  const [isShowChangeNameDialog, setIsShowChangeNameDialog] = useState(false);\r\n  const dispatch = useDispatch();\r\n  const openChangeNameModal = useCallback(\r\n    () => setIsShowChangeNameDialog(true),\r\n    [setIsShowChangeNameDialog],\r\n  );\r\n  const closeChangeName = useCallback(() => setIsShowChangeNameDialog(false), [\r\n    setIsShowChangeNameDialog,\r\n  ]);\r\n  const confirmChangeUsername = useCallback(() => {\r\n    const isEmptyName = changedUsername.trim().length === 0;\r\n    if (user != null && !isEmptyName && user.username !== changedUsername) {\r\n      // 只有名字不为空，且前后发生变化, 才发送请求\r\n      dispatch(userEffects.changeUsername(changedUsername));\r\n    }\r\n    if (!isEmptyName) closeChangeName();\r\n  }, [user, changedUsername, dispatch, closeChangeName]);\r\n\r\n  if (user == null) return <FullScreenLoading />;\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={isShowChangeNameDialog} onClose={closeChangeName}>\r\n        <DialogTitle>更改用户名</DialogTitle>\r\n        <DialogContent>\r\n          <TextField\r\n            fullWidth\r\n            type=\"text\"\r\n            placeholder=\"用户名\"\r\n            value={changedUsername}\r\n            onChange={updateUsername}\r\n          />\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button\r\n            disabled={changedUsername.trim().length === 0}\r\n            onClick={confirmChangeUsername}\r\n          >\r\n            确定\r\n          </Button>\r\n          <Button onClick={closeChangeName}>取消</Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n      <div className=\"user-info\">\r\n        <Card>\r\n          <CardHeader\r\n            title={\r\n              <span style={{ color: '#000' }}>你好，{user.username}！</span>\r\n            }\r\n            subheader={`登陆于${new Date().toLocaleTimeString()}`}\r\n            avatar={<Avatar>{user.username[0]}</Avatar>}\r\n            action={\r\n              <IconButton onClick={openChangeNameModal}>\r\n                <MoreIcon />\r\n              </IconButton>\r\n            }\r\n          ></CardHeader>\r\n        </Card>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import React, { useState, useCallback } from 'react';\r\nimport {\r\n  AppBar,\r\n  Toolbar,\r\n  Typography,\r\n  Button,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogActions,\r\n  DialogContent,\r\n  TextField,\r\n  IconButton,\r\n} from '@material-ui/core';\r\nimport {\r\n  SearchOutlined as SearchIcon,\r\n  Add as PlusIcon,\r\n} from '@material-ui/icons';\r\nimport { useDispatch } from 'react-redux';\r\nimport { push } from 'connected-react-router';\r\n\r\nimport { createHandleOnKeyEnterUp } from '@client/util/helper';\r\n\r\nconst GameLobbyHeader = React.memo(function GameLobbyHeader() {\r\n  const dispatch = useDispatch();\r\n\r\n  const [isShowFindRoom, setIsShowFindRoom] = useState(false);\r\n  const closeFindRoom = useCallback(() => setIsShowFindRoom(false), [\r\n    setIsShowFindRoom,\r\n  ]);\r\n\r\n  const [roomId, setRoomId] = useState('');\r\n  const jumoToFindRoom = useCallback(() => {\r\n    if (roomId.trim().length === 0) return;\r\n    dispatch(push(`/room/${roomId}`));\r\n  }, [roomId, dispatch]);\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={isShowFindRoom} onClose={closeFindRoom}>\r\n        <DialogTitle>查找房间</DialogTitle>\r\n        <DialogContent>\r\n          <TextField\r\n            fullWidth\r\n            type=\"text\"\r\n            placeholder=\"房间号\"\r\n            value={roomId}\r\n            onChange={evt => setRoomId(evt.target.value.trim())}\r\n            onKeyUp={createHandleOnKeyEnterUp(jumoToFindRoom)}\r\n          />\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button\r\n            disabled={roomId.trim().length === 0}\r\n            onClick={jumoToFindRoom}\r\n          >\r\n            确定\r\n          </Button>\r\n          <Button onClick={closeFindRoom}>取消</Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n      <AppBar\r\n        style={{\r\n          boxShadow: 'none',\r\n        }}\r\n        position=\"static\"\r\n      >\r\n        <Toolbar>\r\n          <IconButton color=\"default\" onClick={() => setIsShowFindRoom(true)}>\r\n            <SearchIcon />\r\n          </IconButton>\r\n          <Typography\r\n            style={{\r\n              flex: 1,\r\n              textAlign: 'center',\r\n            }}\r\n          >\r\n            你画我猜-游戏大厅\r\n          </Typography>\r\n          <IconButton onClick={() => dispatch(push('/create-room'))}>\r\n            <PlusIcon />\r\n          </IconButton>\r\n        </Toolbar>\r\n      </AppBar>\r\n    </>\r\n  );\r\n});\r\n\r\nexport default GameLobbyHeader;\r\n","import { useEffect, useRef } from 'react';\r\n\r\nexport function useDocumentTitle(title: string) {\r\n  const prevTitleRef = useRef('');\r\n  useEffect(() => {\r\n    prevTitleRef.current = document.title;\r\n    document.title = title;\r\n    return () => {\r\n      document.title = prevTitleRef.current;\r\n    }\r\n  }, [title]);\r\n}\r\n","import React, { useEffect } from 'react';\r\nimport { useDispatch, useSelector, shallowEqual } from 'react-redux';\r\n\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport { globalEffects } from '@client/store/effects';\r\nimport FullScreenLoading from '@client/ui/FullScreenLoading';\r\n\r\nimport RoomList from './components/RoomList';\r\nimport AccountCard from './components/AccountCard';\r\nimport GameLobbyHeader from './components/GameLobbyHeader';\r\n\r\nimport './index.scss';\r\nimport { useDocumentTitle } from '@client/hooks';\r\n\r\nconst indexSelector = ({\r\n  global: { numberOfOnlinePlayer },\r\n  user: { user },\r\n}: IReduxState) => ({\r\n  numberOfOnlinePlayer,\r\n  user,\r\n});\r\n\r\nexport default function GameLobby() {\r\n  useDocumentTitle('游戏大厅');\r\n\r\n  const { numberOfOnlinePlayer, user } = useSelector(\r\n    indexSelector,\r\n    shallowEqual,\r\n  );\r\n  const dispatch = useDispatch();\r\n  useEffect(() => {\r\n    dispatch(globalEffects.getNumberOfOnlinePlayer());\r\n  }, [dispatch]);\r\n\r\n\r\n  if (user == null) return <FullScreenLoading />;\r\n\r\n  return (\r\n    <div className=\"view-game-lobby\">\r\n      <div className=\"view-game-lobby-header\">\r\n        <GameLobbyHeader />\r\n      </div>\r\n      <div className=\"view-game-lobby-main\">\r\n        <AccountCard />\r\n        <div className=\"room-list-wrapper\">\r\n          <RoomList />\r\n        </div>\r\n      </div>\r\n      <div className=\"view-game-lobby-footer\">\r\n        <div className=\"number-of-online-player\">\r\n          当前在线人数: {numberOfOnlinePlayer}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { IconButton, Snackbar } from '@material-ui/core';\r\nimport { Close as CloseIcon } from '@material-ui/icons';\r\nimport { globalActions } from '@client/store/actions';\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport React, { useCallback } from 'react';\r\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\r\n\r\nconst selectorNotificationPanel = ({ global: { notifications } }: IReduxState) => ({\r\n  notifications,\r\n});\r\n\r\nconst NotificationPanel = React.memo(function NotificationPanel() {\r\n  const { notifications } = useSelector(selectorNotificationPanel, shallowEqual);\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  const shiftNotification = useCallback(() => {\r\n    dispatch(globalActions.createShiftNotification());\r\n  }, [dispatch]);\r\n\r\n\r\n  return (\r\n    <>\r\n    {notifications.map(n => (\r\n      <Snackbar\r\n      key={n.id}\r\n      anchorOrigin={{ vertical: 'top', horizontal: 'center' }}\r\n      // key={`${vertical},${horizontal}`}\r\n      open={true}\r\n      onClose={shiftNotification}\r\n      autoHideDuration={4000}\r\n      action={\r\n        <IconButton onClick={shiftNotification} key=\"close\" aria-label=\"close\" color=\"inherit\">\r\n          <CloseIcon />\r\n        </IconButton>\r\n      }\r\n      message={<span>{n.detail == null ? n.title : `${n.title}-${n.detail}`}</span>}\r\n    />\r\n    ))}\r\n    </>\r\n  );\r\n});\r\n\r\nexport default NotificationPanel;\r\n","import './index.scss';\r\n\r\nimport { useDocumentTitle } from '@client/hooks';\r\nimport { globalEffects, roomEffects } from '@client/store/effects';\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport {\r\n  AppBar,\r\n  Button,\r\n  FormControl,\r\n  FormControlLabel,\r\n  List,\r\n  ListItem,\r\n  Radio,\r\n  RadioGroup,\r\n  TextField,\r\n  Toolbar,\r\n  Typography,\r\n} from '@material-ui/core';\r\nimport { ArrowBackOutlined as BackIcon } from '@material-ui/icons';\r\nimport { goBack } from 'connected-react-router';\r\nimport React, { ChangeEvent, useCallback, useEffect, useState } from 'react';\r\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\r\nimport { RoomType } from '../../../../shared/constants/room';\r\n\r\nconst indexSelector = ({\r\n  global: { numberOfOnlinePlayer },\r\n  user: { user },\r\n}: IReduxState) => ({\r\n  numberOfOnlinePlayer,\r\n  username: user == null ? '' : user.username,\r\n});\r\n\r\nexport default function CreateRoom() {\r\n  useDocumentTitle('创建房间');\r\n\r\n  const { username } = useSelector(indexSelector, shallowEqual);\r\n  const defaultRoomName = `${username}的房间`;\r\n  const [roomName, setRoomName] = useState(defaultRoomName);\r\n  const [roomType, setRoomType] = useState(RoomType.PUBLIC);\r\n\r\n  const dispatch = useDispatch();\r\n  useEffect(() => {\r\n    dispatch(globalEffects.getNumberOfOnlinePlayer());\r\n  }, [dispatch]);\r\n\r\n  const createRoom = useCallback(() => {\r\n    dispatch(roomEffects.createRoom(roomName, roomType));\r\n  }, [roomName, roomType, dispatch]);\r\n\r\n  const [isUsingDefaultRoomName, setIsUsingDefaultRoomName] = useState(true);\r\n  const updateRoomName = useCallback((evt: ChangeEvent<HTMLInputElement>) => {\r\n    setIsUsingDefaultRoomName(false);\r\n    setRoomName(evt.target.value);\r\n  }, [setRoomName, setIsUsingDefaultRoomName]);\r\n\r\n\r\n  return (\r\n    <div className=\"view-room-creator\">\r\n      <div className=\"view-room-creator-header\">\r\n        <AppBar\r\n          style={{\r\n            boxShadow: 'none',\r\n          }}\r\n          position=\"static\"\r\n        >\r\n          <Toolbar>\r\n            <Button onClick={() => dispatch(goBack())} color=\"inherit\">\r\n              <BackIcon />\r\n              返回\r\n            </Button>\r\n            <Typography\r\n              style={{\r\n                flex: 1,\r\n                textAlign: 'center',\r\n              }}\r\n            >\r\n              创建房间\r\n            </Typography>\r\n          </Toolbar>\r\n        </AppBar>\r\n      </div>\r\n      <div className=\"view-room-creator-main\">\r\n        <FormControl fullWidth>\r\n          <List>\r\n            <ListItem>\r\n              <TextField\r\n                label=\"房间名\"\r\n                fullWidth\r\n                placeholder=\"请输入房间名字\"\r\n                type=\"text\"\r\n                variant=\"outlined\"\r\n                value={isUsingDefaultRoomName ? defaultRoomName : roomName}\r\n                onChange={updateRoomName}\r\n              />\r\n            </ListItem>\r\n            <RadioGroup\r\n              value={roomType}\r\n              onChange={evt => setRoomType(evt.target.value as RoomType)}\r\n              name=\"room-type\"\r\n            >\r\n              <ListItem button onClick={() => setRoomType(RoomType.PUBLIC)}>\r\n                <FormControlLabel\r\n                  value={RoomType.PUBLIC}\r\n                  control={<Radio color=\"primary\" />}\r\n                  label=\"公开\"\r\n                  labelPlacement=\"end\"\r\n                />\r\n              </ListItem>\r\n              <ListItem button onClick={() => setRoomType(RoomType.PRIVATE)}>\r\n                <FormControlLabel\r\n                  value={RoomType.PRIVATE}\r\n                  control={<Radio color=\"primary\" />}\r\n                  label=\"私人(不显示在游戏大厅)\"\r\n                  labelPlacement=\"end\"\r\n                />\r\n              </ListItem>\r\n            </RadioGroup>\r\n            <ListItem>\r\n              <Button onClick={createRoom} fullWidth variant=\"outlined\">\r\n                创建房间\r\n              </Button>\r\n            </ListItem>\r\n          </List>\r\n        </FormControl>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","export * from './room';\r\n\r\nexport enum ReservedEventName { // 会用到的事件名，这里前后端统一调用这里的，避免字符串拼错什么的\r\n  REFRESH_USER = 'refreshUser',\r\n  REFRESH_ROOM = 'refreshRoom',\r\n  REFRESH_ROOM_LIST = 'refreshRoomList',\r\n  ROOM_CHATTING = 'roomChatting',\r\n  // 游戏相关\r\n  TIMEOUT = 'timeout',\r\n  REFRESH_GAME = 'refreshGame',\r\n  DRAW_ACTION = 'drawAction',\r\n  START_GAME = 'startGame',\r\n  GAME_CHATTING = 'gameChatting',\r\n  CHANGE_DRAWER = 'changeDrawer',\r\n  ROUND_OVER = 'roundOver',\r\n  GAME_OVER = 'gameOver',\r\n  PLAY_OVER = 'playOver',\r\n  // REFRESH_ONLINE_USER_NUMBER = 'refreshOnLineUserNumber',\r\n}\r\n","import './index.scss';\r\n\r\nimport { roomEffects } from '@client/store/effects';\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport { createHandleOnKeyEnterUp } from '@client/util/helper';\r\nimport wsClient from '@client/WebsocketClient/wsClient';\r\nimport { Button, List, ListItem, TextField } from '@material-ui/core';\r\nimport React, { useCallback, useEffect, useState } from 'react';\r\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\r\n\r\nimport ChattingMessage from '../../../../../../shared/models/ChattingMessage';\r\nimport { ReservedEventName } from '../../../../../../shared/constants';\r\n\r\nconst selectorRoomMessage = ({\r\n  user: { user },\r\n}: IReduxState) => ({\r\n  username: user == null ? '' : user.username,\r\n  userId: user == null ? '' : user.id,\r\n});\r\n\r\nfunction RoomChatting() {\r\n  const { userId } = useSelector(\r\n    selectorRoomMessage,\r\n    shallowEqual,\r\n  );\r\n  const [chatMsgList, setChatMsgList] = useState<ChattingMessage[]>([]);\r\n  useEffect(() => {\r\n    const offReciveChatMessage = wsClient.on(ReservedEventName.ROOM_CHATTING, (_, msg) => {\r\n      const chatMsg = msg.data as ChattingMessage;\r\n      setChatMsgList(prev => [chatMsg].concat(...prev));\r\n    });\r\n    return offReciveChatMessage;\r\n  }, [setChatMsgList]);\r\n\r\n  // chat msg 相关\r\n\r\n  const [msgContent, setMsgContent] = useState('');\r\n  const isValidatedContentt = msgContent.trim().length !== 0;\r\n  const dispatch = useDispatch();\r\n  const sendChatMessage = useCallback(() => {\r\n    if (!isValidatedContentt) return;\r\n    setMsgContent('');\r\n    dispatch(roomEffects.sendChatMessage(msgContent));\r\n  }, [isValidatedContentt, msgContent, dispatch, setMsgContent]);\r\n\r\n  return (\r\n    <div className=\"room-message\">\r\n      <List className=\"room-message-list\">\r\n        {chatMsgList.map(cm => (\r\n          <ListItem className=\"room-message-list-item\" key={cm.id}>\r\n            <div className=\"room-message-speaker\">\r\n              <span className=\"room-message-speaker-name\">\r\n                {cm.speaker.id === userId ? '我' : cm.speaker.name}:\r\n              </span>\r\n\r\n            </div>\r\n            <div className=\"room-message-content\">{cm.content}</div>\r\n            <div className=\"room-message-speaker-time\">\r\n              {new Date(cm.timestamp).toLocaleTimeString()}\r\n            </div>\r\n          </ListItem>\r\n        ))}\r\n      </List>\r\n      <List className=\"room-message-sender\">\r\n        <ListItem>\r\n          <TextField\r\n            variant=\"outlined\"\r\n            value={msgContent}\r\n            onChange={evt => setMsgContent(evt.target.value)}\r\n            onKeyUp={createHandleOnKeyEnterUp(sendChatMessage)}\r\n            fullWidth\r\n          />\r\n          &nbsp;\r\n          <Button\r\n            onClick={sendChatMessage}\r\n            disabled={!isValidatedContentt}\r\n            variant=\"text\"\r\n          >\r\n            发送\r\n          </Button>\r\n        </ListItem>\r\n      </List>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default RoomChatting;\r\n","import { useDocumentTitle } from '@client/hooks';\r\nimport { roomEffects } from '@client/store/effects';\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport { AppBar, Button, Toolbar, Typography } from '@material-ui/core';\r\nimport { ArrowBackOutlined as BackIcon } from '@material-ui/icons';\r\nimport React from 'react';\r\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\r\n\r\nimport { RoomType } from '../../../../../shared/constants';\r\n\r\n// import { IGame, IRoom, IUser } from 'shared/types';\r\n\r\nconst selectorPlayingRoom = ({ room: { currentRoom } }: IReduxState) => ({\r\n  roomId: currentRoom ? currentRoom.id : -1,\r\n  roomName: currentRoom ? currentRoom.name : '',\r\n  roomType: currentRoom ? currentRoom.type : RoomType.PUBLIC,\r\n});\r\n\r\nconst roomTypeTextMapping = {\r\n  [RoomType.PRIVATE]: '(私人)',\r\n  [RoomType.PUBLIC]: '',\r\n};\r\n\r\nconst RoomHeader = React.memo(function RoomHeader() {\r\n  useDocumentTitle('房间');\r\n  const { roomName, roomType, roomId } = useSelector(\r\n    selectorPlayingRoom,\r\n    shallowEqual,\r\n  );\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  return (\r\n    <AppBar\r\n      style={{\r\n        boxShadow: 'none',\r\n      }}\r\n      position=\"static\"\r\n    >\r\n      <Toolbar>\r\n        <Button\r\n          onClick={() => {\r\n            console.log('cliuck');\r\n            dispatch(roomEffects.leaveRoom());\r\n          }}\r\n          color=\"inherit\"\r\n        >\r\n          <BackIcon />\r\n          离开房间\r\n        </Button>\r\n        <Typography\r\n          style={{\r\n            flex: 1,\r\n            textAlign: 'center',\r\n          }}\r\n        >\r\n          {roomName}\r\n          {roomTypeTextMapping[roomType]}\r\n        </Typography>\r\n        <Button color=\"inherit\">\r\n          房间号: {String(roomId).padStart(5, '0')}\r\n        </Button>\r\n      </Toolbar>\r\n    </AppBar>\r\n  );\r\n});\r\n\r\nexport default RoomHeader;\r\n","import './index.scss';\r\n\r\nimport React from 'react';\r\nimport { shallowEqual, useSelector } from 'react-redux';\r\nimport { IReduxState } from 'store/reducers';\r\n\r\nimport { IUser } from '../../../../../../shared/types';\r\n\r\nconst arrOfEight = new Array(8).fill(null);\r\n\r\nconst selectorUserList = ({ user: { user } }: IReduxState) => ({\r\n  userId: user ? user.id : '',\r\n});\r\n\r\nconst UserList = React.memo(function UserList({ users }: { users: IUser[] }) {\r\n  const { userId } = useSelector(selectorUserList, shallowEqual);\r\n  return (\r\n    <div className=\"user-list\">\r\n      {arrOfEight.map((_, index) => {\r\n        if (index < users.length) {\r\n          const user = users[index];\r\n          return (\r\n            <div key={user.id} className=\"player-list-item active\">\r\n              <div className=\"user-status\">\r\n                {user.id === userId ? (\r\n                  <div className=\"player-list-item-status\">我</div>\r\n                ) : null}\r\n                {user.isReady ? (\r\n                  <div className=\"player-list-item-status\">已准备</div>\r\n                ) : null}\r\n                {user && index === 0 ? (\r\n                  <div className=\"player-list-item-status\">房主</div>\r\n                ) : null}\r\n                <div className=\"user-avatar\">{user.username[0]}</div>\r\n              </div>\r\n              <div className=\"player-list-item-username\">{user.username}</div>\r\n            </div>\r\n          );\r\n        }\r\n        return (\r\n          <div key={index} className=\"player-list-item\">\r\n            <div className=\"user-status\">\r\n              <div className=\"user-avatar\">空</div>\r\n            </div>\r\n            <div className=\"player-list-item-username\">等待加入</div>\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default UserList;\r\n","import './index.scss';\r\n\r\nimport { useDocumentTitle } from '@client/hooks';\r\nimport { roomActions, userActions } from '@client/store/actions';\r\nimport { roomEffects } from '@client/store/effects';\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport FullScreenLoading from '@client/ui/FullScreenLoading';\r\nimport wsClient from '@client/WebsocketClient/wsClient';\r\nimport { Button } from '@material-ui/core';\r\nimport React, { useCallback, useEffect } from 'react';\r\nimport { batch as batchDispatch, shallowEqual, useDispatch, useSelector } from 'react-redux';\r\nimport { Redirect, useParams } from 'react-router-dom';\r\n\r\nimport { ReservedEventName } from '../../../../shared/constants';\r\nimport { RoomStatus } from '../../../../shared/constants/room';\r\nimport { IGame, IRoom, IUser } from '../../../../shared/types';\r\nimport RoomChatting from './components/RoomChatting';\r\nimport RoomHeader from './components/RoomHeader';\r\nimport UserList from './components/UserList';\r\n\r\n// import { IGame, IRoom, IUser } from 'shared/types';\r\n\r\nconst selectorPlayingRoom = ({\r\n  room: { currentRoom },\r\n  user: { user },\r\n}: IReduxState) => ({\r\n  currentRoom,\r\n  isReady: user == null ? false : user.isReady,\r\n});\r\n\r\n// const roomTypeTextMapping = {\r\n//   [RoomType.PRIVATE]: '(私人)',\r\n//   [RoomType.PUBLIC]: '',\r\n// };\r\n\r\nexport default function PlayingRoom() {\r\n  useDocumentTitle('房间');\r\n  const { currentRoom, isReady } = useSelector(\r\n    selectorPlayingRoom,\r\n    shallowEqual,\r\n  );\r\n\r\n  const { roomId: rawRoomId } = useParams<{ roomId: string }>();\r\n  const roomId = parseInt(rawRoomId, 10);\r\n\r\n  const dispatch = useDispatch();\r\n  const toggleGameReady = useCallback(() => {\r\n    dispatch(roomEffects.makeGameIsReady(!isReady));\r\n  }, [isReady, dispatch]);\r\n\r\n  useEffect(() => {\r\n    const refreshRoomInfoOff = wsClient.on(ReservedEventName.REFRESH_ROOM, (_, msg) => {\r\n      const room = msg.data as IRoom;\r\n      dispatch(roomActions.createSetRoom(room));\r\n    });\r\n    const startGameOff = wsClient.on(ReservedEventName.START_GAME, (_, msg) => {\r\n      const { user, game } = msg.data as {\r\n        user: IUser,\r\n        game: IGame,\r\n      };\r\n      batchDispatch(() => {\r\n        dispatch(roomActions.createSetCurrentGame(game));\r\n        dispatch(roomActions.createSetCurrentRoomStatus(RoomStatus.GAMING));\r\n        dispatch(userActions.createSetIsGaming(user.isGaming));\r\n        dispatch(userActions.createSetIsReady(user.isReady));\r\n      })\r\n    });\r\n    return () => {\r\n      refreshRoomInfoOff();\r\n      startGameOff();\r\n    };\r\n  }, [roomId, dispatch]);\r\n\r\n  useEffect(() => {\r\n    if (Number.isNaN(roomId)) return;\r\n    dispatch(roomEffects.enterRoom(roomId));\r\n  }, [dispatch, roomId]);\r\n\r\n  if (rawRoomId == null) return <Redirect to=\"/\" />;\r\n  if (currentRoom == null) return <FullScreenLoading />;\r\n\r\n  return (\r\n    <div className=\"view-playing-room\">\r\n      <div className=\"view-playing-room-header\">\r\n        <RoomHeader />\r\n      </div>\r\n      <div className=\"view-playing-room-main\">\r\n        <UserList users={currentRoom.users} />\r\n        <div className=\"start-game-button-wrapper\">\r\n          <Button onClick={toggleGameReady} className=\"start-game-button\" variant=\"outlined\" fullWidth>\r\n            {isReady ? '取消准备' : '准备'}\r\n          </Button>\r\n        </div>\r\n        <div className=\"room-message-wrapper\">\r\n          <RoomChatting />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useEffect } from 'react';\r\nimport { useDispatch, useSelector, shallowEqual } from 'react-redux';\r\nimport { replace } from 'connected-react-router';\r\nimport { IReduxState } from '../store/reducers';\r\nimport FullScreenLoading from '../ui/FullScreenLoading';\r\nimport { userEffects } from '../store/effects';\r\n\r\nconst selectorAuthLoyout = ({ user: { user }, router: { location: { pathname } } }: IReduxState) => ({\r\n  user,\r\n  pathname,\r\n});\r\n\r\nexport default function AuthLoyout({ children}: {children: any}) {\r\n\r\n  const { user, pathname } = useSelector(selectorAuthLoyout, shallowEqual);\r\n\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    if (user == null) {\r\n      dispatch(userEffects.login());\r\n      return;\r\n    }\r\n\r\n    if (user.isGaming && user.currentRoomId == null) {\r\n      console.error('用户正在游戏中', '但找不到房间号');\r\n    }\r\n\r\n    if (user.isGaming && user.currentRoomId != null) {\r\n      const targetPath = `/game/${user.currentRoomId}`;\r\n      if (pathname !== targetPath) dispatch(replace(targetPath));\r\n    } else if (user.currentRoomId != null) {\r\n      const targetPath = `/room/${user.currentRoomId}`;\r\n      if (pathname !== targetPath) dispatch(replace(targetPath));\r\n    }\r\n  }, [user, pathname, dispatch]);\r\n\r\n  if (user == null) return <FullScreenLoading />\r\n\r\n  return children;\r\n}\r\n","import React from 'react';\r\n\r\nimport './index.scss';\r\n\r\nfunction AvatarStatus({ text }: { text: string }) {\r\n  return <div className=\"user-avatar-status\">{text}</div>;\r\n}\r\nReact.createElement(AvatarStatus);\r\nfunction UserAvatar({ children, avatar }: { children: any; avatar: string }) {\r\n  return (\r\n    <div\r\n      style={{\r\n        height: 64,\r\n        width: 64,\r\n      }}\r\n      className=\"user-avatar-wrapper\"\r\n    >\r\n      {children}\r\n      <div style={{\r\n        backgroundColor: 'orange'\r\n      }} className=\"user-avatar\">{avatar}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nUserAvatar.AvatarStatus = AvatarStatus;\r\n\r\nexport default UserAvatar;\r\n","import React, { useCallback, useState } from 'react';\r\nimport { TextField, Button } from '@material-ui/core';\r\n\r\nimport './index.scss';\r\nimport WebsocketClient from '@client/WebsocketClient';\r\nimport RequestMessage from '../../../../../../shared/models/RequestMessage';\r\n\r\n// 以 375宽 为标准\r\n\r\nfunction AnswerInputBox({ wsClient }: {\r\n  wsClient: WebsocketClient,\r\n}) {\r\n\r\n  const [answer, setAnswer] = useState('');\r\n\r\n  const sendGuessAnswer = useCallback(() => {\r\n    if (answer.length === 0) return;\r\n    const reqMsg = new RequestMessage(answer, 'guessAnswer');\r\n    wsClient.sendMessage(reqMsg);\r\n    setAnswer('');\r\n  }, [answer, wsClient, setAnswer]);\r\n\r\n  return (\r\n    <div className=\"answer-input-box\">\r\n      <TextField value={answer} onChange={evt => setAnswer(evt.target.value.trim())} placeholder=\"答案\" className=\"answer-input\" variant=\"outlined\" type=\"text\" />\r\n      <Button disabled={answer.length === 0} variant=\"outlined\" onClick={sendGuessAnswer}>发送</Button>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default AnswerInputBox;\r\n","export enum DrawActionType {\r\n  START_DRAW_LINE = 'startDrawLine',\r\n  DRAW_LINE_TO = 'drawLineTo',\r\n  END_DRAW_LINE = 'endDrawLine',\r\n  DRAW_IMAGE = 'drawImage',\r\n  CLEAR_CANVAS = 'clearCanvas',\r\n  // SET_OPTIONS = 'setOptions',\r\n}\r\n\r\n\r\nexport default class DrawAction {\r\n  constructor(public type: DrawActionType, public payload?: any) {}\r\n}\r\n","import Point from './Point';\r\n\r\nexport interface ICanvasControllerSetting {\r\n  penSize?: number;\r\n  penColor?: string;\r\n}\r\n\r\nexport default class CanvasController {\r\n  public ctx: CanvasRenderingContext2D;\r\n  public canvasEl: HTMLCanvasElement;\r\n  get penColor() {\r\n    return this.ctx.strokeStyle as string;\r\n  }\r\n  set penColor(color: string) {\r\n    this.ctx.strokeStyle = color;\r\n    this.ctx.fillStyle = color;\r\n  }\r\n  get penSize() {\r\n    return this.ctx.lineWidth;\r\n  }\r\n  set penSize(size: number) {\r\n    this.ctx.lineWidth = size;\r\n  }\r\n  constructor(canvasEl?: HTMLCanvasElement, options?: {\r\n    penColor?: string;\r\n    penSize?: number;\r\n  }) {\r\n    this.canvasEl =\r\n      canvasEl == null ? document.createElement('canvas') : canvasEl;\r\n    this.ctx = this.canvasEl.getContext('2d') as CanvasRenderingContext2D;\r\n    this.init();\r\n    if (options != null) {\r\n      if (options.penColor != null) this.setPenColor(options.penColor);\r\n      if (options.penSize != null) this.setPenSize(options.penSize);\r\n    }\r\n  }\r\n\r\n  init() {\r\n    this.ctx.fillStyle = this.penColor;\r\n    this.ctx.strokeStyle = this.penColor;\r\n    this.ctx.lineWidth = this.penSize;\r\n  }\r\n\r\n  // new\r\n\r\n  getSetting(): Required<ICanvasControllerSetting> {\r\n    return {\r\n      penSize: this.penSize,\r\n      penColor: this.penColor,\r\n    }\r\n  }\r\n\r\n  setting(s: ICanvasControllerSetting) {\r\n    if (s.penColor != null) this.penColor = s.penColor;\r\n    if (s.penSize != null) this.penSize = s.penSize;\r\n  }\r\n\r\n  drawImage(image: HTMLImageElement | string) {\r\n    // console.log('image', image);\r\n    if (typeof image === 'string') {\r\n      const img = new Image();\r\n      img.onload = () => {\r\n        this.clearCanvas();\r\n        this.drawImage(img);\r\n      };\r\n      img.src = image;\r\n    } else {\r\n      this.ctx.drawImage(image, 0, 0);\r\n    }\r\n  }\r\n\r\n  drawPoint(to: Point, r: number = this.penSize / 2) {\r\n    const { ctx } = this;\r\n    console.log('drawPoint', 'r',r , 'lineWidth', this.ctx.lineWidth);\r\n    ctx.beginPath();\r\n    ctx.arc(to.x, to.y, r, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    // ctx.stroke();\r\n    ctx.closePath();\r\n  }\r\n\r\n  getSnapshot() {\r\n    return this.canvasEl.toDataURL('image/jpeg', 1);\r\n  }\r\n\r\n  startDrawLine(startPoint: Point) {\r\n    const sp = startPoint;\r\n    const { ctx } = this;\r\n    ctx.beginPath();\r\n    ctx.moveTo(sp.x, sp.y);\r\n  }\r\n\r\n  drawLineTo(to: Point) {\r\n    // console.log('to', to);\r\n    const { ctx } = this;\r\n    ctx.lineTo(to.x, to.y);\r\n    ctx.stroke();\r\n  }\r\n\r\n  mount(elementSelector: string) {\r\n    const el = document.querySelector(elementSelector);\r\n    // (window as any).el = el;\r\n    if (el != null) {\r\n      el.append(this.canvasEl);\r\n      this.canvasEl.height = el.clientHeight;\r\n      this.canvasEl.width = el.clientWidth;\r\n      this.clearCanvas();\r\n    } else {\r\n      throw new Error(`无法通过 ${elementSelector} 找到相应的元素，请确定选择器书写正确，或元素确实存在`);\r\n    }\r\n  }\r\n\r\n  clearCanvas() {\r\n    const prevFillStyle = this.ctx.fillStyle;\r\n    this.ctx.fillStyle = '#fff';\r\n    this.ctx.clearRect(0, 0, this.canvasEl.width, this.canvasEl.height);\r\n    this.ctx.fillRect(0, 0, this.canvasEl.width, this.canvasEl.height);\r\n    this.ctx.fillStyle = prevFillStyle;\r\n  }\r\n\r\n  // end new\r\n\r\n  setOptions(op: {\r\n    penColor?: string;\r\n    penSize?: number;\r\n  }) {\r\n    if (op.penColor != null) this.setPenColor(op.penColor);\r\n    if (op.penSize != null) this.setPenSize(op.penSize);\r\n  }\r\n\r\n  getOptions() {\r\n    return {\r\n      penColor: this.penColor,\r\n      penSize: this.penSize,\r\n    }\r\n  }\r\n\r\n  setPenSize(size: number) {\r\n    this.ctx.lineWidth = size;\r\n  }\r\n\r\n  setPenColor(color: string) {\r\n    this.ctx.strokeStyle = color;\r\n    this.ctx.fillStyle = color;\r\n  }\r\n\r\n\r\n}\r\n","import React, { useCallback, useState } from 'react';\r\nimport { IconButton, Popover } from '@material-ui/core';\r\nimport {\r\n  ColorLens as ColorIcon,\r\n  FiberManualRecord as CircleIcon,\r\n} from '@material-ui/icons';\r\n\r\nimport CanvasController from '@client/controller/CanvasController';\r\n\r\nconst colors = [\r\n  '#000',\r\n  '#F44336',\r\n  '#E91E63',\r\n  '#9C27B0',\r\n  '#2196F3',\r\n  '#48C6FF',\r\n  '#4CAF50',\r\n  '#8BC34A',\r\n  '#FFEB3B',\r\n  '#FFC107',\r\n  '#FF9800',\r\n  '#795548',\r\n  '#607D8B',\r\n  '#666',\r\n  '#999',\r\n  '#BBB',\r\n  '#DDD',\r\n  '#FFF',\r\n];\r\n\r\nexport default function SetPenColorButton({\r\n  anchorEl,\r\n  penColor,\r\n  setPenColor,\r\n}: {\r\n  draw: CanvasController;\r\n  anchorEl: Element | null;\r\n  penColor: string;\r\n  setPenColor: (color: string) => void;\r\n}) {\r\n  const [isShowSetPenColor, setIsShowSetPenColor] = useState(false);\r\n  const updatePenColor = useCallback(\r\n    (color: string) => {\r\n      setPenColor(color);\r\n      setIsShowSetPenColor(false);\r\n    },\r\n    [setPenColor, setIsShowSetPenColor],\r\n  );\r\n\r\n\r\n  return (\r\n    <>\r\n      <IconButton\r\n        style={{\r\n          flex: '1',\r\n        }}\r\n        onClick={() => setIsShowSetPenColor(prev => !prev)}\r\n        className=\"canvas-operation-list-item\"\r\n      >\r\n        <ColorIcon style={{\r\n          color: penColor,\r\n        }} fontSize=\"large\" />\r\n      </IconButton>\r\n      <Popover\r\n        anchorOrigin={{\r\n          vertical: 'top',\r\n          horizontal: 'center',\r\n        }}\r\n        transformOrigin={{\r\n          vertical: 'bottom',\r\n          horizontal: 'center',\r\n        }}\r\n        anchorEl={anchorEl}\r\n        onClose={() => setIsShowSetPenColor(false)}\r\n        open={isShowSetPenColor}\r\n      >\r\n        <div className=\"pen-color-wrapper\">\r\n          {colors.map(color => (\r\n            <IconButton onClick={() => updatePenColor(color)} key={color}>\r\n              <CircleIcon style={{\r\n                border: '1px solid #000',\r\n                color,\r\n              }} />\r\n            </IconButton>\r\n          ))}\r\n        </div>\r\n      </Popover>\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport default function PlainLine(props: {\r\n  length?: number;\r\n  width?: number;\r\n  vertical?: boolean;\r\n  color?: string;\r\n}) {\r\n  let { length, width, vertical, color  } = props;\r\n  if (length == null) length = 24;\r\n  if (width == null) width = 2;\r\n  if (vertical == null) vertical = false;\r\n  if (color == null) color = '#000';\r\n  if (vertical) {\r\n    [length, width] = [width, length];\r\n  }\r\n  return (\r\n    <div\r\n      className=\"plain-line\"\r\n      style={{\r\n        height: width,\r\n        width: length,\r\n        backgroundColor: color,\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import React, { useCallback, useState } from 'react';\r\nimport { IconButton, Popover, Slider } from '@material-ui/core';\r\n\r\nimport PlainLine from '@client/ui/PlainLine';\r\n\r\nexport default function SetPenSizeButton({\r\n  anchorEl,\r\n  penColor,\r\n  penSize,\r\n  setPenSize,\r\n}: {\r\n  anchorEl: Element | null;\r\n  penSize: number;\r\n  setPenSize: (size: number) => void;\r\n  penColor: string;\r\n}) {\r\n  const updatePenSize = useCallback(\r\n    (_: any, value: number | number[]) => {\r\n      const size = value as number;\r\n      setPenSize(size);\r\n    },\r\n    [setPenSize],\r\n  );\r\n  const [isShowSetPenSize, setIsShowSetPenSize] = useState(false);\r\n\r\n  return (\r\n    <>\r\n      <IconButton\r\n        style={{\r\n          flex: '1',\r\n        }}\r\n        onClick={() => setIsShowSetPenSize(prev => !prev)}\r\n        className=\"canvas-operation-list-item\"\r\n      >\r\n        <PlainLine color={penColor} length={30} width={penSize} />\r\n      </IconButton>\r\n      <Popover\r\n        anchorOrigin={{\r\n          vertical: 'top',\r\n          horizontal: 'center',\r\n        }}\r\n        transformOrigin={{\r\n          vertical: 'bottom',\r\n          horizontal: 'center',\r\n        }}\r\n        anchorEl={anchorEl == null ? undefined : anchorEl}\r\n        onClose={() => setIsShowSetPenSize(false)}\r\n        open={isShowSetPenSize}\r\n      >\r\n        <div className=\"pen-size-slider-wrapper\">\r\n          <Slider\r\n            style={{\r\n              width: '80vw',\r\n            }}\r\n            value={penSize}\r\n            onChange={updatePenSize}\r\n            valueLabelDisplay=\"auto\"\r\n            step={1}\r\n            marks\r\n            min={1}\r\n            max={20}\r\n          />\r\n        </div>\r\n      </Popover>\r\n    </>\r\n  );\r\n}\r\n","import './Canvas.scss';\r\n\r\nimport CanvasController, { ICanvasControllerSetting } from '@client/controller/CanvasController';\r\nimport Point from '@client/controller/Point';\r\nimport DrawAction, { DrawActionType } from '@client/model/DrawAction';\r\nimport { IconButton } from '@material-ui/core';\r\nimport { Redo as RedoIcon, RestoreFromTrash as ClearIcon, Undo as UndoIcon } from '@material-ui/icons';\r\nimport React, { TouchEvent, useCallback, useEffect, useLayoutEffect, useRef, useState } from 'react';\r\n\r\nimport { ReservedEventName } from '../../../../../../shared/constants';\r\nimport RequestMessage from '../../../../../../shared/models/RequestMessage';\r\nimport wsClient from '../../../../../WebsocketClient/wsClient';\r\nimport SetPenColorButton from './SetPenColorButton';\r\nimport SetPenSizeButton from './SetPenSizeButton';\r\n\r\n// import RequestMessage from '@client/WebsocketClient/models/RequestMessage';\r\n\r\nfunction sendDrawActionToServer(\r\n  type: DrawActionType,\r\n  payload?: unknown,\r\n  extral?: { newestDrawing?: string },\r\n) {\r\n  const drawAction = new DrawAction(type, payload);\r\n  const reqMsg = new RequestMessage(\r\n    {\r\n      drawAction,\r\n      ...(extral !== undefined ? extral : {}),\r\n    },\r\n    'drawAction',\r\n  );\r\n  wsClient.sendMessage(reqMsg);\r\n}\r\n\r\nfunction getPointFromEvent(evt: TouchEvent): Point {\r\n  // 获得相对画布左上角的坐标\r\n  const { touches, target } = evt;\r\n  const t = touches[0];\r\n  const { clientX, clientY } = t;\r\n  const result = {\r\n    x: clientX - (target as HTMLCanvasElement).offsetLeft,\r\n    y: clientY - (target as HTMLCanvasElement).offsetTop,\r\n  };\r\n  return result;\r\n}\r\n\r\nfunction Canvas({\r\n  isSelfPlaying,\r\n  initialDrawing,\r\n}: {\r\n  isSelfPlaying: boolean;\r\n  initialDrawing?: string;\r\n}) {\r\n  const drawRef = useRef(new CanvasController());\r\n  const draw = drawRef.current;\r\n  const [futureDrawings, setFutureDrawings] = useState<string[]>([]);\r\n  const [pastDrawings, setPastDrawings] = useState<string[]>([]);\r\n  const [penColor, setPenColor] = useState('#000');\r\n  const [penSize, setPenSize] = useState(1);\r\n  const isMountedRef = useRef(false);\r\n\r\n  // 生命周期\r\n\r\n  useLayoutEffect(() => {\r\n    if (isMountedRef.current === false) {\r\n      draw.mount('#id-canvas');\r\n      if (initialDrawing !== undefined) {\r\n        draw.drawImage(initialDrawing);\r\n      }\r\n      isMountedRef.current = true;\r\n    }\r\n  }, [draw, initialDrawing]);\r\n\r\n  useEffect(() => {\r\n    const changePlayingUserOff = wsClient.on(\r\n      ReservedEventName.CHANGE_DRAWER,\r\n      () => {\r\n        // 清除别人在画布上的东西\r\n        draw.clearCanvas();\r\n        setFutureDrawings([]);\r\n        setPastDrawings([]);\r\n      },\r\n    );\r\n\r\n    const drawActionOff = wsClient.on(\r\n      ReservedEventName.DRAW_ACTION,\r\n      respMsgData => {\r\n        const drawAction = respMsgData as DrawAction;\r\n        const { type, payload } = drawAction;\r\n        switch (type) {\r\n          case DrawActionType.START_DRAW_LINE:\r\n            {\r\n              const { point, setting } = payload as {\r\n                point: Point;\r\n                setting?: ICanvasControllerSetting;\r\n              };\r\n              let prevSetting = draw.getSetting();\r\n              if (setting != null) draw.setting(setting);\r\n              draw.drawPoint(point);\r\n              draw.startDrawLine(point);\r\n              draw.setting(prevSetting);\r\n            }\r\n            break;\r\n          case DrawActionType.DRAW_LINE_TO:\r\n            {\r\n              const { point, setting } = payload as {\r\n                point: Point;\r\n                setting?: ICanvasControllerSetting;\r\n              };\r\n              let prevSetting = draw.getSetting();\r\n              if (setting != null) draw.setting(setting);\r\n              draw.drawLineTo(point);\r\n              draw.setting(prevSetting);\r\n            }\r\n            break;\r\n          case DrawActionType.CLEAR_CANVAS:\r\n            draw.clearCanvas();\r\n            break;\r\n          case DrawActionType.DRAW_IMAGE:\r\n            {\r\n              const imgData = payload as string;\r\n              draw.drawImage(imgData);\r\n            }\r\n            break;\r\n        }\r\n      },\r\n    );\r\n    return () => {\r\n      changePlayingUserOff();\r\n      drawActionOff();\r\n    };\r\n  }, [draw, setFutureDrawings, setPastDrawings]);\r\n\r\n  // 绘图相关\r\n\r\n  const snapshotCurrentDrawing = useCallback(() => {\r\n    const curDrawing = draw.getSnapshot();\r\n    setPastDrawings(prev => prev.concat(curDrawing));\r\n  }, [draw]);\r\n\r\n  const startDrawLine = useCallback(\r\n    (p: Point) => {\r\n      if (futureDrawings.length !== 0) {\r\n        setFutureDrawings([]);\r\n      }\r\n      draw.drawPoint(p);\r\n      draw.startDrawLine(p);\r\n\r\n      sendDrawActionToServer(DrawActionType.START_DRAW_LINE, {\r\n        point: p,\r\n        setting: draw.getSetting(),\r\n      });\r\n    },\r\n    [draw, futureDrawings, setFutureDrawings],\r\n  );\r\n\r\n  const drawLineTo = useCallback(\r\n    (to: Point) => {\r\n      draw.drawLineTo(to);\r\n      sendDrawActionToServer(DrawActionType.DRAW_LINE_TO, {\r\n        point: to,\r\n        setting: draw.getSetting(),\r\n      });\r\n    },\r\n    [draw],\r\n  );\r\n\r\n  const clearCanvas = useCallback(() => {\r\n    snapshotCurrentDrawing();\r\n\r\n    draw.clearCanvas();\r\n    sendDrawActionToServer(DrawActionType.CLEAR_CANVAS, {\r\n      newestDrawing: draw.getSnapshot(),\r\n    });\r\n  }, [draw, snapshotCurrentDrawing]);\r\n\r\n  const undoDrawing = useCallback(() => {\r\n    if (pastDrawings.length === 0) return;\r\n    const pastDrawing = pastDrawings.pop() as string;\r\n    draw.drawImage(pastDrawing);\r\n    setPastDrawings([...pastDrawings]);\r\n    setFutureDrawings([...futureDrawings, draw.getSnapshot()]);\r\n    sendDrawActionToServer(DrawActionType.DRAW_IMAGE, pastDrawing, {\r\n      newestDrawing: pastDrawing,\r\n    });\r\n  }, [pastDrawings, futureDrawings, draw, setPastDrawings, setFutureDrawings]);\r\n\r\n  const redoDrawing = useCallback(() => {\r\n    if (futureDrawings.length === 0) return;\r\n\r\n    const futureDrawing = futureDrawings.pop() as string;\r\n    draw.drawImage(futureDrawing);\r\n    setPastDrawings([...pastDrawings, draw.getSnapshot()]);\r\n    setFutureDrawings([...futureDrawings]);\r\n    sendDrawActionToServer(DrawActionType.DRAW_IMAGE, futureDrawing, {\r\n      newestDrawing: futureDrawing,\r\n    });\r\n  }, [pastDrawings, futureDrawings, draw, setFutureDrawings, setPastDrawings]);\r\n\r\n  // event handler\r\n\r\n  const handleTouchStart = useCallback(\r\n    (evt: TouchEvent) => {\r\n      snapshotCurrentDrawing();\r\n\r\n      const p = getPointFromEvent(evt);\r\n      startDrawLine(p);\r\n    },\r\n    [snapshotCurrentDrawing, startDrawLine],\r\n  );\r\n\r\n  const handleTouchMove = useCallback(\r\n    (evt: TouchEvent) => {\r\n      const p = getPointFromEvent(evt);\r\n      drawLineTo(p);\r\n    },\r\n    [drawLineTo],\r\n  );\r\n\r\n  const handleTouchEnd = useCallback(() => {\r\n    sendDrawActionToServer(DrawActionType.END_DRAW_LINE, undefined, {\r\n      newestDrawing: draw.getSnapshot(),\r\n    }); // 同步最新画作到服务器上\r\n  }, [draw]);\r\n\r\n  const [posDivEl, setPosDivEl] = useState<HTMLDivElement | null>(null);\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"canvas-wrapper\">\r\n        <div\r\n          id=\"id-canvas\"\r\n          style={{\r\n            width: 375,\r\n            height: 300,\r\n          }}\r\n          onTouchStart={isSelfPlaying ? handleTouchStart : undefined}\r\n          onTouchMove={isSelfPlaying ? handleTouchMove : undefined}\r\n          onTouchEnd={isSelfPlaying ? handleTouchEnd : undefined}\r\n        />\r\n      </div>\r\n      {!isSelfPlaying ? null : (\r\n        <div ref={ref => setPosDivEl(ref)} className=\"game-canvas-operations\">\r\n          <SetPenColorButton\r\n            anchorEl={posDivEl}\r\n            draw={draw}\r\n            penColor={penColor}\r\n            setPenColor={(color: string) => {\r\n              draw.penColor = color;\r\n              setPenColor(color);\r\n            }}\r\n          />\r\n          <SetPenSizeButton\r\n            penSize={penSize}\r\n            penColor={penColor}\r\n            setPenSize={(size: number) => {\r\n              draw.penSize = size;\r\n              setPenSize(size);\r\n            }}\r\n            anchorEl={posDivEl}\r\n          />\r\n          <IconButton\r\n            disabled={pastDrawings.length === 0}\r\n            onClick={undoDrawing}\r\n            style={{ flex: '1' }}\r\n            className=\"canvas-operation-list-item\"\r\n          >\r\n            <UndoIcon fontSize=\"large\" />\r\n          </IconButton>\r\n          <IconButton\r\n            disabled={futureDrawings.length === 0}\r\n            style={{ flex: '1' }}\r\n            onClick={redoDrawing}\r\n            className=\"canvas-operation-list-item\"\r\n          >\r\n            <RedoIcon fontSize=\"large\" />\r\n          </IconButton>\r\n          <IconButton\r\n            style={{ flex: '1', color: '#000' }}\r\n            className=\"canvas-operation-list-item\"\r\n            onClick={clearCanvas}\r\n          >\r\n            <ClearIcon fontSize=\"large\" />\r\n          </IconButton>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default React.memo(Canvas);\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport {\r\n  AppBar,\r\n  Toolbar,\r\n  Typography,\r\n  Button,\r\n} from '@material-ui/core';\r\nimport { IGame } from '../../../../../shared/types';\r\nimport wsClient from '@client/WebsocketClient/wsClient';\r\nimport { ReservedEventName } from '../../../../../shared/constants';\r\n\r\nfunction GameHeader({\r\n  isSelfPlaying,\r\n  currentGame,\r\n}: {\r\n  isSelfPlaying: boolean;\r\n  currentGame: IGame;\r\n}) {\r\n  const [gameTimeSoFar, setGameTimeSoFar] = useState(currentGame.playInfo.time);\r\n  useEffect(() => {\r\n    // let startTime: number;\r\n    const timeoutOff = wsClient.on(ReservedEventName.TIMEOUT, msgData => {\r\n      const leftTimeForPlay = msgData as number;\r\n      setGameTimeSoFar(leftTimeForPlay);\r\n    });\r\n    return () => {\r\n      timeoutOff();\r\n    }\r\n  }, [setGameTimeSoFar])\r\n\r\n  return (\r\n    <AppBar\r\n      style={{\r\n        boxShadow: 'none',\r\n      }}\r\n      position=\"static\"\r\n    >\r\n      <Toolbar>\r\n        <Typography variant=\"h6\">\r\n          {isSelfPlaying\r\n            ? `请画 ${currentGame.playInfo.keyword.raw}`\r\n            : `${currentGame.playInfo.keyword.raw.length}个字 ${currentGame.playInfo.keyword.hint}`}\r\n        </Typography>\r\n          <Button>剩余:{gameTimeSoFar}秒</Button>\r\n      </Toolbar>\r\n    </AppBar>\r\n  );\r\n}\r\n\r\nexport default React.memo(GameHeader);\r\n","import './index.scss';\r\n\r\nimport { roomActions, userActions } from '@client/store/actions';\r\nimport { roomEffects } from '@client/store/effects';\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport FullScreenLoading from '@client/ui/FullScreenLoading';\r\nimport UserAvatar from '@client/ui/UserAvatar';\r\nimport wsClient from '@client/WebsocketClient/wsClient';\r\nimport {\r\n  AppBar,\r\n  Toolbar,\r\n  Typography,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  Button,\r\n} from '@material-ui/core';\r\nimport React, { useEffect, useMemo, useState } from 'react';\r\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\r\n\r\nimport { ReservedEventName } from '../../../../shared/constants';\r\nimport ChattingMessage from '../../../../shared/models/ChattingMessage';\r\nimport { IGame, IUser } from '../../../../shared/types';\r\nimport AnswerInputBox from './components/AnswerInputBox';\r\nimport CanvasContainer from './components/CanvasContainer';\r\nimport GameHeader from './components/GameHeader';\r\n\r\nconst selectorGame = ({\r\n  room: { currentGame },\r\n  user: { user },\r\n}: IReduxState) => ({\r\n  currentGame,\r\n  user,\r\n});\r\n\r\nexport default function Game() {\r\n  const { currentGame, user } = useSelector(selectorGame, shallowEqual);\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    if (currentGame == null) {\r\n      dispatch(roomEffects.getGame());\r\n    }\r\n  }, [currentGame, dispatch]);\r\n\r\n  const [chattingList, setChattingList] = useState<ChattingMessage[]>([]);\r\n  const [isShowPlayOverPanel, setIsShowPlayOverPanel] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const chattingMessageOff = wsClient.on(\r\n      ReservedEventName.GAME_CHATTING,\r\n      msgData => {\r\n        setChattingList(prevList => [msgData as ChattingMessage, ...prevList]);\r\n      },\r\n    );\r\n\r\n    const playOverOff = wsClient.on(ReservedEventName.PLAY_OVER, () => {\r\n      setIsShowPlayOverPanel(true);\r\n    });\r\n\r\n    const gameOverOff = wsClient.on(ReservedEventName.GAME_OVER, msgData => {\r\n      const { user } = msgData as {\r\n        user: IUser;\r\n      };\r\n      dispatch(userActions.createSetIsGaming(user.isGaming));\r\n    });\r\n\r\n    const refreshGameOff = wsClient.on(\r\n      ReservedEventName.REFRESH_GAME,\r\n      msgData => {\r\n        const { game } = msgData as {\r\n          game: IGame;\r\n        };\r\n        dispatch(roomActions.createSetCurrentGame(game));\r\n      },\r\n    );\r\n\r\n    const changeDrawerOff = wsClient.on(\r\n      ReservedEventName.CHANGE_DRAWER,\r\n      msgData => {\r\n        const { game } = msgData as {\r\n          game: IGame;\r\n        };\r\n        dispatch(roomActions.createSetCurrentGame(game));\r\n        setIsShowPlayOverPanel(false);\r\n      },\r\n    );\r\n\r\n    return () => {\r\n      chattingMessageOff();\r\n      gameOverOff();\r\n      refreshGameOff();\r\n      changeDrawerOff();\r\n      playOverOff();\r\n    };\r\n  }, [setIsShowPlayOverPanel, setChattingList, dispatch]);\r\n\r\n  const isSelfPlaying = useMemo(() => {\r\n    // 自己是画家还是猜测的人\r\n    if (user == null || currentGame == null) return false;\r\n    if (user.id === currentGame.playInfo.currentPlayer.id) return true;\r\n    return false;\r\n  }, [user, currentGame]);\r\n\r\n  if (currentGame == null || user == null) return <FullScreenLoading />;\r\n\r\n  return (\r\n    <>\r\n      <Dialog\r\n        open={isShowPlayOverPanel}\r\n        onClose={() => setIsShowPlayOverPanel(false)}\r\n      >\r\n        <DialogTitle>\r\n          正确答案是: {currentGame.playInfo.keyword.raw}\r\n        </DialogTitle>\r\n        <DialogContent>\r\n          {isSelfPlaying ? <Button variant=\"outlined\" disabled={true}>保存此次画作到本地</Button> : null}\r\n        </DialogContent>\r\n      </Dialog>\r\n      <div className=\"view-game\">\r\n        <GameHeader isSelfPlaying={isSelfPlaying} currentGame={currentGame} />\r\n        <div className=\"view-game-main\">\r\n          <CanvasContainer\r\n            isSelfPlaying={isSelfPlaying}\r\n            initialDrawing={currentGame.newestDrawing}\r\n          />\r\n          {isSelfPlaying ? null : <AnswerInputBox wsClient={wsClient} />}\r\n          <div className=\"user-list\">\r\n            {currentGame.users.map(gameUser => (\r\n              <div key={gameUser.id} className=\"user-list-user\">\r\n                <UserAvatar avatar={gameUser.username[0]}>\r\n                  {gameUser.id === user.id ? (\r\n                    <UserAvatar.AvatarStatus text=\"我\" />\r\n                  ) : null}\r\n                  <UserAvatar.AvatarStatus\r\n                    text={`${currentGame.userScores[gameUser.id]}分`}\r\n                  />\r\n                  {gameUser.id === currentGame.playInfo.currentPlayer.id ? (\r\n                    <UserAvatar.AvatarStatus text=\"正在绘画\" />\r\n                  ) : null}\r\n                  {gameUser.isOnline ? null : (\r\n                    <UserAvatar.AvatarStatus text=\"已离线\" />\r\n                  )}\r\n                </UserAvatar>\r\n                <div className=\"username\">{gameUser.username}</div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n          <div className=\"game-message-list\">\r\n            {chattingList.map(c => (\r\n              <div key={c.id} className=\"game-message-list-item\">\r\n                {c.speaker.name}: {c.content}\r\n              </div>\r\n            ))}\r\n            <div className=\"game-message-list-item\">车笔刀 猜：汽车</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\r\nimport React from 'react';\r\n\r\nconst theme = createMuiTheme({\r\n  palette: {\r\n    // type: 'dark',\r\n    primary: {\r\n      main: '#ff9800',\r\n    },\r\n  },\r\n});\r\n\r\nexport default function CustomThemeLayout({ children }: { children: any }) {\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n     {children}\r\n    </ThemeProvider>\r\n  );\r\n}\r\n","import GameLobby from '@client/view/GameLobby';\r\nimport BasicLayout from '@client/layout/BasicLayout';\r\nimport CreateRoom from '@client/view/room/CreateRoom';\r\nimport PlayingRoom from '@client/view/room/PlayingRoom';\r\nimport AuthLoyout from '@client/layout/AuthLayout';\r\nimport Game from '@client/view/game/Game';\r\nimport CustomThemeLayout from '@client/layout/CustomThemeLayout';\r\n\r\ninterface IRoute {\r\n  path: string;\r\n  component: (...args: any[]) => JSX.Element;\r\n  layout?: (...args: any[]) => JSX.Element;\r\n  children?: IRoute[];\r\n}\r\n\r\nconst routes: IRoute[] = [\r\n  {\r\n    path: '/',\r\n    component: AuthLoyout,\r\n    children: [\r\n      {\r\n        path: '/',\r\n        component: BasicLayout,\r\n        children: [\r\n          {\r\n            path: '/',\r\n            component: CustomThemeLayout,\r\n            children: [\r\n              {\r\n                path: '/create-room',\r\n                component: CreateRoom,\r\n              },\r\n              {\r\n                path: '/game/:id',\r\n                component: Game,\r\n              },\r\n              {\r\n                path: '/room/:roomId',\r\n                component: PlayingRoom,\r\n              },\r\n              {\r\n                path: '/',\r\n                component: GameLobby,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      },\r\n    ],\r\n  },\r\n];\r\nexport default routes;\r\n","import React from 'react';\r\n\r\nimport './index.scss';\r\nimport NotificationPanel from '@client/component/NotificationPanel';\r\n\r\nexport default function BasicLayout({ children }: { children : any}) {\r\n    return (\r\n      <>\r\n        <div className=\"basic-layout\">\r\n            {children}\r\n        </div>\r\n        <NotificationPanel />\r\n      </>\r\n    );\r\n}\r\n","import React from 'react';\r\nimport { Switch, Route } from 'react-router-dom';\r\nimport routes from './routes';\r\n\r\ninterface IRoute {\r\n  path: string;\r\n  component: (...args: any[]) => JSX.Element;\r\n  layout?: (...args: any[]) => JSX.Element;\r\n  children?: IRoute[];\r\n}\r\n\r\nfunction generateRoutes(routes?: IRoute[]) {\r\n  if (routes == null || routes.length === 0) return null;\r\n  return (\r\n    <Switch>\r\n      {routes.map((route, index) => {\r\n        const { layout: Layout, component: Component } = route;\r\n        if (Layout == null)\r\n          return (\r\n            <Route\r\n              key={index}\r\n              path={route.path}\r\n              render={() => <Component>{generateRoutes(route.children)}</Component>}\r\n            ></Route>\r\n          );\r\n        return (\r\n          <Route\r\n            key={index}\r\n            path={route.path}\r\n            render={() => (\r\n              <Layout>\r\n                <Component>{generateRoutes(route.children)}</Component>\r\n              </Layout>\r\n            )}\r\n          ></Route>\r\n        );\r\n      })}\r\n    </Switch>\r\n  );\r\n}\r\n\r\nexport const AppRoute = () => generateRoutes(routes);\r\n","import configureStore, { history } from '@client/store';\nimport { ConnectedRouter } from 'connected-react-router';\nimport React, { useEffect } from 'react';\nimport { Provider, useDispatch } from 'react-redux';\n\n\nimport { AppRoute } from './route';\nimport { userActions } from './store/actions';\nimport wsClient from './WebsocketClient/wsClient';\nimport { IUser } from '../shared/types';\n\n// import { HashRouter } from 'react-router-dom';\nexport const store = configureStore();\n\n\n\nfunction App() {\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    const refreshPlayerInfoOff = wsClient.on('refreshPlayerInfo', msgData => {\n      const user = msgData as IUser;\n      dispatch(userActions.createSetUser(user));\n    });\n    return () => {\n      refreshPlayerInfoOff();\n    };\n  }, [dispatch]);\n\n\n  return (\n    <div style={{\n      // height: '100vh',\n      // overflow: 'hidden',\n    }} className=\"App\">\n      <ConnectedRouter history={history}>\n        <AppRoute />\n      </ConnectedRouter>\n    </div>\n  );\n}\n\nconst AppWrapper = () => (\n  <Provider store={store}>\n    <App />\n  </Provider>\n);\n\nexport default AppWrapper;\n","import { hot } from 'react-hot-loader/root';\nimport 'react-hot-loader';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nimport './index.scss';\nimport { IS_DEV_CLIENT } from './util/constants';\n\nif (IS_DEV_CLIENT) {\n  ReactDOM.render(React.createElement(hot(App)), document.getElementById('root'));\n} else {\n  ReactDOM.render(React.createElement(App), document.getElementById('root'));\n}\n\n(function() { // 禁止手机浏览器下拉刷新的效果\n  const bodyEl = document.querySelector('body') as HTMLBodyElement;\n  bodyEl.addEventListener('touchmove', evt => {\n    // console.log('touchstart');\n    evt.preventDefault();\n  }, {\n    passive: false,\n  });\n}());\n"],"sourceRoot":""}