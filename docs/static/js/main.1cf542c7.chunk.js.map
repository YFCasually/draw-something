{"version":3,"sources":["store/user/actionTypes.ts","store/global/actionTypes.ts","store/room/actionTypes.ts","store/user/reducer.ts","store/global/reducer.ts","store/room/reducer.ts","store/reducers.ts","util/helper.ts","util/constants.ts","store/index.ts","hooks/index.ts","model/Notification.ts","store/user/actions.ts","store/global/actions.ts","store/room/actions.ts","../shared/models/RequestMessage.ts","config.ts","WebsocketClient/wsClient.ts","WebsocketClient/index.ts","API/user.ts","API/index.ts","store/user/effects.ts","store/global/effects.ts","../shared/constants/room.ts","store/room/effects.ts","ui/FullScreenLoading.tsx","view/GameLobby/components/AccountCard/index.tsx","view/GameLobby/components/GameLobbyHeader/index.tsx","view/GameLobby/components/RoomList/index.tsx","view/GameLobby/index.tsx","component/NotificationPanel/index.tsx","view/room/CreateRoom/index.tsx","../shared/constants/index.ts","view/room/PlayingRoom/components/RoomChatting/index.tsx","view/room/PlayingRoom/components/RoomHeader.tsx","ui/UserAvatar/index.tsx","view/room/PlayingRoom/components/UserList/index.tsx","view/room/PlayingRoom/index.tsx","layout/AuthLayout.tsx","view/game/Game/components/AnswerInputBox/index.tsx","../shared/models/DrawAction.ts","controller/CanvasController.ts","view/game/Game/components/CanvasContainer/SetPenColorButton.tsx","ui/PlainLine.tsx","view/game/Game/components/CanvasContainer/SetPenSizeButton.tsx","view/game/Game/components/CanvasContainer/index.tsx","view/game/Game/components/GameChattingMessage/index.tsx","view/game/Game/components/GameHeader/index.tsx","view/game/Game/components/GameUserList/index.tsx","view/game/Game/index.tsx","layout/CustomThemeLayout.tsx","route/routes.ts","layout/BasicLayout/index.tsx","route/index.tsx","App.tsx","index.ts"],"names":["SET_USERNAME","SET_USER","SET_USER_CURRENT_ROOM_ID","SET_IS_READY","SET_IS_GAMING","SET_NUMBER_OF_ONLINE_PLAYER","ADD_NOTIFICATION","SHIFT_NOTIFICATION","SET_ROOM_LIST","SET_CURRENT_ROOM_USERS","SET_CURRENT_ROOM_STATUS","SET_CURRENT_GAME","SET_CURRENT_GAME_USERS","SET_ROOM","defaultState","isLogining","user","isRegistering","numberOfOnlinePlayer","notifications","roomList","currentRoom","currentGame","reducers","state","action","produce","draft","type","payload","userActionTypes","username","isGaming","isReady","currentRoomId","global","globalActionTypes","push","shift","room","roomActionTypes","users","undefined","status","createRootReducer","history","combineReducers","router","connectRouter","getToken","token","localStorage","getItem","setToken","setItem","createHandleOnKeyEnterUp","cb","evt","keyCode","IS_DEV_CLIENT","some","p","window","location","origin","includes","createHashHistory","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","useDocumentTitle","title","prevTitleRef","useRef","useEffect","current","document","Notification","detail","id","uuidv4","createAt","Date","now","createSetUsername","createSetUser","createSetIsGaming","createSetUserCurrentRoomId","rid","createSetIsReady","createSetNumberOfOnlinePlayer","num","createAddNotification","n","createShiftNotification","createSetRoomList","createSetCurrentRoomUsers","createSetRoom","r","createSetCurrentGame","g","createSetCurrentRoomStatus","s","createSetCurrentGameUsers","us","RequestMessage","data","handler","desc","this","getConfig","wsClient","options","isConnected","ws","messageCache","eventMap","Map","WebSocket","addr","init","onopen","sendMessageFromCache","onclose","console","log","onerror","onmessage","rawMessage","msg","JSON","parse","trigger","emit","requestId","forEach","sendMessage","reqMsg","send","stringify","Promise","resolve","reject","on","callback","_","respMsg","error","off","err","eventName","cbsArray","get","set","filter","c","cbs","hostname","login","a","request","changeUsername","changed","dispatch","API","userActions","usrName","getNumberOfOnlinePlayer","result","globalActions","RoomStatus","RoomType","getRoomList","roomActions","isEnteringRoom","enterRoom","roomId","batchDispatch","leaveRoom","getState","createRoom","name","sendChatMessage","content","makeGameIsReady","ready","requestType","getGame","game","GAMING","replace","FullScreenLoading","className","style","display","justifyContent","alignItems","CircularProgress","selectorAccountCard","AccountCard","useSelector","shallowEqual","useState","changedUsername","setChangedUsername","updateUsername","useCallback","target","value","trim","isShowChangeNameDialog","setIsShowChangeNameDialog","useDispatch","openChangeNameModal","closeChangeName","confirmChangeUsername","isEmptyName","length","userEffects","Dialog","open","onClose","DialogTitle","DialogContent","TextField","fullWidth","placeholder","onChange","DialogActions","Button","disabled","onClick","Card","CardHeader","color","subheader","toLocaleTimeString","avatar","Avatar","IconButton","GameLobbyHeader","React","memo","isShowFindRoom","setIsShowFindRoom","closeFindRoom","setRoomId","jumoToFindRoom","onKeyUp","AppBar","boxShadow","position","statusText","WAITING","RoomListItem","String","padStart","variant","maxPlayerNumber","selectorRoomList","RoomList","freshRoomList","roomEffects","refreshRoomListOff","respData","List","ListSubheader","map","key","isTipShowd","indexSelector","selectorNotificationPanel","NotificationPanel","shiftNotification","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","aria-label","Close","message","ReservedEventName","selectorRoomMessage","userId","RoomChatting","chatMsgList","setChatMsgList","ROOM_CHATTING","chatMsg","prev","concat","chattingContent","setChattingContent","cm","ListItem","speaker","timestamp","selectorPlayingRoom","roomName","roomType","PUBLIC","roomTypeTextMapping","PRIVATE","RoomHeader","Toolbar","Typography","flex","textAlign","AvatarStatus","text","bgColor","backgroundColor","UserAvatar","children","height","width","deepOrange","createElement","arrOfEight","Array","fill","selectorUserList","UserList","index","isOnLine","selectorAuthLoyout","pathname","AnswerInputBox","DrawActionType","answer","setAnswer","sendGuessAnswer","handleOnKeyEnterUp","CanvasController","canvasEl","ctx","getContext","penColor","setPenColor","penSize","setPenSize","strokeStyle","fillStyle","lineWidth","size","image","img","Image","onload","clearCanvas","drawImage","src","to","beginPath","arc","x","y","Math","PI","closePath","toDataURL","startPoint","sp","moveTo","lineTo","stroke","elementSelector","el","querySelector","Error","append","clientHeight","clientWidth","prevFillStyle","clearRect","fillRect","op","DrawAction","externals","ignore","Object","assign","Type","colors","SetPenColorButton","anchorEl","isShowSetPenColor","setIsShowSetPenColor","updatePenColor","fontSize","Popover","transformOrigin","border","PlainLine","props","SetPenSizeButton","updatePenSize","isShowSetPenSize","setIsShowSetPenSize","Slider","valueLabelDisplay","step","marks","min","max","sendDrawActionToServer","drawAction","DRAW_ACTION","getPointFromEvent","touches","t","clientX","clientY","offsetLeft","offsetTop","isSelfPlaying","draw","futureDrawings","setFutureDrawings","pastDrawings","setPastDrawings","isMountedRef","useLayoutEffect","mount","newestDrawing","changePlayingUserOff","CHANGE_DRAWER","drawActionOff","respMsgData","START_DRAW_LINE","point","setting","prevSetting","getSetting","drawPoint","startDrawLine","DRAW_LINE_TO","drawLineTo","DRAW_IMAGE","imgData","snapshotCurrentDrawing","curDrawing","getSnapshot","undoDrawing","pastDrawing","pop","redoDrawing","futureDrawing","handleTouchStart","handleTouchMove","frequency","lastTime","curTime","throttle","handleTouchEnd","posDivEl","setPosDivEl","onTouchStart","onTouchMove","onTouchEnd","ref","Undo","Redo","chattingMessageList","setChattingMessageList","chattingMessageOff","GAME_CHATTING","msgData","prevList","playInfo","time","gameTimeSoFar","setGameTimeSoFar","timeoutOff","TIMEOUT","keyword","raw","hint","gameUser","userScores","drawer","selectorGame","theme","createMuiTheme","palette","primary","light","main","dark","routes","path","component","targetPath","ThemeProvider","defaultRoomName","setRoomName","setRoomType","globalEffects","isUsingDefaultRoomName","setIsUsingDefaultRoomName","updateRoomName","goBack","FormControl","label","RadioGroup","button","FormControlLabel","control","Radio","labelPlacement","gameAnswer","setGameAnswer","isShowPlayOverPanel","setIsShowPlayOverPanel","refreshGameUsersOff","REFRESH_GAME_USERS","gameUsers","playOverOff","PLAY_OVER","gameOverOff","GAME_OVER","refreshGameOff","REFRESH_GAME","changeDrawerOff","useMemo","CanvasContainer","rawRoomId","useParams","parseInt","toggleGameReady","refreshRoomInfoOff","REFRESH_ROOM","startGameOff","START_GAME","Number","isNaN","AppRoute","generateRoutes","route","Layout","layout","Component","render","store","createStore","applyMiddleware","routerMiddleware","ReduxThunk","App","refreshPlayerInfoOff","AppWrapper","ReactDOM","getElementById","addEventListener","preventDefault","passive"],"mappings":"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","file":"static/js/main.1cf542c7.chunk.js","sourcesContent":["export const SET_USERNAME = 'SET_USERNAME';\n\nexport const SET_USER = 'SET_USER';\n\nexport const SET_USER_CURRENT_ROOM_ID =  'SET_USER_CURRENT_ROOM_ID';\n\nexport const SET_IS_READY = 'SET_IS_READY';\n\nexport const SET_IS_GAMING = 'SET_IS_GAMING';\n\n// export const LOGOUT = 'LOGOUT';\n","export const SET_NUMBER_OF_ONLINE_PLAYER = 'SET_NUMBER_OF_ONLINE_PLAYER';\n\nexport const ADD_NOTIFICATION = 'ADD_NOTIFICATION';\n\nexport const SHIFT_NOTIFICATION = 'REMOVE_NOTIFICATION';\n","export const SET_ROOM_LIST = 'SET_ROOM_LIST';\n\nexport const SET_CURRENT_ROOM_USERS = 'SET_CURRENT_ROOM_USERS';\n\nexport const SET_CURRENT_ROOM_STATUS = 'SET_CURRENT_ROOM_STATUS';\n\nexport const SET_CURRENT_GAME = 'SET_CURRENT_GAME';\n\nexport const SET_CURRENT_GAME_USERS = 'SET_CURRENT_GAME_USERS';\n\nexport const SET_ROOM = 'SET_ROOM';\n","import { IUser } from '../../../shared/types';\r\nimport { produce } from 'immer';\r\n\r\nimport { IAction } from '../actions';\r\nimport { userActionTypes } from '../actionTypes';\r\n\r\nexport interface IReduxUserState {\r\n  isLogining: boolean;\r\n  user: null | IUser;\r\n  isRegistering: boolean;\r\n}\r\n\r\nconst defaultState: IReduxUserState = {\r\n  isLogining: false,\r\n  user: null,\r\n  isRegistering: false,\r\n};\r\n\r\nexport default function userReducer(state = defaultState, action: IAction) {\r\n  return produce(state, draft => {\r\n    const { type, payload } = action;\r\n    switch (type) {\r\n      case userActionTypes.SET_USERNAME:\r\n        if (draft.user != null) {\r\n          draft.user.username = payload as string;\r\n        }\r\n        break;\r\n      case userActionTypes.SET_USER:\r\n        draft.user = payload as IUser;\r\n        break;\r\n      case userActionTypes.SET_IS_GAMING:\r\n        if (draft.user != null) {\r\n          draft.user.isGaming = payload as boolean;\r\n        }\r\n        break;\r\n      case userActionTypes.SET_IS_READY:\r\n        if (draft.user != null) {\r\n          draft.user.isReady = payload as boolean;\r\n        }\r\n        break;\r\n\r\n      case userActionTypes.SET_USER_CURRENT_ROOM_ID:\r\n        if (draft.user != null) {\r\n          draft.user.currentRoomId = payload as number | undefined;\r\n        }\r\n        break;\r\n    }\r\n  });\r\n}\r\n","import { produce } from 'immer';\r\n\r\nimport { IAction } from '../actions';\r\nimport { globalActionTypes } from '../actionTypes';\r\nimport Notification from '@client/model/Notification';\r\n\r\nexport interface IReduxGlobalState {\r\n  numberOfOnlinePlayer: number;\r\n  notifications: Notification[];\r\n}\r\n\r\nconst defaultState: IReduxGlobalState = {\r\n  numberOfOnlinePlayer: 1,\r\n  notifications: [],\r\n};\r\n\r\nexport default function globalReducer(state = defaultState, action: IAction) {\r\n  return produce(state, draft => {\r\n    const { type, payload } = action;\r\n    switch (type) {\r\n      case globalActionTypes.SET_NUMBER_OF_ONLINE_PLAYER:\r\n        draft.numberOfOnlinePlayer = payload as number;\r\n        break;\r\n      case globalActionTypes.ADD_NOTIFICATION:\r\n        draft.notifications.push(payload as Notification);\r\n        break;\r\n      case globalActionTypes.SHIFT_NOTIFICATION:\r\n        draft.notifications.shift();\r\n        break;\r\n    }\r\n  });\r\n}\r\n","import { produce } from 'immer';\r\n\r\nimport { RoomStatus } from '../../../shared/constants';\r\nimport { IGame, IRoom, IUser } from '../../../shared/types';\r\nimport { IAction } from '../actions';\r\nimport { roomActionTypes } from '../actionTypes';\r\n\r\n\r\nexport interface IReduxRoomState {\r\n  roomList: IRoom[];\r\n  currentRoom: null | IRoom;\r\n  currentGame: null | IGame;\r\n}\r\n\r\nconst defaultState: IReduxRoomState = {\r\n  roomList: [],\r\n  currentRoom: null,\r\n  currentGame: null,\r\n};\r\n\r\nexport default function roomReducer(state = defaultState, action: IAction) {\r\n  return produce(state, draft => {\r\n    const { type, payload } = action;\r\n    switch (type) {\r\n      case roomActionTypes.SET_ROOM_LIST:\r\n        draft.roomList = payload as IRoom[];\r\n        break;\r\n      case roomActionTypes.SET_CURRENT_ROOM_USERS:\r\n        if (draft.currentRoom != null) {\r\n          draft.currentRoom.users = payload as IUser[];\r\n        }\r\n        break;\r\n      case roomActionTypes.SET_ROOM:\r\n        draft.currentRoom = payload as IRoom | null;\r\n        break;\r\n      case roomActionTypes.SET_CURRENT_GAME:\r\n        draft.currentGame = payload as IGame | null;\r\n        break;\r\n      case roomActionTypes.SET_CURRENT_GAME_USERS:\r\n        if (draft.currentGame != undefined) {\r\n          draft.currentGame.users = payload as IUser[];\r\n        }\r\n        break;\r\n      case roomActionTypes.SET_CURRENT_ROOM_STATUS:\r\n        if (draft.currentRoom != null) {\r\n          draft.currentRoom.status = payload as RoomStatus;\r\n        }\r\n        break;\r\n    }\r\n  });\r\n}\r\n","import { combineReducers } from 'redux';\r\nimport { connectRouter } from 'connected-react-router'\r\nimport { Location } from 'history';\r\n\r\nimport userReducer, { IReduxUserState } from \"./user/reducer\";\r\nimport globalReducer, { IReduxGlobalState } from \"./global/reducer\";\r\nimport roomReducer, { IReduxRoomState } from \"./room/reducer\";\r\n\r\nconst reducers = {\r\n  user: userReducer,\r\n  global: globalReducer,\r\n  room: roomReducer,\r\n}\r\n\r\nconst createRootReducer = (history: any) => combineReducers({\r\n  router: connectRouter(history),\r\n  ...reducers,\r\n});\r\n\r\nexport default createRootReducer;\r\n\r\nexport interface IReduxState {\r\n    user: IReduxUserState,\r\n    global: IReduxGlobalState,\r\n    room: IReduxRoomState,\r\n    router: {\r\n      location: Location,\r\n    }\r\n}\r\n","import { KeyboardEvent } from 'react';\r\n\r\nexport function getIsDevelopment() {\r\n  const devlopmentPaths = ['localhost', '127.0.0.1', '192.168'];\r\n  return devlopmentPaths.some(p => window.location.origin.includes(p));\r\n}\r\n\r\nexport function getToken() {\r\n  const token = localStorage.getItem('__token');;\r\n  if (token == null) return undefined;\r\n  return token;\r\n}\r\n\r\nexport function throttle<T extends (...args: any[]) => any>(cb: T, frequency: number): T {\r\n  let lastTime = -1; // 这是为了保证第一次会被触发\r\n  const result = (function(...args: any[]) {\r\n    const curTime = Date.now();\r\n    if (curTime - lastTime >= frequency) {\r\n      lastTime = curTime;\r\n      cb(...args);\r\n    }\r\n  } as T)\r\n  return result;\r\n}\r\n\r\nexport function setToken(token: string) {\r\n  localStorage.setItem('__token', token);\r\n}\r\n\r\nexport function createHandleOnKeyEnterUp(cb: () => void) {\r\n  return function handleOnKeyEnterUp(evt: KeyboardEvent) {\r\n    const KEY_ENTER_CODE = 13;\r\n    if (evt.keyCode === KEY_ENTER_CODE) {\r\n      cb();\r\n    }\r\n  }\r\n}\r\n\r\n","import { getIsDevelopment } from \"./helper\";\r\n\r\nexport const IS_DEV_CLIENT = getIsDevelopment();\r\n\r\n// export enum MessageType { // 注意这里的字面量很重要的，后端根据这个判断调用哪一个service\r\n//     LOGIN = 'login',\r\n//     ROOM_LIST = 'roomList',\r\n// }\r\n","import { createStore, applyMiddleware, compose } from 'redux';\r\nimport { createHashHistory } from 'history';\r\nimport { routerMiddleware } from 'connected-react-router';\r\nimport ReduxThunk from 'redux-thunk';\r\n\r\nimport createRootReducer from './reducers';\r\nimport { IS_DEV_CLIENT } from '../util/constants';\r\n\r\nexport const history = createHashHistory();\r\n\r\nconst composeEnhancers =\r\n  (window as any).__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\r\n\r\nexport default function configureStore() {\r\n  if (IS_DEV_CLIENT) {\r\n    const store = createStore(\r\n      createRootReducer(history), // root reducer with router state\r\n      composeEnhancers(\r\n        applyMiddleware(\r\n          routerMiddleware(history), // for dispatching history actions\r\n          ReduxThunk,\r\n        ),\r\n      ),\r\n    );\r\n\r\n    return store;\r\n  } else {\r\n    const store = createStore(\r\n      createRootReducer(history), // root reducer with router state\r\n      compose(\r\n        applyMiddleware(\r\n          routerMiddleware(history), // for dispatching history actions\r\n          ReduxThunk,\r\n        ),\r\n      ),\r\n    );\r\n\r\n    return store;\r\n  }\r\n}\r\n","import { useEffect, useRef } from 'react';\r\n\r\nexport function useDocumentTitle(title: string) {\r\n  const prevTitleRef = useRef('');\r\n  useEffect(() => {\r\n    prevTitleRef.current = document.title;\r\n    document.title = title;\r\n    return () => {\r\n      document.title = prevTitleRef.current;\r\n    }\r\n  }, [title]);\r\n}\r\n","import uuidv4 from 'uuid/v4';\r\n\r\n\r\nexport default class Notification {\r\n  public id = uuidv4();\r\n  public createAt = Date.now();\r\n  constructor(\r\n    public title: string,\r\n    public type: 'error' | 'warn' | 'success' | 'none' = 'none',\r\n    public detail?: string,\r\n  ) {}\r\n}\r\n","import { IAction } from '../actions';\nimport { userActionTypes } from '../actionTypes';\nimport { IUser } from '../../../shared/types';\n\nexport function createSetUsername(username: string): IAction {\n  return {\n    type: userActionTypes.SET_USERNAME,\n    payload: username,\n  };\n}\n\nexport function createSetUser(user: IUser): IAction {\n  return {\n    type: userActionTypes.SET_USER,\n    payload: user,\n  };\n}\n\nexport function createSetIsGaming(status: boolean): IAction {\n  return {\n    type: userActionTypes.SET_IS_GAMING,\n    payload: status,\n  }\n}\n\nexport function createSetUserCurrentRoomId(rid: number | undefined): IAction {\n  return {\n    type: userActionTypes.SET_USER_CURRENT_ROOM_ID,\n    payload: rid,\n  }\n}\n\nexport function createSetIsReady(status: boolean): IAction {\n  return {\n    type: userActionTypes.SET_IS_READY,\n    payload: status,\n  }\n}\n","import { IAction } from '../actions';\nimport { globalActionTypes } from '../actionTypes';\nimport Notification from '@client/model/Notification';\n\nexport function createSetNumberOfOnlinePlayer(num: number): IAction {\n  return {\n    type: globalActionTypes.SET_NUMBER_OF_ONLINE_PLAYER,\n    payload: num,\n  };\n}\n\nexport const createAddNotification = (n: Notification) => ({\n  type: globalActionTypes.ADD_NOTIFICATION,\n  payload: n,\n});\n\nexport const createShiftNotification = () => ({\n  type: globalActionTypes.SHIFT_NOTIFICATION,\n});\n","import { IAction } from '../actions';\nimport { roomActionTypes } from '../actionTypes';\nimport { IRoom, IUser, IGame } from '../../../shared/types';\nimport { RoomStatus } from '../../../shared/constants/room';\n\nexport function createSetRoomList(roomList: any[]): IAction {\n  return {\n    type: roomActionTypes.SET_ROOM_LIST,\n    payload: roomList,\n  };\n}\n\nexport function createSetCurrentRoomUsers(users: IUser[]): IAction {\n  return {\n    type: roomActionTypes.SET_CURRENT_ROOM_USERS,\n    payload: users,\n  };\n}\n\nexport function createSetRoom(r: IRoom | null): IAction {\n  return {\n    type: roomActionTypes.SET_ROOM,\n    payload: r,\n  };\n}\n\nexport function createSetCurrentGame(g: IGame | null): IAction {\n  return {\n    type: roomActionTypes.SET_CURRENT_GAME,\n    payload: g,\n  };\n}\n\nexport function createSetCurrentRoomStatus(s: RoomStatus): IAction {\n  return {\n    type: roomActionTypes.SET_CURRENT_ROOM_STATUS,\n    payload: s,\n  }\n}\n\nexport function createSetCurrentGameUsers(us: IUser[]): IAction {\n  return {\n    type: roomActionTypes.SET_CURRENT_GAME_USERS,\n    payload: us,\n  }\n}\n","\r\nexport default class RequestMessage {\r\n  id: string;\r\n  createAt = Date.now();\r\n  constructor(public data: unknown, public handler?: string, public desc?: string) {\r\n    this.id = `${this.handler}-${Date.now()}`;\r\n  }\r\n\r\n  toJSON() {\r\n    const { ...publics } = this;\r\n    return publics;\r\n  }\r\n}\r\n\r\nexport function isRequestMessage(target: any): target is RequestMessage {\r\n  if (target == null) return false;\r\n  if (\r\n    typeof target === 'object' &&\r\n    typeof target.id === 'string' &&\r\n    typeof target.createAt === 'number'\r\n  ) return true;\r\n  return false;\r\n}\r\n","import { IS_DEV_CLIENT } from \"./util/constants\";\r\n\r\nfunction getConfig() {\r\n    if (IS_DEV_CLIENT) {\r\n        return {\r\n            // addr: 'ws://127.0.0.1:9421',\r\n            addr: `ws://${window.location.hostname}:9421`,\r\n        }\r\n    }\r\n    return {\r\n        addr: 'ws://101.37.174.138:9421',\r\n    };\r\n}\r\n\r\nexport default getConfig();\r\n\r\n","import WebsocketClient from \".\";\r\nimport config from \"@client/config\";\r\n\r\nconst wsClient = new WebsocketClient({\r\n  addr: config.addr,\r\n});\r\n\r\nexport default wsClient;\r\n","import { IS_DEV_CLIENT } from '../util/constants';\r\nimport ResponseMessage from '../../shared/models/ResponseMessage';\r\nimport RequestMessage from '../../shared/models/RequestMessage';\r\n// import RequestMessage from './models/RequestMessage';\r\n\r\nexport default class WebsocketClient {\r\n  isConnected = false;\r\n  ws: WebSocket;\r\n  messageCache: RequestMessage[] = [];\r\n  eventMap = new Map<\r\n    string,\r\n    ((messageData: unknown, message: RequestMessage) => void)[]\r\n  >();\r\n  constructor(\r\n    public options: {\r\n      addr: string;\r\n      onopen?: (evt: Event) => void;\r\n      onclose?: (evt: Event) => void;\r\n      onerror?: (evt: Event) => void;\r\n    },\r\n  ) {\r\n    this.ws = new window.WebSocket(this.options.addr);\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    // 注册事件\r\n    this.ws.onopen = evt => {\r\n      this.isConnected = true;\r\n      if (typeof this.options.onopen === 'function') {\r\n        this.options.onopen(evt);\r\n      }\r\n      this.sendMessageFromCache();\r\n    };\r\n    this.ws.onclose = evt => {\r\n      this.isConnected = false;\r\n      if (typeof this.options.onclose === 'function') {\r\n        this.options.onclose(evt);\r\n        if (IS_DEV_CLIENT) {\r\n          console.log('连接断开');\r\n        }\r\n      }\r\n    };\r\n    this.ws.onerror = evt => {\r\n      if (typeof this.options.onerror === 'function') {\r\n        this.options.onerror(evt);\r\n      }\r\n    };\r\n    this.ws.onmessage = ({ data: rawMessage }) => {\r\n      const msg: ResponseMessage = JSON.parse(rawMessage);\r\n      if (msg.trigger === undefined || (msg.trigger !== undefined && msg.trigger !== 'timeout')) {\r\n        console.log('recive', msg);\r\n      }\r\n      this.emit('message', msg);\r\n      if (msg.requestId != null) {\r\n        this.emit(msg.requestId, msg);\r\n      }\r\n      if (msg.trigger != null) {\r\n        this.emit(msg.trigger, msg);\r\n      }\r\n    };\r\n    // end 注册事件\r\n  }\r\n\r\n  sendMessageFromCache() {\r\n    // 主要是为了处理应用已经加载完成，但是还没建立连接的情况，相当于人为加了一个缓冲层，只要没有connected，这些msg就不会发送\r\n    this.messageCache.forEach(msg => {\r\n      this.sendMessage(msg);\r\n    });\r\n    this.messageCache = [];\r\n  }\r\n\r\n  sendMessage(reqMsg: RequestMessage) {\r\n    if (this.isConnected) {\r\n      console.log(`sendMessage`, reqMsg);\r\n      this.ws.send(JSON.stringify(reqMsg));\r\n    } else {\r\n      this.messageCache.push(reqMsg);\r\n    }\r\n  }\r\n\r\n  // requestSync(type: string, data?: any) {\r\n  //   const messageId = type + '_' + new Date().getTime(); // 这是为了防止收到过时的信息\r\n  //   const msg: RequestMessage = { data, type, id: messageId };\r\n  //   this.sendMessage(msg);\r\n  // }\r\n\r\n  // 不需要等待回复的请求不要用这个方法，会导致内存泄漏，因为无法触发对应reqesut Id的回调函数\r\n  request(handler: string, data?: any) {\r\n    return new Promise<ResponseMessage>((resolve, reject) => {\r\n      try {\r\n        // const messageId = type + '_' + new Date().getTime() // 这是为了防止收到过时的信息\r\n        // const msg: RequestMessage = {data, type, id: messageId}\r\n        const reqMsg = new RequestMessage(data, handler);\r\n        const callback = (_: unknown, respMsg: ResponseMessage) => {\r\n          if (respMsg == null) {\r\n            console.error(`${reqMsg.handler}-${reqMsg.id} 返回来空的message`);\r\n          }\r\n\r\n          // 注意，如果针对本次请求，如果服务器端没有回复响应，则永远不会调用和删除回调\r\n          if (respMsg.error != null) {\r\n            this.emit('error', respMsg);\r\n            reject(respMsg.error);\r\n          }\r\n\r\n          resolve(respMsg);\r\n\r\n          if (respMsg.requestId != null) {\r\n            this.off(respMsg.requestId, callback);\r\n          }\r\n          if (IS_DEV_CLIENT) {\r\n            if (respMsg.requestId != null && respMsg.requestId !== reqMsg.id) {\r\n              console.error(\r\n                `reqMsg.id: ${reqMsg.id} !== respMsg.requestId： ${respMsg.requestId}`,\r\n              );\r\n            }\r\n          }\r\n        };\r\n        this.on(reqMsg.id, callback);\r\n        this.sendMessage(reqMsg);\r\n      } catch (err) {\r\n        console.error(`request时发生错误 ${err}`);\r\n      }\r\n    });\r\n  }\r\n\r\n  on(\r\n    eventName: string,\r\n    callback: (messageData: unknown, message: ResponseMessage) => void,\r\n  ) {\r\n    let cbsArray = this.eventMap.get(eventName);\r\n    if (cbsArray === undefined) {\r\n      cbsArray = [];\r\n      this.eventMap.set(eventName, cbsArray);\r\n    }\r\n    cbsArray.push(callback);\r\n    return () => {\r\n      this.off(eventName, callback);\r\n    };\r\n  }\r\n  off(\r\n    eventName: string,\r\n    cb: (messageData: unknown, message: RequestMessage) => void,\r\n  ) {\r\n    let cbsArray = this.eventMap.get(eventName);\r\n    if (cbsArray !== undefined) {\r\n      cbsArray = cbsArray.filter(c => c !== cb);\r\n      this.eventMap.set(eventName, cbsArray);\r\n    }\r\n  }\r\n  emit(eventName: string, msg: RequestMessage) {\r\n    const cbs = this.eventMap.get(eventName);\r\n    if (cbs !== undefined) {\r\n      cbs.forEach(c => c(msg.data, msg));\r\n    }\r\n  }\r\n}\r\n","import wsClient from \"@client/WebsocketClient/wsClient\";\r\nimport { IUser } from \"../../shared/types\";\r\n\r\nexport async function login(token?: string) {\r\n  const user = (await wsClient.request('login', token)).data as IUser;\r\n  return user;\r\n}\r\n\r\nexport async function changeUsername(username: string) {\r\n  const changed = (await wsClient.request(\r\n    'changeUsername',\r\n    username,\r\n  )).data as string;\r\n  return changed;\r\n}\r\n","\r\nimport * as user from './user';\r\n\r\nexport default {\r\n  user,\r\n}\r\n","import { TReduxThunk } from '../effects';\nimport { userActions } from '../actions';\nimport { getToken, setToken } from '../../util/helper';\nimport API from '@client/API';\n\nexport function login(): TReduxThunk {\n  return async dispatch => {\n    const token = getToken();\n    const user = await API.user.login(token);\n    setToken(user.token);\n    dispatch(userActions.createSetUser(user));\n  };\n}\n\nexport function changeUsername(usrName: string): TReduxThunk {\n  return async dispatch => {\n    const changed = await API.user.changeUsername(usrName);\n    dispatch(userActions.createSetUsername(changed));\n  };\n}\n","import { TReduxThunk } from '../effects';\nimport { globalActions } from '../actions';\nimport wsClient from '@client/WebsocketClient/wsClient';\n\n\nexport function getNumberOfOnlinePlayer(): TReduxThunk {\n  return async dispatch => {\n    try {\n      const result = (await wsClient.request('numberOfOnlineUser')).data as number;\n      dispatch(globalActions.createSetNumberOfOnlinePlayer(result));\n    } catch (err) {\n      console.error(err);\n    }\n  };\n}\n","export enum RoomStatus {\r\n  WAITING = 'waiting',\r\n  GAMING = 'gaming',\r\n};\r\n\r\nexport enum RoomType {\r\n  PUBLIC = 'public',\r\n  PRIVATE = 'private',\r\n}\r\n","import Notification  from '@client/model/Notification';\nimport wsClient from '@client/WebsocketClient/wsClient';\nimport { push, replace } from 'connected-react-router';\nimport { batch as batchDispatch } from 'react-redux';\n\nimport { RoomStatus, RoomType } from '../../../shared/constants/room';\nimport { IGame, IRoom, IUser } from '../../../shared/types';\nimport { globalActions, roomActions, userActions } from '../actions';\nimport { TReduxThunk } from '../effects';\n\nexport function getRoomList(): TReduxThunk {\n  return async dispatch => {\n    try {\n      const respMsg = await wsClient.request('roomList');\n      const result = respMsg.data as any[];\n      dispatch(roomActions.createSetRoomList(result));\n    } catch (err) {\n      console.error(err);\n    }\n  };\n}\n\nlet isEnteringRoom = false;\nexport function enterRoom(roomId: number): TReduxThunk {\n  return async dispatch => {\n    if (isEnteringRoom) return;\n    isEnteringRoom = true;\n\n    try {\n      const respMsg = await wsClient.request('userEnter', {\n        roomId,\n      });\n\n      const { room, user } = respMsg.data as {\n        room: IRoom;\n        user: IUser;\n      };\n      batchDispatch(() => {\n        dispatch(roomActions.createSetRoom(room));\n        dispatch(userActions.createSetUserCurrentRoomId(user.currentRoomId));\n        dispatch(push(`/room/${room.id}`));\n      });\n    } catch (err) {\n      batchDispatch(() => {\n        dispatch(push('/'));\n        dispatch(globalActions.createAddNotification(new Notification(err.title, 'error')))\n      });\n\n    } finally {\n      isEnteringRoom = false;\n    }\n  };\n}\n\nexport function leaveRoom(): TReduxThunk {\n  return async (dispatch, getState) => {\n    const {\n      user: { user },\n    } = getState();\n    if (user == null || user.currentRoomId == null) return;\n    try {\n      wsClient.request('userLeave');\n      dispatch(userActions.createSetUserCurrentRoomId(undefined));\n      dispatch(roomActions.createSetRoom(null));\n      dispatch(push('/'));\n    } catch (err) {\n      console.error(err);\n    }\n  };\n}\n\nexport function createRoom(name: string, type: RoomType): TReduxThunk {\n  return async dispatch => {\n    try {\n      const respMsg = await wsClient.request('createRoom', {\n        name,\n        type,\n      });\n      const room = respMsg.data as IRoom;\n      dispatch(enterRoom(room.id));\n      // dispatch(getRoomList());\n    } catch (err) {\n      console.error(err);\n    }\n  };\n}\n\nexport function sendChatMessage(content: string): TReduxThunk {\n  return async dispatch => {\n    try {\n      wsClient.request('sendChatMessage', { content });\n    } catch (err) {\n      console.error(err);\n    }\n  };\n}\n\nexport function makeGameIsReady(ready: boolean): TReduxThunk {\n  const requestType = ready ? 'makeGameReady' : 'cancelGameReady';\n  return async dispatch => {\n    try {\n      const respMsg = await wsClient.request(requestType);\n      const { user, room } = respMsg.data as {\n        user: IUser;\n        room: IRoom;\n      };\n      dispatch(roomActions.createSetCurrentRoomUsers(room.users));\n      dispatch(userActions.createSetIsReady(user.isReady));\n    } catch (err) {\n      console.error(err);\n    }\n  };\n}\n\nexport function getGame(): TReduxThunk {\n  return async (dispatch, getState) => {\n    const {\n      user: { user },\n    } = getState();\n    try {\n      const respMsg = await wsClient.request('getGame');\n      const { game } = respMsg.data as {\n        user: IUser;\n        game: IGame;\n      };\n      dispatch(roomActions.createSetCurrentGame(game));\n      dispatch(roomActions.createSetCurrentRoomStatus(RoomStatus.GAMING));\n    } catch (err) {\n      dispatch(\n        globalActions.createAddNotification(\n          new Notification(err.title, 'error'),\n        ),\n      );\n      if (user != null && user.currentRoomId != null) {\n        dispatch(replace(`/room/${user.currentRoomId}`));\n      } else {\n        dispatch(replace('/'));\n      }\n    }\n  };\n}\n","import React from 'react';\r\n\r\nimport { CircularProgress } from '@material-ui/core';\r\n\r\nexport default function FullScreenLoading() {\r\n\r\n  return (\r\n    <div className=\"full-screen-loading\" style={{\r\n      display: 'flex',\r\n      justifyContent: 'center',\r\n      alignItems: 'center',\r\n    }}>\r\n      <CircularProgress />\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useCallback, ChangeEvent } from 'react';\r\nimport {\r\n  Card,\r\n  CardHeader,\r\n  IconButton,\r\n  Avatar,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n  TextField,\r\n  Button,\r\n} from '@material-ui/core';\r\nimport { MoreVert as MoreIcon } from '@material-ui/icons';\r\nimport { useSelector, shallowEqual, useDispatch } from 'react-redux';\r\n\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport FullScreenLoading from '@client/ui/FullScreenLoading';\r\nimport { userEffects } from '@client/store/effects';\r\nimport { IS_DEV_CLIENT } from '@client/util/constants';\r\n\r\nimport './index.scss';\r\n\r\nconst selectorAccountCard = ({ user: { user } }: IReduxState) => ({ user });\r\n\r\nexport default function AccountCard() {\r\n  if (IS_DEV_CLIENT) {\r\n    console.log('render AccountCard');\r\n  }\r\n  const { user } = useSelector(selectorAccountCard, shallowEqual);\r\n  const [changedUsername, setChangedUsername] = useState(\r\n    user != null ? user.username : '',\r\n  );\r\n  const updateUsername = useCallback(\r\n    (evt: ChangeEvent<HTMLInputElement>) =>\r\n      setChangedUsername(evt.target.value.trim()),\r\n    [setChangedUsername],\r\n  );\r\n\r\n  // -- 更改用户名相关逻辑\r\n  const [isShowChangeNameDialog, setIsShowChangeNameDialog] = useState(false);\r\n  const dispatch = useDispatch();\r\n  const openChangeNameModal = useCallback(\r\n    () => setIsShowChangeNameDialog(true),\r\n    [setIsShowChangeNameDialog],\r\n  );\r\n  const closeChangeName = useCallback(() => setIsShowChangeNameDialog(false), [\r\n    setIsShowChangeNameDialog,\r\n  ]);\r\n  const confirmChangeUsername = useCallback(() => {\r\n    const isEmptyName = changedUsername.trim().length === 0;\r\n    if (user != null && !isEmptyName && user.username !== changedUsername) {\r\n      // 只有名字不为空，且前后发生变化, 才发送请求\r\n      dispatch(userEffects.changeUsername(changedUsername));\r\n    }\r\n    if (!isEmptyName) closeChangeName();\r\n  }, [user, changedUsername, dispatch, closeChangeName]);\r\n\r\n  if (user == null) return <FullScreenLoading />;\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={isShowChangeNameDialog} onClose={closeChangeName}>\r\n        <DialogTitle>更改用户名</DialogTitle>\r\n        <DialogContent>\r\n          <TextField\r\n            fullWidth\r\n            type=\"text\"\r\n            placeholder=\"用户名\"\r\n            value={changedUsername}\r\n            onChange={updateUsername}\r\n          />\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button\r\n            disabled={changedUsername.trim().length === 0}\r\n            onClick={confirmChangeUsername}\r\n          >\r\n            确定\r\n          </Button>\r\n          <Button onClick={closeChangeName}>取消</Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n      <div className=\"user-info\">\r\n        <Card>\r\n          <CardHeader\r\n            title={\r\n              <span style={{ color: '#000' }}>你好，{user.username}！</span>\r\n            }\r\n            subheader={`登陆于${new Date().toLocaleTimeString()}`}\r\n            avatar={<Avatar>{user.username[0]}</Avatar>}\r\n            action={\r\n              <IconButton onClick={openChangeNameModal}>\r\n                <MoreIcon />\r\n              </IconButton>\r\n            }\r\n          ></CardHeader>\r\n        </Card>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import './index.scss';\r\n\r\nimport { createHandleOnKeyEnterUp } from '@client/util/helper';\r\nimport { AppBar, Button, Dialog, DialogActions, DialogContent, DialogTitle, IconButton, TextField } from '@material-ui/core';\r\nimport { Add as PlusIcon, SearchOutlined as SearchIcon } from '@material-ui/icons';\r\nimport { push } from 'connected-react-router';\r\nimport React, { useCallback, useState } from 'react';\r\nimport { useDispatch } from 'react-redux';\r\n\r\nconst GameLobbyHeader = React.memo(function GameLobbyHeader() {\r\n  const dispatch = useDispatch();\r\n\r\n  const [isShowFindRoom, setIsShowFindRoom] = useState(false);\r\n  const closeFindRoom = useCallback(() => setIsShowFindRoom(false), [\r\n    setIsShowFindRoom,\r\n  ]);\r\n\r\n  const [roomId, setRoomId] = useState('');\r\n  const jumoToFindRoom = useCallback(() => {\r\n    if (roomId.trim().length === 0) return;\r\n    dispatch(push(`/room/${roomId}`));\r\n  }, [roomId, dispatch]);\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={isShowFindRoom} onClose={closeFindRoom}>\r\n        <DialogTitle>查找房间</DialogTitle>\r\n        <DialogContent>\r\n          <TextField\r\n            fullWidth\r\n            type=\"text\"\r\n            placeholder=\"房间号\"\r\n            value={roomId}\r\n            onChange={evt => setRoomId(evt.target.value.trim())}\r\n            onKeyUp={createHandleOnKeyEnterUp(jumoToFindRoom)}\r\n          />\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button\r\n            disabled={roomId.trim().length === 0}\r\n            onClick={jumoToFindRoom}\r\n          >\r\n            确定\r\n          </Button>\r\n          <Button onClick={closeFindRoom}>取消</Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n      <AppBar\r\n        style={{\r\n          boxShadow: 'none',\r\n        }}\r\n        position=\"static\"\r\n      >\r\n        <div className=\"game-lobby-header\">\r\n          <IconButton color=\"default\" onClick={() => setIsShowFindRoom(true)}>\r\n            <SearchIcon />\r\n          </IconButton>\r\n          <div className=\"game-lobby-header-title\">\r\n            你画我猜-游戏大厅(v0.99)\r\n          </div>\r\n          <IconButton onClick={() => dispatch(push('/create-room'))}>\r\n            <PlusIcon />\r\n          </IconButton>\r\n        </div>\r\n      </AppBar>\r\n    </>\r\n  );\r\n});\r\n\r\nexport default GameLobbyHeader;\r\n","import './index.scss';\r\n\r\nimport { roomActions } from '@client/store/actions';\r\nimport { roomEffects } from '@client/store/effects';\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport { IS_DEV_CLIENT } from '@client/util/constants';\r\nimport wsClient from '@client/WebsocketClient/wsClient';\r\nimport { Button, IconButton, List, ListSubheader } from '@material-ui/core';\r\nimport { LoopOutlined as FreshIcon } from '@material-ui/icons';\r\nimport { push } from 'connected-react-router';\r\nimport React, { useCallback, useEffect } from 'react';\r\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\r\n\r\nimport { RoomStatus } from '../../../../../shared/constants/room';\r\nimport { IRoom } from '../../../../../shared/types';\r\n\r\nconst statusText = {\r\n  [RoomStatus.GAMING]: '游戏中',\r\n  [RoomStatus.WAITING]: '等待中...',\r\n};\r\n\r\nfunction RoomListItem({ room }: { room: IRoom }) {\r\n  const dispatch = useDispatch();\r\n  return (\r\n    <div className=\"room-list-room\">\r\n      <div className=\"room-info\">\r\n        <div className=\"room-name\">{room.name}</div>\r\n        <div className=\"room-number\">No.{String(room.id).padStart(5, '0')}</div>\r\n      </div>\r\n      <div className=\"room-actions\">\r\n        <div className=\"room-status\">{statusText[room.status]}</div>\r\n        <Button\r\n          onClick={() => dispatch(push(`/room/${room.id}`))}\r\n          style={{ boxShadow: 'none' }}\r\n          fullWidth\r\n          variant=\"contained\"\r\n          color=\"primary\"\r\n        >\r\n          加入{`(${room.users.length}/${room.maxPlayerNumber})`}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst selectorRoomList = ({\r\n  room: { roomList },\r\n}: IReduxState) => ({\r\n  roomList,\r\n});\r\n\r\nexport default function RoomList() {\r\n  if (IS_DEV_CLIENT) {\r\n    console.log('render RoomList');\r\n  }\r\n\r\n  const { roomList } = useSelector(selectorRoomList, shallowEqual);\r\n\r\n  const dispatch = useDispatch();\r\n  const freshRoomList = useCallback(() => {\r\n    dispatch(roomEffects.getRoomList());\r\n  }, [dispatch]);\r\n\r\n  useEffect(() => {\r\n    freshRoomList();\r\n\r\n    const refreshRoomListOff = wsClient.on('refreshRoomList', respData => {\r\n      const roomList = respData as IRoom[];\r\n      dispatch(roomActions.createSetRoomList(roomList));\r\n    });\r\n\r\n    return () => {\r\n      refreshRoomListOff();\r\n    };\r\n  }, [dispatch, freshRoomList]);\r\n\r\n  return (\r\n    <div className=\"room-list\">\r\n      <List\r\n        subheader={\r\n          <ListSubheader>\r\n            房间列表\r\n            <IconButton onClick={freshRoomList}>\r\n              <FreshIcon />\r\n            </IconButton>\r\n          </ListSubheader>\r\n        }\r\n        className=\"room-list\"\r\n      >\r\n        {roomList.length === 0 ? (\r\n          <div className=\"no-room-text\">暂无公开房间</div>\r\n        ) : (\r\n          <div className=\"room-list-content\">\r\n            {roomList.map(room => (\r\n              <RoomListItem key={room.id} room={room} />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </List>\r\n    </div>\r\n  );\r\n}\r\n","import './index.scss';\r\n\r\nimport { useDocumentTitle } from '@client/hooks';\r\nimport Notification from '@client/model/Notification';\r\nimport { globalActions } from '@client/store/actions';\r\nimport { globalEffects } from '@client/store/effects';\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport FullScreenLoading from '@client/ui/FullScreenLoading';\r\nimport React, { useEffect } from 'react';\r\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\r\n\r\nimport AccountCard from './components/AccountCard';\r\nimport GameLobbyHeader from './components/GameLobbyHeader';\r\nimport RoomList from './components/RoomList';\r\n\r\nlet isTipShowd = false; // 这里\r\n\r\nconst indexSelector = ({\r\n  global: { numberOfOnlinePlayer },\r\n  user: { user },\r\n}: IReduxState) => ({\r\n  numberOfOnlinePlayer,\r\n  user,\r\n});\r\n\r\nexport default function GameLobby() {\r\n  useDocumentTitle('游戏大厅');\r\n\r\n  const { numberOfOnlinePlayer, user } = useSelector(\r\n    indexSelector,\r\n    shallowEqual,\r\n  );\r\n  const dispatch = useDispatch();\r\n  if (!isTipShowd) {\r\n    dispatch(globalActions.createAddNotification(new Notification('本应用暂时不支持鼠标绘画', 'warn')));\r\n    isTipShowd = true;\r\n  }\r\n  useEffect(() => {\r\n    dispatch(globalEffects.getNumberOfOnlinePlayer());\r\n  }, [dispatch]);\r\n\r\n\r\n  if (user == null) return <FullScreenLoading />;\r\n\r\n  return (\r\n    <div className=\"view-game-lobby\">\r\n      <div className=\"view-game-lobby-header\">\r\n        <GameLobbyHeader />\r\n      </div>\r\n      <div className=\"view-game-lobby-main\">\r\n        <AccountCard />\r\n        <div className=\"room-list-wrapper\">\r\n          <RoomList />\r\n        </div>\r\n      </div>\r\n      <div className=\"view-game-lobby-footer\">\r\n        <div className=\"number-of-online-player\">\r\n          当前在线人数: {numberOfOnlinePlayer}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { IconButton, Snackbar } from '@material-ui/core';\r\nimport { Close as CloseIcon } from '@material-ui/icons';\r\nimport { globalActions } from '@client/store/actions';\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport React, { useCallback } from 'react';\r\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\r\n\r\nconst selectorNotificationPanel = ({ global: { notifications } }: IReduxState) => ({\r\n  notifications,\r\n});\r\n\r\nconst NotificationPanel = React.memo(function NotificationPanel() {\r\n  const { notifications } = useSelector(selectorNotificationPanel, shallowEqual);\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  const shiftNotification = useCallback(() => {\r\n    dispatch(globalActions.createShiftNotification());\r\n  }, [dispatch]);\r\n\r\n\r\n  return (\r\n    <>\r\n    {notifications.map(n => (\r\n      <Snackbar\r\n      key={n.id}\r\n      anchorOrigin={{ vertical: 'top', horizontal: 'center' }}\r\n      // key={`${vertical},${horizontal}`}\r\n      open={true}\r\n      onClose={shiftNotification}\r\n      autoHideDuration={4000}\r\n      action={\r\n        <IconButton onClick={shiftNotification} key=\"close\" aria-label=\"close\" color=\"inherit\">\r\n          <CloseIcon />\r\n        </IconButton>\r\n      }\r\n      message={<span>{n.detail == null ? n.title : `${n.title}-${n.detail}`}</span>}\r\n    />\r\n    ))}\r\n    </>\r\n  );\r\n});\r\n\r\nexport default NotificationPanel;\r\n","import './index.scss';\r\n\r\nimport { useDocumentTitle } from '@client/hooks';\r\nimport { globalEffects, roomEffects } from '@client/store/effects';\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport {\r\n  AppBar,\r\n  Button,\r\n  FormControl,\r\n  FormControlLabel,\r\n  IconButton,\r\n  List,\r\n  ListItem,\r\n  Radio,\r\n  RadioGroup,\r\n  TextField,\r\n} from '@material-ui/core';\r\nimport { ArrowBackOutlined as BackIcon } from '@material-ui/icons';\r\nimport { goBack } from 'connected-react-router';\r\nimport React, { ChangeEvent, useCallback, useEffect, useState } from 'react';\r\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\r\n\r\nimport { RoomType } from '../../../../shared/constants/room';\r\n\r\nconst indexSelector = ({\r\n  global: { numberOfOnlinePlayer },\r\n  user: { user },\r\n}: IReduxState) => ({\r\n  numberOfOnlinePlayer,\r\n  username: user == null ? '' : user.username,\r\n});\r\n\r\nexport default function CreateRoom() {\r\n  useDocumentTitle('创建房间');\r\n\r\n  const { username } = useSelector(indexSelector, shallowEqual);\r\n  const defaultRoomName = `${username}的房间`;\r\n  const [roomName, setRoomName] = useState(defaultRoomName);\r\n  const [roomType, setRoomType] = useState(RoomType.PUBLIC);\r\n\r\n  const dispatch = useDispatch();\r\n  useEffect(() => {\r\n    dispatch(globalEffects.getNumberOfOnlinePlayer());\r\n  }, [dispatch]);\r\n\r\n  const createRoom = useCallback(() => {\r\n    dispatch(roomEffects.createRoom(roomName, roomType));\r\n  }, [roomName, roomType, dispatch]);\r\n\r\n  const [isUsingDefaultRoomName, setIsUsingDefaultRoomName] = useState(true);\r\n  const updateRoomName = useCallback(\r\n    (evt: ChangeEvent<HTMLInputElement>) => {\r\n      setIsUsingDefaultRoomName(false);\r\n      setRoomName(evt.target.value);\r\n    },\r\n    [setRoomName, setIsUsingDefaultRoomName],\r\n  );\r\n\r\n  return (\r\n    <div className=\"view-room-creator\">\r\n      <AppBar\r\n        style={{\r\n          boxShadow: 'none',\r\n        }}\r\n        position=\"static\"\r\n      >\r\n        <div className=\"create-room-header\">\r\n          <IconButton onClick={() => dispatch(goBack())}>\r\n            <BackIcon />\r\n          </IconButton>\r\n          <div className=\"create-room-header-title\">创建房间</div>\r\n        </div>\r\n      </AppBar>\r\n      <div className=\"view-room-creator-main\">\r\n        <FormControl fullWidth>\r\n          <List>\r\n            <ListItem>\r\n              <TextField\r\n                label=\"房间名\"\r\n                fullWidth\r\n                placeholder=\"请输入房间名字\"\r\n                type=\"text\"\r\n                variant=\"outlined\"\r\n                value={isUsingDefaultRoomName ? defaultRoomName : roomName}\r\n                onChange={updateRoomName}\r\n              />\r\n            </ListItem>\r\n            <RadioGroup\r\n              value={roomType}\r\n              onChange={evt => setRoomType(evt.target.value as RoomType)}\r\n              name=\"room-type\"\r\n            >\r\n              <ListItem button onClick={() => setRoomType(RoomType.PUBLIC)}>\r\n                <FormControlLabel\r\n                  value={RoomType.PUBLIC}\r\n                  control={<Radio color=\"primary\" />}\r\n                  label=\"公开\"\r\n                  labelPlacement=\"end\"\r\n                />\r\n              </ListItem>\r\n              <ListItem button onClick={() => setRoomType(RoomType.PRIVATE)}>\r\n                <FormControlLabel\r\n                  value={RoomType.PRIVATE}\r\n                  control={<Radio color=\"primary\" />}\r\n                  label=\"私人(不显示在游戏大厅)\"\r\n                  labelPlacement=\"end\"\r\n                />\r\n              </ListItem>\r\n            </RadioGroup>\r\n            <ListItem>\r\n              <Button\r\n                style={{ boxShadow: 'none' }}\r\n                onClick={createRoom}\r\n                fullWidth\r\n                color=\"primary\"\r\n                variant=\"contained\"\r\n              >\r\n                创建房间\r\n              </Button>\r\n            </ListItem>\r\n          </List>\r\n        </FormControl>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","export * from './room';\r\n\r\nexport enum ReservedEventName { // 会用到的事件名，这里前后端统一调用这里的，避免字符串拼错什么的\r\n  REFRESH_USER = 'refreshUser',\r\n  REFRESH_ROOM = 'refreshRoom',\r\n  REFRESH_ROOM_LIST = 'refreshRoomList',\r\n  ROOM_CHATTING = 'roomChatting',\r\n  // 游戏相关\r\n  TIMEOUT = 'timeout',\r\n  REFRESH_GAME = 'refreshGame',\r\n  DRAW_ACTION = 'drawAction',\r\n  START_GAME = 'startGame',\r\n  GAME_CHATTING = 'gameChatting',\r\n  CHANGE_DRAWER = 'changeDrawer',\r\n  ROUND_OVER = 'roundOver',\r\n  GAME_OVER = 'gameOver',\r\n  PLAY_OVER = 'playOver',\r\n  REFRESH_GAME_USERS = 'refreshGameUsers',\r\n  // REFRESH_ONLINE_USER_NUMBER = 'refreshOnLineUserNumber',\r\n}\r\n","import './index.scss';\r\n\r\nimport { roomEffects } from '@client/store/effects';\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport { createHandleOnKeyEnterUp } from '@client/util/helper';\r\nimport wsClient from '@client/WebsocketClient/wsClient';\r\nimport { Button, List as div, ListItem, TextField } from '@material-ui/core';\r\nimport React, { useCallback, useEffect, useState } from 'react';\r\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\r\n\r\nimport ChattingMessage from '../../../../../../shared/models/ChattingMessage';\r\nimport { ReservedEventName } from '../../../../../../shared/constants';\r\n\r\nconst selectorRoomMessage = ({\r\n  user: { user },\r\n}: IReduxState) => ({\r\n  username: user == null ? '' : user.username,\r\n  userId: user == null ? '' : user.id,\r\n});\r\n\r\nfunction RoomChatting() {\r\n  const { userId } = useSelector(\r\n    selectorRoomMessage,\r\n    shallowEqual,\r\n  );\r\n  const [chatMsgList, setChatMsgList] = useState<ChattingMessage[]>([]);\r\n  useEffect(() => {\r\n    const offReciveChatMessage = wsClient.on(ReservedEventName.ROOM_CHATTING, (_, msg) => {\r\n      const chatMsg = msg.data as ChattingMessage;\r\n      setChatMsgList(prev => [chatMsg].concat(...prev));\r\n    });\r\n    return offReciveChatMessage;\r\n  }, [setChatMsgList]);\r\n\r\n  // chat msg 相关\r\n\r\n  const [chattingContent, setChattingContent] = useState('');\r\n  const dispatch = useDispatch();\r\n  const sendChatMessage = useCallback(() => {\r\n    if (chattingContent.trim().length === 0) return;\r\n    setChattingContent('');\r\n    dispatch(roomEffects.sendChatMessage(chattingContent));\r\n  }, [chattingContent, dispatch, setChattingContent]);\r\n\r\n  return (\r\n    <div className=\"room-message\">\r\n      <div className=\"room-message-list\">\r\n        {chatMsgList.map(cm => (\r\n          <ListItem className=\"room-message-list-item\" key={cm.id}>\r\n            <div className=\"room-message-speaker\">\r\n              <span className=\"room-message-speaker-name\">\r\n                {cm.speaker.id === userId ? '我' : cm.speaker.name}:\r\n              </span>\r\n\r\n            </div>\r\n            <div className=\"room-message-content\">{cm.content}</div>\r\n            <div className=\"room-message-speaker-time\">\r\n              {new Date(cm.timestamp).toLocaleTimeString()}\r\n            </div>\r\n          </ListItem>\r\n        ))}\r\n      </div>\r\n      <div className=\"room-message-sender\">\r\n          <TextField\r\n            variant=\"outlined\"\r\n            value={chattingContent}\r\n            onChange={evt => setChattingContent(evt.target.value)}\r\n            onKeyUp={createHandleOnKeyEnterUp(sendChatMessage)}\r\n            fullWidth\r\n          />\r\n          &nbsp;\r\n          <Button\r\n            onClick={sendChatMessage}\r\n            variant=\"text\"\r\n          >\r\n            发送\r\n          </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default RoomChatting;\r\n","import { useDocumentTitle } from '@client/hooks';\r\nimport { roomEffects } from '@client/store/effects';\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport { AppBar, Button, Toolbar, Typography } from '@material-ui/core';\r\nimport { ArrowBackOutlined as BackIcon } from '@material-ui/icons';\r\nimport React from 'react';\r\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\r\n\r\nimport { RoomType } from '../../../../../shared/constants';\r\n\r\n// import { IGame, IRoom, IUser } from 'shared/types';\r\n\r\nconst selectorPlayingRoom = ({ room: { currentRoom } }: IReduxState) => ({\r\n  roomId: currentRoom ? currentRoom.id : -1,\r\n  roomName: currentRoom ? currentRoom.name : '',\r\n  roomType: currentRoom ? currentRoom.type : RoomType.PUBLIC,\r\n});\r\n\r\nconst roomTypeTextMapping = {\r\n  [RoomType.PRIVATE]: '(私人)',\r\n  [RoomType.PUBLIC]: '',\r\n};\r\n\r\nconst RoomHeader = React.memo(function RoomHeader() {\r\n  useDocumentTitle('房间');\r\n  const { roomName, roomType, roomId } = useSelector(\r\n    selectorPlayingRoom,\r\n    shallowEqual,\r\n  );\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  return (\r\n    <AppBar\r\n      style={{\r\n        boxShadow: 'none',\r\n      }}\r\n      position=\"static\"\r\n    >\r\n      <Toolbar>\r\n        <Button\r\n          onClick={() => {\r\n            console.log('cliuck');\r\n            dispatch(roomEffects.leaveRoom());\r\n          }}\r\n          color=\"inherit\"\r\n        >\r\n          <BackIcon />\r\n          离开房间\r\n        </Button>\r\n        <Typography\r\n          style={{\r\n            flex: 1,\r\n            textAlign: 'center',\r\n          }}\r\n        >\r\n          {roomName}\r\n          {roomTypeTextMapping[roomType]}\r\n        </Typography>\r\n        <Button color=\"inherit\">\r\n          房间号: {String(roomId).padStart(5, '0')}\r\n        </Button>\r\n      </Toolbar>\r\n    </AppBar>\r\n  );\r\n});\r\n\r\nexport default RoomHeader;\r\n","import React from 'react';\r\nimport { deepOrange } from '@material-ui/core/colors'\r\n\r\nimport './index.scss';\r\n\r\nfunction AvatarStatus({ text, bgColor }: { text: string, bgColor?: 'red' | 'blue' | 'green' | 'grey'}) {\r\n  return <div style={{\r\n    backgroundColor: bgColor || 'blue',\r\n  }} className=\"user-avatar-status\">{text}</div>;\r\n}\r\nReact.createElement(AvatarStatus);\r\nfunction UserAvatar({ children, avatar, style }: { children?: any; avatar: string, style?: React.CSSProperties  }) {\r\n  return (\r\n    <div\r\n      style={{\r\n        height: '18vw',\r\n        width: '18vw',\r\n      }}\r\n      className=\"user-avatar-wrapper\"\r\n    >\r\n      {children}\r\n      <div style={{\r\n        backgroundColor: deepOrange[500],\r\n        ...style,\r\n      }} className=\"user-avatar\">{avatar}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nUserAvatar.AvatarStatus = AvatarStatus;\r\n\r\nexport default UserAvatar;\r\n","import './index.scss';\r\n\r\nimport UserAvatar from '@client/ui/UserAvatar';\r\nimport React from 'react';\r\nimport { shallowEqual, useSelector } from 'react-redux';\r\nimport { IReduxState } from 'store/reducers';\r\n\r\nimport { IUser } from '../../../../../../shared/types';\r\n\r\nconst arrOfEight = new Array(8).fill(null);\r\n\r\nconst selectorUserList = ({ user: { user } }: IReduxState) => ({\r\n  userId: user ? user.id : '',\r\n});\r\n\r\nconst UserList = React.memo(function UserList({ users }: { users: IUser[] }) {\r\n  const { userId } = useSelector(selectorUserList, shallowEqual);\r\n  return (\r\n    <div className=\"user-list\">\r\n      {arrOfEight.map((_, index) => {\r\n        if (index < users.length) {\r\n          const user = users[index];\r\n          return (\r\n            <div key={user.id} className=\"user-list-user\">\r\n              <UserAvatar avatar={user.username[0]}>\r\n                {user.id === userId ? (\r\n                  <UserAvatar.AvatarStatus text=\"我\" />\r\n                ) : null}\r\n                {user && index === 0 ? (\r\n                  <UserAvatar.AvatarStatus text=\"房主\" />\r\n                ) : null}\r\n                {user.isOnLine ? null : (\r\n                  <UserAvatar.AvatarStatus bgColor=\"grey\" text=\"已离线\" />\r\n                )}\r\n                {user.isReady ? (\r\n                  <UserAvatar.AvatarStatus bgColor=\"green\" text=\"已准备\" />\r\n                ) : null}\r\n              </UserAvatar>\r\n              <div className=\"user-list-item-username\">{user.username}</div>\r\n            </div>\r\n          );\r\n        }\r\n        return (\r\n          <div key={index} className=\"user-list-user\">\r\n            <UserAvatar\r\n              style={{\r\n                backgroundColor: '#fff',\r\n                color: '#000',\r\n              }}\r\n              avatar=\"空\"\r\n            />\r\n            <div className=\"user-list-item-username\">等待加入</div>\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default UserList;\r\n","import './index.scss';\r\n\r\nimport { useDocumentTitle } from '@client/hooks';\r\nimport { roomActions, userActions } from '@client/store/actions';\r\nimport { roomEffects } from '@client/store/effects';\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport FullScreenLoading from '@client/ui/FullScreenLoading';\r\nimport wsClient from '@client/WebsocketClient/wsClient';\r\nimport { Button } from '@material-ui/core';\r\nimport React, { useCallback, useEffect } from 'react';\r\nimport { batch as batchDispatch, shallowEqual, useDispatch, useSelector } from 'react-redux';\r\nimport { Redirect, useParams } from 'react-router-dom';\r\n\r\nimport { ReservedEventName } from '../../../../shared/constants';\r\nimport { RoomStatus } from '../../../../shared/constants/room';\r\nimport { IGame, IRoom, IUser } from '../../../../shared/types';\r\nimport RoomChatting from './components/RoomChatting';\r\nimport RoomHeader from './components/RoomHeader';\r\nimport UserList from './components/UserList';\r\n\r\n// import { IGame, IRoom, IUser } from 'shared/types';\r\n\r\nconst selectorPlayingRoom = ({\r\n  room: { currentRoom },\r\n  user: { user },\r\n}: IReduxState) => ({\r\n  currentRoom,\r\n  isReady: user == null ? false : user.isReady,\r\n});\r\n\r\n// const roomTypeTextMapping = {\r\n//   [RoomType.PRIVATE]: '(私人)',\r\n//   [RoomType.PUBLIC]: '',\r\n// };\r\n\r\nexport default function PlayingRoom() {\r\n  useDocumentTitle('房间');\r\n  const { currentRoom, isReady } = useSelector(\r\n    selectorPlayingRoom,\r\n    shallowEqual,\r\n  );\r\n\r\n  const { roomId: rawRoomId } = useParams<{ roomId: string }>();\r\n  const roomId = parseInt(rawRoomId, 10);\r\n\r\n  const dispatch = useDispatch();\r\n  const toggleGameReady = useCallback(() => {\r\n    dispatch(roomEffects.makeGameIsReady(!isReady));\r\n  }, [isReady, dispatch]);\r\n\r\n  useEffect(() => {\r\n    const refreshRoomInfoOff = wsClient.on(ReservedEventName.REFRESH_ROOM, (_, msg) => {\r\n      const room = msg.data as IRoom;\r\n      dispatch(roomActions.createSetRoom(room));\r\n    });\r\n    const startGameOff = wsClient.on(ReservedEventName.START_GAME, (_, msg) => {\r\n      const { user, game } = msg.data as {\r\n        user: IUser,\r\n        game: IGame,\r\n      };\r\n      batchDispatch(() => {\r\n        dispatch(roomActions.createSetCurrentGame(game));\r\n        dispatch(roomActions.createSetCurrentRoomStatus(RoomStatus.GAMING));\r\n        dispatch(userActions.createSetIsGaming(user.isGaming));\r\n        dispatch(userActions.createSetIsReady(user.isReady));\r\n      })\r\n    });\r\n    return () => {\r\n      refreshRoomInfoOff();\r\n      startGameOff();\r\n    };\r\n  }, [roomId, dispatch]);\r\n\r\n  useEffect(() => {\r\n    if (Number.isNaN(roomId)) return;\r\n    dispatch(roomEffects.enterRoom(roomId));\r\n  }, [dispatch, roomId]);\r\n\r\n  if (rawRoomId == null) return <Redirect to=\"/\" />;\r\n  if (currentRoom == null) return <FullScreenLoading />;\r\n\r\n  return (\r\n    <div className=\"view-playing-room\">\r\n      <div className=\"view-playing-room-header\">\r\n        <RoomHeader />\r\n      </div>\r\n      <div className=\"view-playing-room-main\">\r\n        <UserList users={currentRoom.users} />\r\n        <div className=\"start-game-button-wrapper\">\r\n          <Button style={{\r\n            // backgroundColor: 'orange',\r\n            // color: '#fff',\r\n            boxShadow: 'none',\r\n          }} onClick={toggleGameReady} color=\"primary\" className=\"start-game-button\" variant=\"contained\" fullWidth>\r\n            {isReady ? '取消准备' : '准备'}\r\n          </Button>\r\n        </div>\r\n        <div className=\"room-message-wrapper\">\r\n          <RoomChatting />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useEffect } from 'react';\r\nimport { useDispatch, useSelector, shallowEqual } from 'react-redux';\r\nimport { replace } from 'connected-react-router';\r\nimport { IReduxState } from '../store/reducers';\r\nimport FullScreenLoading from '../ui/FullScreenLoading';\r\nimport { userEffects } from '../store/effects';\r\n\r\nconst selectorAuthLoyout = ({ user: { user }, router: { location: { pathname } } }: IReduxState) => ({\r\n  user,\r\n  pathname,\r\n});\r\n\r\nexport default function AuthLoyout({ children}: {children: any}) {\r\n\r\n  const { user, pathname } = useSelector(selectorAuthLoyout, shallowEqual);\r\n\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    if (user == null) {\r\n      dispatch(userEffects.login());\r\n      return;\r\n    }\r\n\r\n    if (user.isGaming && user.currentRoomId == null) {\r\n      console.error('用户正在游戏中', '但找不到房间号');\r\n    }\r\n\r\n    if (user.isGaming && user.currentRoomId != null) {\r\n      const targetPath = `/game/${user.currentRoomId}`;\r\n      if (pathname !== targetPath) dispatch(replace(targetPath));\r\n    } else if (user.currentRoomId != null) {\r\n      const targetPath = `/room/${user.currentRoomId}`;\r\n      if (pathname !== targetPath) dispatch(replace(targetPath));\r\n    }\r\n  }, [user, pathname, dispatch]);\r\n\r\n  if (user == null) return <FullScreenLoading />\r\n\r\n  return children;\r\n}\r\n","import React, { useCallback, useState } from 'react';\r\nimport { TextField, Button } from '@material-ui/core';\r\n\r\nimport './index.scss';\r\nimport WebsocketClient from '@client/WebsocketClient';\r\nimport RequestMessage from '../../../../../../shared/models/RequestMessage';\r\nimport { createHandleOnKeyEnterUp } from '@client/util/helper';\r\n\r\n// 以 375宽 为标准\r\n\r\nfunction AnswerInputBox({ wsClient }: { wsClient: WebsocketClient }) {\r\n  const [answer, setAnswer] = useState('');\r\n\r\n  const sendGuessAnswer = useCallback(() => {\r\n    if (answer.trim().length === 0) return;\r\n    const reqMsg = new RequestMessage(answer, 'guessAnswer');\r\n    wsClient.sendMessage(reqMsg);\r\n    setAnswer('');\r\n  }, [answer, wsClient, setAnswer]);\r\n\r\n  const handleOnKeyEnterUp = useCallback(\r\n    createHandleOnKeyEnterUp(sendGuessAnswer),\r\n    [sendGuessAnswer],\r\n  );\r\n\r\n  return (\r\n    <div className=\"answer-input-box\">\r\n      <TextField\r\n        onKeyUp={handleOnKeyEnterUp}\r\n        value={answer}\r\n        onChange={evt => setAnswer(evt.target.value.trim())}\r\n        placeholder=\"输入你猜测的答案\"\r\n        className=\"answer-input\"\r\n        variant=\"outlined\"\r\n        type=\"text\"\r\n      />\r\n      <Button variant=\"outlined\" onClick={sendGuessAnswer}>\r\n        发送\r\n      </Button>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default AnswerInputBox;\r\n","export enum DrawActionType {\r\n  START_DRAW_LINE = 'startDrawLine',\r\n  DRAW_LINE_TO = 'drawLineTo',\r\n  // END_DRAW_LINE = 'endDrawLine',\r\n  DRAW_IMAGE = 'drawImage',\r\n  // CLEAR_CANVAS = 'clearCanvas',\r\n  // SET_OPTIONS = 'setOptions',\r\n}\r\n\r\nexport type TDrawerExternals = Omit<DrawAction, 'type' | 'payload'>;\r\n\r\n\r\nexport default class DrawAction {\r\n  static Type = DrawActionType;\r\n  ignore?: boolean; // 要求服务器忽略转发此 action\r\n  constructor(public type: DrawActionType, public payload?: unknown, externals?: TDrawerExternals) {\r\n    Object.assign(this, externals);\r\n  }\r\n}\r\n","import Point from './Point';\r\n\r\nexport interface ICanvasControllerSetting {\r\n  penSize?: number;\r\n  penColor?: string;\r\n}\r\n\r\nexport default class CanvasController {\r\n  public ctx: CanvasRenderingContext2D;\r\n  public canvasEl: HTMLCanvasElement;\r\n  get penColor() {\r\n    return this.ctx.strokeStyle as string;\r\n  }\r\n  set penColor(color: string) {\r\n    this.ctx.strokeStyle = color;\r\n    this.ctx.fillStyle = color;\r\n  }\r\n  get penSize() {\r\n    return this.ctx.lineWidth;\r\n  }\r\n  set penSize(size: number) {\r\n    this.ctx.lineWidth = size;\r\n  }\r\n  constructor(canvasEl?: HTMLCanvasElement, options?: {\r\n    penColor?: string;\r\n    penSize?: number;\r\n  }) {\r\n    this.canvasEl =\r\n      canvasEl == null ? document.createElement('canvas') : canvasEl;\r\n    this.ctx = this.canvasEl.getContext('2d') as CanvasRenderingContext2D;\r\n    this.init();\r\n    if (options != null) {\r\n      if (options.penColor != null) this.setPenColor(options.penColor);\r\n      if (options.penSize != null) this.setPenSize(options.penSize);\r\n    }\r\n  }\r\n\r\n  init() {\r\n    this.ctx.fillStyle = this.penColor;\r\n    this.ctx.strokeStyle = this.penColor;\r\n    this.ctx.lineWidth = this.penSize;\r\n  }\r\n\r\n  // new\r\n\r\n  getSetting(): Required<ICanvasControllerSetting> {\r\n    return {\r\n      penSize: this.penSize,\r\n      penColor: this.penColor,\r\n    }\r\n  }\r\n\r\n  setting(s: ICanvasControllerSetting) {\r\n    if (s.penColor != null) this.penColor = s.penColor;\r\n    if (s.penSize != null) this.penSize = s.penSize;\r\n  }\r\n\r\n  drawImage(image: HTMLImageElement | string) {\r\n    // console.log('image', image);\r\n    if (typeof image === 'string') {\r\n      const img = new Image();\r\n      img.onload = () => {\r\n        this.clearCanvas();\r\n        this.drawImage(img);\r\n      };\r\n      img.src = image;\r\n    } else {\r\n      this.ctx.drawImage(image, 0, 0);\r\n    }\r\n  }\r\n\r\n  drawPoint(to: Point, r: number = this.penSize / 2) {\r\n    const { ctx } = this;\r\n    console.log('drawPoint', 'r',r , 'lineWidth', this.ctx.lineWidth);\r\n    ctx.beginPath();\r\n    ctx.arc(to.x, to.y, r, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    // ctx.stroke();\r\n    ctx.closePath();\r\n  }\r\n\r\n  getSnapshot() {\r\n    return this.canvasEl.toDataURL('image/jpeg', 1);\r\n  }\r\n\r\n  startDrawLine(startPoint: Point) {\r\n    const sp = startPoint;\r\n    const { ctx } = this;\r\n    ctx.beginPath();\r\n    ctx.moveTo(sp.x, sp.y);\r\n  }\r\n\r\n  drawLineTo(to: Point) {\r\n    // console.log('to', to);\r\n    const { ctx } = this;\r\n    ctx.lineTo(to.x, to.y);\r\n    ctx.stroke();\r\n  }\r\n\r\n  mount(elementSelector: string) {\r\n    const el = document.querySelector(elementSelector);\r\n    // (window as any).el = el;\r\n    if (el != null) {\r\n      el.append(this.canvasEl);\r\n      this.canvasEl.height = el.clientHeight;\r\n      this.canvasEl.width = el.clientWidth;\r\n      this.clearCanvas();\r\n    } else {\r\n      throw new Error(`无法通过 ${elementSelector} 找到相应的元素，请确定选择器书写正确，或元素确实存在`);\r\n    }\r\n  }\r\n\r\n  clearCanvas() {\r\n    const prevFillStyle = this.ctx.fillStyle;\r\n    this.ctx.fillStyle = '#fff';\r\n    this.ctx.clearRect(0, 0, this.canvasEl.width, this.canvasEl.height);\r\n    this.ctx.fillRect(0, 0, this.canvasEl.width, this.canvasEl.height);\r\n    this.ctx.fillStyle = prevFillStyle;\r\n  }\r\n\r\n  // end new\r\n\r\n  setOptions(op: {\r\n    penColor?: string;\r\n    penSize?: number;\r\n  }) {\r\n    if (op.penColor != null) this.setPenColor(op.penColor);\r\n    if (op.penSize != null) this.setPenSize(op.penSize);\r\n  }\r\n\r\n  getOptions() {\r\n    return {\r\n      penColor: this.penColor,\r\n      penSize: this.penSize,\r\n    }\r\n  }\r\n\r\n  setPenSize(size: number) {\r\n    this.ctx.lineWidth = size;\r\n  }\r\n\r\n  setPenColor(color: string) {\r\n    this.ctx.strokeStyle = color;\r\n    this.ctx.fillStyle = color;\r\n  }\r\n\r\n\r\n}\r\n","import React, { useCallback, useState } from 'react';\r\nimport { IconButton, Popover } from '@material-ui/core';\r\nimport {\r\n  ColorLens as ColorIcon,\r\n  FiberManualRecord as CircleIcon,\r\n} from '@material-ui/icons';\r\n\r\nimport CanvasController from '@client/controller/CanvasController';\r\n\r\nconst colors = [\r\n  '#000',\r\n  '#F44336',\r\n  '#E91E63',\r\n  '#9C27B0',\r\n  '#2196F3',\r\n  '#48C6FF',\r\n  '#4CAF50',\r\n  '#8BC34A',\r\n  '#FFEB3B',\r\n  '#FFC107',\r\n  '#FF9800',\r\n  '#795548',\r\n  '#607D8B',\r\n  '#666',\r\n  '#999',\r\n  '#BBB',\r\n  '#DDD',\r\n  '#FFF',\r\n];\r\n\r\nexport default function SetPenColorButton({\r\n  anchorEl,\r\n  penColor,\r\n  setPenColor,\r\n}: {\r\n  draw: CanvasController;\r\n  anchorEl: Element | null;\r\n  penColor: string;\r\n  setPenColor: (color: string) => void;\r\n}) {\r\n  const [isShowSetPenColor, setIsShowSetPenColor] = useState(false);\r\n  const updatePenColor = useCallback(\r\n    (color: string) => {\r\n      setPenColor(color);\r\n      setIsShowSetPenColor(false);\r\n    },\r\n    [setPenColor, setIsShowSetPenColor],\r\n  );\r\n\r\n\r\n  return (\r\n    <>\r\n      <IconButton\r\n        style={{\r\n          flex: '1',\r\n        }}\r\n        onClick={() => setIsShowSetPenColor(prev => !prev)}\r\n        className=\"canvas-operation-list-item\"\r\n      >\r\n        <ColorIcon style={{\r\n          color: penColor,\r\n        }} fontSize=\"large\" />\r\n      </IconButton>\r\n      <Popover\r\n        anchorOrigin={{\r\n          vertical: 'top',\r\n          horizontal: 'center',\r\n        }}\r\n        transformOrigin={{\r\n          vertical: 'bottom',\r\n          horizontal: 'center',\r\n        }}\r\n        anchorEl={anchorEl}\r\n        onClose={() => setIsShowSetPenColor(false)}\r\n        open={isShowSetPenColor}\r\n      >\r\n        <div className=\"pen-color-wrapper\">\r\n          {colors.map(color => (\r\n            <IconButton onClick={() => updatePenColor(color)} key={color}>\r\n              <CircleIcon style={{\r\n                border: '1px solid #000',\r\n                color,\r\n              }} />\r\n            </IconButton>\r\n          ))}\r\n        </div>\r\n      </Popover>\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport default function PlainLine(props: {\r\n  length?: number;\r\n  width?: number;\r\n  vertical?: boolean;\r\n  color?: string;\r\n}) {\r\n  let { length, width, vertical, color  } = props;\r\n  if (length == null) length = 24;\r\n  if (width == null) width = 2;\r\n  if (vertical == null) vertical = false;\r\n  if (color == null) color = '#000';\r\n  if (vertical) {\r\n    [length, width] = [width, length];\r\n  }\r\n  return (\r\n    <div\r\n      className=\"plain-line\"\r\n      style={{\r\n        height: width,\r\n        width: length,\r\n        backgroundColor: color,\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import React, { useCallback, useState } from 'react';\r\nimport { IconButton, Popover, Slider } from '@material-ui/core';\r\n\r\nimport PlainLine from '@client/ui/PlainLine';\r\n\r\nexport default function SetPenSizeButton({\r\n  anchorEl,\r\n  penColor,\r\n  penSize,\r\n  setPenSize,\r\n}: {\r\n  anchorEl: Element | null;\r\n  penSize: number;\r\n  setPenSize: (size: number) => void;\r\n  penColor: string;\r\n}) {\r\n  const updatePenSize = useCallback(\r\n    (_: any, value: number | number[]) => {\r\n      const size = value as number;\r\n      setPenSize(size);\r\n    },\r\n    [setPenSize],\r\n  );\r\n  const [isShowSetPenSize, setIsShowSetPenSize] = useState(false);\r\n\r\n  return (\r\n    <>\r\n      <IconButton\r\n        style={{\r\n          flex: '1',\r\n        }}\r\n        onClick={() => setIsShowSetPenSize(prev => !prev)}\r\n        className=\"canvas-operation-list-item\"\r\n      >\r\n        <PlainLine color={penColor} length={30} width={penSize} />\r\n      </IconButton>\r\n      <Popover\r\n        anchorOrigin={{\r\n          vertical: 'top',\r\n          horizontal: 'center',\r\n        }}\r\n        transformOrigin={{\r\n          vertical: 'bottom',\r\n          horizontal: 'center',\r\n        }}\r\n        anchorEl={anchorEl == null ? undefined : anchorEl}\r\n        onClose={() => setIsShowSetPenSize(false)}\r\n        open={isShowSetPenSize}\r\n      >\r\n        <div className=\"pen-size-slider-wrapper\">\r\n          <Slider\r\n            style={{\r\n              width: '80vw',\r\n            }}\r\n            value={penSize}\r\n            onChange={updatePenSize}\r\n            valueLabelDisplay=\"auto\"\r\n            step={1}\r\n            marks\r\n            min={1}\r\n            max={20}\r\n          />\r\n        </div>\r\n      </Popover>\r\n    </>\r\n  );\r\n}\r\n","import './Canvas.scss';\r\n\r\nimport CanvasController, {\r\n  ICanvasControllerSetting,\r\n} from '@client/controller/CanvasController';\r\nimport Point from '@client/controller/Point';\r\nimport { throttle } from '@client/util/helper';\r\nimport wsClient from '@client/WebsocketClient/wsClient';\r\nimport { IconButton } from '@material-ui/core';\r\nimport {\r\n  Redo as RedoIcon,\r\n  RestoreFromTrash as ClearIcon,\r\n  Undo as UndoIcon,\r\n} from '@material-ui/icons';\r\nimport React, {\r\n  TouchEvent,\r\n  useCallback,\r\n  useEffect,\r\n  useLayoutEffect,\r\n  useRef,\r\n  useState,\r\n} from 'react';\r\n\r\nimport { ReservedEventName } from '../../../../../../shared/constants';\r\nimport DrawAction, {\r\n  DrawActionType,\r\n  TDrawerExternals,\r\n} from '../../../../../../shared/models/DrawAction';\r\nimport RequestMessage from '../../../../../../shared/models/RequestMessage';\r\nimport { IGame } from '../../../../../../shared/types';\r\nimport SetPenColorButton from './SetPenColorButton';\r\nimport SetPenSizeButton from './SetPenSizeButton';\r\n\r\n// import RequestMessage from '@client/WebsocketClient/models/RequestMessage';\r\n\r\nfunction sendDrawActionToServer(\r\n  type: DrawActionType,\r\n  payload?: unknown,\r\n  externals?: TDrawerExternals,\r\n) {\r\n  const drawAction = new DrawAction(type, payload, externals);\r\n  const reqMsg = new RequestMessage(drawAction, ReservedEventName.DRAW_ACTION);\r\n  wsClient.sendMessage(reqMsg);\r\n}\r\n\r\nfunction getPointFromEvent(evt: TouchEvent): Point {\r\n  // 获得相对画布左上角的坐标\r\n  const { touches, target } = evt;\r\n  const t = touches[0];\r\n  const { clientX, clientY } = t;\r\n  const result = {\r\n    x: clientX - (target as HTMLCanvasElement).offsetLeft,\r\n    y: clientY - (target as HTMLCanvasElement).offsetTop,\r\n  };\r\n  return result;\r\n}\r\n\r\nfunction Canvas({\r\n  isSelfPlaying,\r\n  currentGame,\r\n}: {\r\n  isSelfPlaying: boolean;\r\n  currentGame: IGame;\r\n}) {\r\n  const drawRef = useRef(new CanvasController());\r\n  const draw = drawRef.current;\r\n  const [futureDrawings, setFutureDrawings] = useState<string[]>([]);\r\n  const [pastDrawings, setPastDrawings] = useState<string[]>([]);\r\n  const [penColor, setPenColor] = useState('#000');\r\n  const [penSize, setPenSize] = useState(1);\r\n  const isMountedRef = useRef(false);\r\n\r\n  // 生命周期\r\n\r\n  useLayoutEffect(() => {\r\n    if (isMountedRef.current === false) {\r\n      draw.mount('#id-canvas');\r\n      isMountedRef.current = true;\r\n    }\r\n    if (currentGame.newestDrawing !== undefined) {\r\n      draw.drawImage(currentGame.newestDrawing);\r\n    }\r\n  }, [draw, currentGame]);\r\n\r\n  useEffect(() => {\r\n    const changePlayingUserOff = wsClient.on(\r\n      ReservedEventName.CHANGE_DRAWER,\r\n      () => {\r\n        // 清除别人在画布上的东西\r\n        draw.clearCanvas();\r\n        setFutureDrawings([]);\r\n        setPastDrawings([]);\r\n      },\r\n    );\r\n\r\n    const drawActionOff = wsClient.on(\r\n      ReservedEventName.DRAW_ACTION,\r\n      respMsgData => {\r\n        const drawAction = respMsgData as DrawAction;\r\n        const { type, payload } = drawAction;\r\n        switch (type) {\r\n          case DrawActionType.START_DRAW_LINE:\r\n            {\r\n              const { point, setting } = payload as {\r\n                point: Point;\r\n                setting?: ICanvasControllerSetting;\r\n              };\r\n              let prevSetting = draw.getSetting();\r\n              if (setting != null) draw.setting(setting);\r\n              draw.drawPoint(point);\r\n              draw.startDrawLine(point);\r\n              draw.setting(prevSetting);\r\n            }\r\n            break;\r\n          case DrawActionType.DRAW_LINE_TO:\r\n            {\r\n              const { point, setting } = payload as {\r\n                point: Point;\r\n                setting?: ICanvasControllerSetting;\r\n              };\r\n              let prevSetting = draw.getSetting();\r\n              if (setting != null) draw.setting(setting);\r\n              draw.drawLineTo(point);\r\n              draw.setting(prevSetting);\r\n            }\r\n            break;\r\n          case DrawActionType.DRAW_IMAGE:\r\n            {\r\n              const imgData = payload as string;\r\n              draw.drawImage(imgData);\r\n            }\r\n            break;\r\n        }\r\n      },\r\n    );\r\n    return () => {\r\n      changePlayingUserOff();\r\n      drawActionOff();\r\n    };\r\n  }, [draw, setFutureDrawings, setPastDrawings]);\r\n\r\n  // 绘图相关\r\n\r\n  const snapshotCurrentDrawing = useCallback(() => {\r\n    const curDrawing = draw.getSnapshot();\r\n    setPastDrawings(prev => prev.concat(curDrawing));\r\n  }, [draw]);\r\n\r\n  const startDrawLine = useCallback(\r\n    (p: Point) => {\r\n      if (futureDrawings.length !== 0) {\r\n        setFutureDrawings([]);\r\n      }\r\n      draw.drawPoint(p);\r\n      draw.startDrawLine(p);\r\n\r\n      sendDrawActionToServer(DrawActionType.START_DRAW_LINE, {\r\n        point: p,\r\n        setting: draw.getSetting(),\r\n      });\r\n    },\r\n    [draw, futureDrawings, setFutureDrawings],\r\n  );\r\n\r\n  const drawLineTo = useCallback(\r\n    (to: Point) => {\r\n      draw.drawLineTo(to);\r\n      sendDrawActionToServer(DrawActionType.DRAW_LINE_TO, {\r\n        point: to,\r\n        setting: draw.getSetting(),\r\n      });\r\n    },\r\n    [draw],\r\n  );\r\n\r\n  const clearCanvas = useCallback(() => {\r\n    snapshotCurrentDrawing();\r\n\r\n    draw.clearCanvas();\r\n    sendDrawActionToServer(DrawActionType.DRAW_IMAGE, draw.getSnapshot());\r\n  }, [draw, snapshotCurrentDrawing]);\r\n\r\n  const undoDrawing = useCallback(() => {\r\n    if (pastDrawings.length === 0) return;\r\n    const pastDrawing = pastDrawings.pop() as string;\r\n    draw.drawImage(pastDrawing);\r\n    setPastDrawings([...pastDrawings]);\r\n    setFutureDrawings([...futureDrawings, draw.getSnapshot()]);\r\n    sendDrawActionToServer(DrawActionType.DRAW_IMAGE, pastDrawing);\r\n  }, [pastDrawings, futureDrawings, draw, setPastDrawings, setFutureDrawings]);\r\n\r\n  const redoDrawing = useCallback(() => {\r\n    if (futureDrawings.length === 0) return;\r\n\r\n    const futureDrawing = futureDrawings.pop() as string;\r\n    draw.drawImage(futureDrawing);\r\n    setPastDrawings([...pastDrawings, draw.getSnapshot()]);\r\n    setFutureDrawings([...futureDrawings]);\r\n    sendDrawActionToServer(DrawActionType.DRAW_IMAGE, futureDrawing);\r\n  }, [pastDrawings, futureDrawings, draw, setFutureDrawings, setPastDrawings]);\r\n\r\n  // event handler\r\n\r\n  const handleTouchStart = useCallback(\r\n    (evt: TouchEvent) => {\r\n      snapshotCurrentDrawing();\r\n\r\n      const p = getPointFromEvent(evt);\r\n      startDrawLine(p);\r\n    },\r\n    [snapshotCurrentDrawing, startDrawLine],\r\n  );\r\n\r\n  const handleTouchMove = useCallback(\r\n    throttle((evt: TouchEvent) => { // 节流\r\n      const p = getPointFromEvent(evt);\r\n      drawLineTo(p);\r\n    }, 34), // 最多30帧\r\n    [drawLineTo],\r\n  );\r\n\r\n  const handleTouchEnd = useCallback(() => {\r\n    // const drawing = draw.getSnapshot();\r\n    sendDrawActionToServer(DrawActionType.DRAW_IMAGE, draw.getSnapshot());\r\n  }, [draw]);\r\n\r\n  const [posDivEl, setPosDivEl] = useState<HTMLDivElement | null>(null);\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"canvas-wrapper\">\r\n        <div\r\n          id=\"id-canvas\"\r\n          style={{\r\n            width: 375,\r\n            height: 300,\r\n          }}\r\n          onTouchStart={isSelfPlaying ? handleTouchStart : undefined}\r\n          onTouchMove={isSelfPlaying ? handleTouchMove : undefined}\r\n          onTouchEnd={isSelfPlaying ? handleTouchEnd : undefined}\r\n        />\r\n      </div>\r\n      {!isSelfPlaying ? null : (\r\n        <div ref={ref => setPosDivEl(ref)} className=\"game-canvas-operations\">\r\n          <SetPenColorButton\r\n            anchorEl={posDivEl}\r\n            draw={draw}\r\n            penColor={penColor}\r\n            setPenColor={(color: string) => {\r\n              draw.penColor = color;\r\n              setPenColor(color);\r\n            }}\r\n          />\r\n          <SetPenSizeButton\r\n            penSize={penSize}\r\n            penColor={penColor}\r\n            setPenSize={(size: number) => {\r\n              draw.penSize = size;\r\n              setPenSize(size);\r\n            }}\r\n            anchorEl={posDivEl}\r\n          />\r\n          <IconButton\r\n            disabled={pastDrawings.length === 0}\r\n            onClick={undoDrawing}\r\n            style={{ flex: '1' }}\r\n            className=\"canvas-operation-list-item\"\r\n          >\r\n            <UndoIcon fontSize=\"large\" />\r\n          </IconButton>\r\n          <IconButton\r\n            disabled={futureDrawings.length === 0}\r\n            style={{ flex: '1' }}\r\n            onClick={redoDrawing}\r\n            className=\"canvas-operation-list-item\"\r\n          >\r\n            <RedoIcon fontSize=\"large\" />\r\n          </IconButton>\r\n          <IconButton\r\n            style={{ flex: '1', color: '#000' }}\r\n            className=\"canvas-operation-list-item\"\r\n            onClick={clearCanvas}\r\n          >\r\n            <ClearIcon fontSize=\"large\" />\r\n          </IconButton>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default React.memo(Canvas);\r\n","import './index.scss';\r\n\r\nimport wsClient from '@client/WebsocketClient/wsClient';\r\nimport React, { useEffect, useState } from 'react';\r\n\r\nimport { ReservedEventName } from '../../../../../../shared/constants';\r\nimport ChattingMessage from '../../../../../../shared/models/ChattingMessage';\r\n\r\n// 以 375宽 为标准\r\n\r\nfunction GameChattingMessage() {\r\n\r\n  const [chattingMessageList, setChattingMessageList]  = useState<ChattingMessage[]>([]);\r\n\r\n  useEffect(() => {\r\n    const chattingMessageOff = wsClient.on(\r\n      ReservedEventName.GAME_CHATTING,\r\n      msgData => {\r\n        setChattingMessageList(prevList => [msgData as ChattingMessage, ...prevList]);\r\n      },\r\n    );\r\n    return () => {\r\n      chattingMessageOff();\r\n    }\r\n  }, [])\r\n\r\n  return (\r\n    <div className=\"game-chatting-message-list\">\r\n      {chattingMessageList.map(c => (\r\n        <div key={c.id} className=\"game-chatting-message-list-item\">\r\n          {c.speaker.name}: {c.content}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default React.memo(GameChattingMessage);\r\n","import './index.scss';\r\n\r\nimport wsClient from '@client/WebsocketClient/wsClient';\r\nimport { AppBar } from '@material-ui/core';\r\nimport React, { useEffect, useState } from 'react';\r\n\r\nimport { ReservedEventName } from '../../../../../../shared/constants';\r\nimport { IGame } from '../../../../../../shared/types';\r\n\r\nfunction GameHeader({\r\n  isSelfPlaying,\r\n  currentGame,\r\n}: {\r\n  isSelfPlaying: boolean;\r\n  currentGame: IGame;\r\n}) {\r\n  const [gameTimeSoFar, setGameTimeSoFar] = useState(currentGame.playInfo.time);\r\n  useEffect(() => {\r\n    // let startTime: number;\r\n    const timeoutOff = wsClient.on(ReservedEventName.TIMEOUT, msgData => {\r\n      const leftTimeForPlay = msgData as number;\r\n      setGameTimeSoFar(leftTimeForPlay);\r\n    });\r\n    return () => {\r\n      timeoutOff();\r\n    };\r\n  }, [setGameTimeSoFar]);\r\n\r\n  const { playInfo } = currentGame;\r\n\r\n  return (\r\n    <AppBar\r\n      style={{\r\n        boxShadow: 'none',\r\n      }}\r\n      position=\"static\"\r\n    >\r\n      <div className=\"game-header\">\r\n        <span className=\"game-header-hint\">\r\n          {isSelfPlaying\r\n            ? `请画 ${playInfo.keyword.raw}`\r\n            : `${playInfo.keyword.raw.length}个字 ${playInfo.keyword.hint}`}\r\n        </span>\r\n        <span className=\"game-time-so-far\">剩余:{gameTimeSoFar}秒</span>\r\n      </div>\r\n    </AppBar>\r\n  );\r\n}\r\n\r\nexport default React.memo(GameHeader);\r\n","import React from 'react';\r\nimport { IGame, IUser } from '../../../../../../shared/types';\r\nimport UserAvatar from '@client/ui/UserAvatar';\r\n\r\nimport './index.scss';\r\n\r\nfunction GameUserList({\r\n  currentGame,\r\n  user,\r\n}: {\r\n  currentGame: IGame;\r\n  user: IUser;\r\n}) {\r\n  return (\r\n    <div className=\"game-user-list\">\r\n      {currentGame.users.map(gameUser => (\r\n        <div key={gameUser.id} className=\"user-list-user\">\r\n          <UserAvatar avatar={gameUser.username[0]}>\r\n            {gameUser.id === user.id ? (\r\n              <UserAvatar.AvatarStatus text=\"我\" />\r\n            ) : null}\r\n            <UserAvatar.AvatarStatus\r\n              text={`${currentGame.userScores[gameUser.id]}分`}\r\n            />\r\n            {gameUser.id === currentGame.playInfo.drawer.id ? (\r\n              <UserAvatar.AvatarStatus text=\"正在绘画\" />\r\n            ) : null}\r\n            {gameUser.isOnLine ? null : (\r\n              <UserAvatar.AvatarStatus bgColor=\"grey\" text=\"已离线\" />\r\n            )}\r\n          </UserAvatar>\r\n          <div className=\"username\">{gameUser.username}</div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default React.memo(GameUserList);\r\n","import './index.scss';\r\n\r\nimport { roomActions, userActions } from '@client/store/actions';\r\nimport { roomEffects } from '@client/store/effects';\r\nimport { IReduxState } from '@client/store/reducers';\r\nimport FullScreenLoading from '@client/ui/FullScreenLoading';\r\nimport wsClient from '@client/WebsocketClient/wsClient';\r\nimport { Button, Dialog, DialogContent, DialogTitle } from '@material-ui/core';\r\nimport React, { useEffect, useMemo, useState } from 'react';\r\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\r\n\r\nimport { ReservedEventName } from '../../../../shared/constants';\r\nimport { IGame, IUser } from '../../../../shared/types';\r\nimport AnswerInputBox from './components/AnswerInputBox';\r\nimport CanvasContainer from './components/CanvasContainer';\r\nimport GameChattingMessage from './components/GameChattingMessage';\r\nimport GameHeader from './components/GameHeader';\r\nimport GameUserList from './components/GameUserList';\r\n\r\nconst selectorGame = ({\r\n  room: { currentGame },\r\n  user: { user },\r\n}: IReduxState) => ({\r\n  currentGame,\r\n  user,\r\n});\r\n\r\nexport default function Game() {\r\n  const { currentGame, user } = useSelector(selectorGame, shallowEqual);\r\n  const dispatch = useDispatch();\r\n  const [gameAnswer, setGameAnswer] = useState('');\r\n\r\n  useEffect(() => {\r\n    if (currentGame == null) {\r\n      dispatch(roomEffects.getGame());\r\n    }\r\n  }, [currentGame, dispatch]);\r\n\r\n  const [isShowPlayOverPanel, setIsShowPlayOverPanel] = useState(false);\r\n\r\n  useEffect(() => {\r\n\r\n    const refreshGameUsersOff = wsClient.on(ReservedEventName.REFRESH_GAME_USERS, msgData => {\r\n      const gameUsers = msgData as IUser[];\r\n      dispatch(roomActions.createSetCurrentGameUsers(gameUsers));\r\n    });\r\n\r\n    const playOverOff = wsClient.on(ReservedEventName.PLAY_OVER, msgData => {\r\n      const { answer } = msgData as { answer: string };\r\n      setGameAnswer(answer);\r\n      setIsShowPlayOverPanel(true);\r\n    });\r\n\r\n    const gameOverOff = wsClient.on(ReservedEventName.GAME_OVER, msgData => {\r\n      const { user } = msgData as {\r\n        user: IUser;\r\n      };\r\n      dispatch(userActions.createSetIsGaming(user.isGaming));\r\n    });\r\n\r\n    const refreshGameOff = wsClient.on(\r\n      ReservedEventName.REFRESH_GAME,\r\n      msgData => {\r\n        const { game } = msgData as {\r\n          game: IGame;\r\n        };\r\n        dispatch(roomActions.createSetCurrentGame(game));\r\n      },\r\n    );\r\n\r\n    const changeDrawerOff = wsClient.on(\r\n      ReservedEventName.CHANGE_DRAWER,\r\n      msgData => {\r\n        const { game } = msgData as {\r\n          game: IGame;\r\n        };\r\n        dispatch(roomActions.createSetCurrentGame(game));\r\n        setIsShowPlayOverPanel(false);\r\n      },\r\n    );\r\n\r\n    return () => {\r\n      refreshGameUsersOff();\r\n      gameOverOff();\r\n      refreshGameOff();\r\n      changeDrawerOff();\r\n      playOverOff();\r\n    };\r\n  }, [setGameAnswer, setIsShowPlayOverPanel, dispatch]);\r\n\r\n  const isSelfPlaying = useMemo(() => {\r\n    // 自己是画家还是猜测的人\r\n    if (user == null || currentGame == null) return false;\r\n    if (user.id === currentGame.playInfo.drawer.id) return true;\r\n    return false;\r\n  }, [user, currentGame]);\r\n\r\n  if (currentGame == null || user == null) return <FullScreenLoading />;\r\n\r\n  return (\r\n    <>\r\n      <Dialog\r\n        open={isShowPlayOverPanel}\r\n        // onClose={() => setIsShowPlayOverPanel(false)}\r\n      >\r\n        <DialogTitle>\r\n          正确答案是: {gameAnswer}\r\n        </DialogTitle>\r\n        <DialogContent>\r\n          {isSelfPlaying ? (\r\n            <Button variant=\"outlined\" disabled={true}>\r\n              保存此次画作到本地\r\n            </Button>\r\n          ) : null}\r\n        </DialogContent>\r\n      </Dialog>\r\n      <div className=\"view-game\">\r\n        <GameHeader isSelfPlaying={isSelfPlaying} currentGame={currentGame} />\r\n        <div className=\"view-game-main\">\r\n          <CanvasContainer\r\n            isSelfPlaying={isSelfPlaying}\r\n            currentGame={currentGame}\r\n          />\r\n          {isSelfPlaying ? null : <AnswerInputBox wsClient={wsClient} />}\r\n          <GameUserList user={user} currentGame={currentGame} />\r\n          <GameChattingMessage />\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\r\nimport { deepOrange } from '@material-ui/core/colors'\r\nimport React from 'react';\r\n\r\nconst theme = createMuiTheme({\r\n  palette: {\r\n    // type: 'dark',\r\n    primary: {\r\n      light: deepOrange[500],\r\n      main: deepOrange[500],\r\n      dark: deepOrange[500],\r\n    },\r\n  },\r\n});\r\n\r\nexport default function CustomThemeLayout({ children }: { children: any }) {\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n     {children}\r\n    </ThemeProvider>\r\n  );\r\n}\r\n","import GameLobby from '@client/view/GameLobby';\r\nimport BasicLayout from '@client/layout/BasicLayout';\r\nimport CreateRoom from '@client/view/room/CreateRoom';\r\nimport PlayingRoom from '@client/view/room/PlayingRoom';\r\nimport AuthLoyout from '@client/layout/AuthLayout';\r\nimport Game from '@client/view/game/Game';\r\nimport CustomThemeLayout from '@client/layout/CustomThemeLayout';\r\n\r\ninterface IRoute {\r\n  path: string;\r\n  component: (...args: any[]) => JSX.Element;\r\n  layout?: (...args: any[]) => JSX.Element;\r\n  children?: IRoute[];\r\n}\r\n\r\nconst routes: IRoute[] = [\r\n  {\r\n    path: '/',\r\n    component: AuthLoyout,\r\n    children: [\r\n      {\r\n        path: '/',\r\n        component: BasicLayout,\r\n        children: [\r\n          {\r\n            path: '/',\r\n            component: CustomThemeLayout,\r\n            children: [\r\n              {\r\n                path: '/create-room',\r\n                component: CreateRoom,\r\n              },\r\n              {\r\n                path: '/game/:id',\r\n                component: Game,\r\n              },\r\n              {\r\n                path: '/room/:roomId',\r\n                component: PlayingRoom,\r\n              },\r\n              {\r\n                path: '/',\r\n                component: GameLobby,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      },\r\n    ],\r\n  },\r\n];\r\nexport default routes;\r\n","import React from 'react';\r\n\r\nimport './index.scss';\r\nimport NotificationPanel from '@client/component/NotificationPanel';\r\n\r\nexport default function BasicLayout({ children }: { children : any}) {\r\n    return (\r\n      <>\r\n        <div className=\"basic-layout\">\r\n            {children}\r\n        </div>\r\n        <NotificationPanel />\r\n      </>\r\n    );\r\n}\r\n","import React from 'react';\r\nimport { Switch, Route } from 'react-router-dom';\r\nimport routes from './routes';\r\n\r\ninterface IRoute {\r\n  path: string;\r\n  component: (...args: any[]) => JSX.Element;\r\n  layout?: (...args: any[]) => JSX.Element;\r\n  children?: IRoute[];\r\n}\r\n\r\nfunction generateRoutes(routes?: IRoute[]) {\r\n  if (routes == null || routes.length === 0) return null;\r\n  return (\r\n    <Switch>\r\n      {routes.map((route, index) => {\r\n        const { layout: Layout, component: Component } = route;\r\n        if (Layout == null)\r\n          return (\r\n            <Route\r\n              key={index}\r\n              path={route.path}\r\n              render={() => <Component>{generateRoutes(route.children)}</Component>}\r\n            ></Route>\r\n          );\r\n        return (\r\n          <Route\r\n            key={index}\r\n            path={route.path}\r\n            render={() => (\r\n              <Layout>\r\n                <Component>{generateRoutes(route.children)}</Component>\r\n              </Layout>\r\n            )}\r\n          ></Route>\r\n        );\r\n      })}\r\n    </Switch>\r\n  );\r\n}\r\n\r\nexport const AppRoute = () => generateRoutes(routes);\r\n","import configureStore, { history } from '@client/store';\nimport { ConnectedRouter } from 'connected-react-router';\nimport React, { useEffect } from 'react';\nimport { Provider, useDispatch } from 'react-redux';\n\n\nimport { AppRoute } from './route';\nimport { userActions } from './store/actions';\nimport wsClient from './WebsocketClient/wsClient';\nimport { IUser } from '../shared/types';\n\n// import { HashRouter } from 'react-router-dom';\nexport const store = configureStore();\n\n\n\nfunction App() {\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    const refreshPlayerInfoOff = wsClient.on('refreshPlayerInfo', msgData => {\n      const user = msgData as IUser;\n      dispatch(userActions.createSetUser(user));\n    });\n    return () => {\n      refreshPlayerInfoOff();\n    };\n  }, [dispatch]);\n\n\n  return (\n    <div style={{\n      // height: '100vh',\n      // overflow: 'hidden',\n    }} className=\"App\">\n      <ConnectedRouter history={history}>\n        <AppRoute />\n      </ConnectedRouter>\n    </div>\n  );\n}\n\nconst AppWrapper = () => (\n  <Provider store={store}>\n    <App />\n  </Provider>\n);\n\nexport default AppWrapper;\n","import './index.scss';\nimport 'react-hot-loader';\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { hot } from 'react-hot-loader/root';\n\nimport App from './App';\nimport { IS_DEV_CLIENT } from './util/constants';\n\nif (IS_DEV_CLIENT) {\n  console.log('开发模式');\n  ReactDOM.render(React.createElement(hot(App)), document.getElementById('root'));\n} else {\n  ReactDOM.render(React.createElement(App), document.getElementById('root'));\n}\n\n(function() { // 禁止手机浏览器下拉刷新的效果\n  const bodyEl = document.querySelector('body') as HTMLBodyElement;\n  bodyEl.addEventListener('touchmove', evt => {\n    // console.log('touchstart');\n    evt.preventDefault();\n  }, {\n    passive: false,\n  });\n}());\n"],"sourceRoot":""}